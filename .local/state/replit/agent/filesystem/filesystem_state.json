{"file_contents":{"debug_boxes.js":{"content":"// Debug actual box positioning and state\nconsole.log('=== DEBUGGING ACTUAL BOX POSITIONING ===');\n\n// Simulate what happens when \"50 physics equations\" is requested\nconst PAGE_WIDTH = 816;\nconst PAGE_HEIGHT = 1056;\nconst MARGIN = 72;\nconst BOX_WIDTH = 200;\nconst BOX_HEIGHT = 150;\nconst SPACING = 20;\n\n// Calculate boxes per row (from current code)\nconst usableWidth = PAGE_WIDTH - (2 * MARGIN);\nconst boxesPerRow = Math.floor(usableWidth / (BOX_WIDTH + SPACING));\n\nconsole.log('=== LAYOUT CALCULATIONS ===');\nconsole.log(`Page Width: ${PAGE_WIDTH}px`);\nconsole.log(`Margins: ${MARGIN}px each side`);\nconsole.log(`Usable Width: ${usableWidth}px`);\nconsole.log(`Box Width + Spacing: ${BOX_WIDTH + SPACING}px`);\nconsole.log(`Calculated Boxes Per Row: ${boxesPerRow}`);\nconsole.log('');\n\nconsole.log('=== FIRST 10 BOX POSITIONS (ACTUAL ALGORITHM) ===');\nfor (let i = 0; i < 10; i++) {\n  const row = Math.floor(i / boxesPerRow);\n  const col = i % boxesPerRow;\n  const page = Math.floor(row / Math.floor((PAGE_HEIGHT - 2 * MARGIN) / (BOX_HEIGHT + SPACING)));\n  \n  const x = MARGIN + col * (BOX_WIDTH + SPACING) + (page * (PAGE_WIDTH + 40));\n  const y = MARGIN + (row % Math.floor((PAGE_HEIGHT - 2 * MARGIN) / (BOX_HEIGHT + SPACING))) * (BOX_HEIGHT + SPACING) + (page * 40);\n  \n  console.log(`Box ${i + 1}:`);\n  console.log(`  Row: ${row}, Col: ${col}, Page: ${page + 1}`);\n  console.log(`  Position: (${x}, ${y})`);\n  console.log(`  Within single page? ${x <= PAGE_WIDTH}`);\n  console.log(`  Box right edge: ${x + BOX_WIDTH}px`);\n  console.log('');\n}\n\nconsole.log('=== PROBLEM ANALYSIS ===');\nconst rows_per_page = Math.floor((PAGE_HEIGHT - 2 * MARGIN) / (BOX_HEIGHT + SPACING));\nconsole.log(`Rows per page: ${rows_per_page}`);\nconsole.log(`Boxes per page: ${boxesPerRow * rows_per_page}`);\n\n// Check when boxes start going to page 2\nconst first_page2_box = boxesPerRow * rows_per_page;\nconsole.log(`First box on page 2: Box ${first_page2_box + 1}`);\n\nif (first_page2_box < 50) {\n  console.log(`❌ ISSUE: 50 boxes will span ${Math.ceil(50 / (boxesPerRow * rows_per_page))} pages`);\n} else {\n  console.log(`✅ All 50 boxes fit on one page`);\n}","size_bytes":2140},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# replit.md\n\n## Overview\nStudyFlow is a full-stack web application designed as an academic productivity platform, offering document editing with LaTeX support, interactive cheat sheets, and customizable templates. It features AI-powered assistance through OpenAI integration and real-time collaboration. The project aims to provide a professional, Microsoft Word-level document workspace, enabling users to edit documents naturally while AI provides instant assistance and document control.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\nAI Features: User expects AI assist features to be intuitive and intelligent by default - should improve content without explicit instructions about preserving structure or formatting. AI should naturally avoid making content worse.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript\n- **Routing**: Wouter for client-side routing\n- **State Management**: TanStack Query (React Query) for server state management\n- **UI Framework**: Radix UI components with Tailwind CSS styling\n- **Styling**: Tailwind CSS with CSS variables for theming, featuring a site-wide pastel gradient background.\n- **Build Tool**: Vite for development and production builds\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js framework\n- **Language**: TypeScript with ES modules\n- **API Pattern**: RESTful API with conventional routes\n- **Middleware**: Custom logging, JSON parsing, error handling\n\n### Database & ORM\n- **Database**: PostgreSQL (configured for Neon serverless)\n- **ORM**: Drizzle ORM with Drizzle Kit for migrations\n- **Schema**: Shared schema definitions between client and server\n- **Validation**: Zod schemas for runtime type validation\n\n### Core Features\n- **Workspace Types**: Document Workspace (rich text with LaTeX), Cheat Sheet Workspace (grid-based, customizable boxes with intelligent auto-sizing and auto-fitting layout), Template Workspace (structured templates).\n- **AI Chat Integration**: OpenAI-powered assistance contextual to each workspace, integrated with natural language understanding for commands and content generation, critical fix applied for intelligent command execution without polluting documents. ChatGPT interface always visible and accessible in the right panel.\n- **Document Workspace Enhancements**: Professional three-panel Microsoft Word-like interface with left panel for chat history, center panel featuring sophisticated standalone document engine with binary search pagination algorithms (Letter, Legal, A4, etc., with dynamic page count and real-time text overflow handling), and right panel for ChatGPT and document controls. Features include full formatting toolbar, zoom controls, auto-save, and document properties. Successfully replaced TipTap editor with robust pagination system that automatically creates pages as content flows.\n- **LaTeX Rendering**: Dynamic mathematical notation rendering via KaTeX, with enhanced preprocessing to handle problematic LaTeX syntax and unit annotations.\n- **Real-time Collaboration**: Shared workspaces with chat history.\n- **Box Management**: Sequential box numbering for ChatGPT reference and manipulation, intelligent auto-sizing based on content type, and a Tetris-like auto-fitting layout system to prevent overlaps and optimize space utilization.\n- **Responsive Design**: Mobile-first approach with adaptive layouts.\n- **Error Handling**: Comprehensive error handling with user-friendly toast notifications for ChatGPT API issues.\n- **Modern UI/UX**: Professional resize system with smooth transitions, grid snapping, and debounced auto-save.\n\n## External Dependencies\n\n### Core Dependencies\n- **@neondatabase/serverless**: PostgreSQL connection for serverless environments\n- **@tanstack/react-query**: Server state management and caching\n- **drizzle-orm**: Type-safe database operations\n- **openai**: Official OpenAI API client\n- **wouter**: Lightweight React router\n\n### UI & Styling\n- **@radix-ui/***: Headless UI component primitives\n- **tailwindcss**: Utility-first CSS framework\n- **class-variance-authority**: Component variant management\n- **lucide-react**: Icon library\n- **KaTeX**: For LaTeX rendering\n\n### Development Tools\n- **vite**: Build tool and development server\n- **typescript**: Static type checking\n- **tsx**: TypeScript execution for development\n- **esbuild**: Production bundling for server code","size_bytes":4424},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2627},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport OpenAI from \"openai\";\nimport aiRoutes from \"./ai-routes\";\nimport chatgptRoutes from \"./chatgpt-routes\";\nimport { \n  insertDocumentSchema, \n  insertCheatSheetSchema, \n  insertTemplateSchema,\n  insertChatMessageSchema,\n  insertChatSessionSchema,\n  insertDocumentHistorySchema\n} from \"@shared/schema\";\n\n// the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY_ENV_VAR || \"default_key\" \n});\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // AI Writing Assistant Routes\n  app.use(\"/api/ai\", aiRoutes);\n  \n  // Documents API\n  app.get(\"/api/documents\", async (req, res) => {\n    try {\n      // For now, use a default user ID since we don't have auth implemented\n      const userId = \"default-user\";\n      const documents = await storage.getDocumentsByUser(userId);\n      res.json(documents);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch documents\" });\n    }\n  });\n\n  app.get(\"/api/documents/:id\", async (req, res) => {\n    try {\n      const document = await storage.getDocument(req.params.id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      res.json(document);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch document\" });\n    }\n  });\n\n  app.post(\"/api/documents\", async (req, res) => {\n    try {\n      const validatedData = insertDocumentSchema.parse(req.body);\n      const document = await storage.createDocument({\n        ...validatedData,\n        userId: \"default-user\"\n      });\n      res.json(document);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid document data\" });\n    }\n  });\n\n  app.patch(\"/api/documents/:id\", async (req, res) => {\n    try {\n      const updates = req.body;\n      const document = await storage.updateDocument(req.params.id, updates);\n      res.json(document);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update document\" });\n    }\n  });\n\n  // Document History API\n  app.get(\"/api/documents/:id/history\", async (req, res) => {\n    try {\n      const history = await storage.getDocumentHistory(req.params.id);\n      res.json(history);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch document history\" });\n    }\n  });\n\n  app.post(\"/api/documents/:id/history\", async (req, res) => {\n    try {\n      const validatedData = insertDocumentHistorySchema.parse(req.body);\n      const history = await storage.createDocumentHistory({\n        ...validatedData,\n        documentId: req.params.id\n      });\n      res.json(history);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid document history data\" });\n    }\n  });\n\n  // Chat Sessions API\n  app.get(\"/api/documents/:id/chat-sessions\", async (req, res) => {\n    try {\n      const sessions = await storage.getChatSessions(req.params.id);\n      res.json(sessions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch chat sessions\" });\n    }\n  });\n\n  app.post(\"/api/documents/:id/chat-sessions\", async (req, res) => {\n    try {\n      const validatedData = insertChatSessionSchema.parse(req.body);\n      const session = await storage.createChatSession({\n        ...validatedData,\n        documentId: req.params.id\n      } as any);\n      res.json(session);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid chat session data\" });\n    }\n  });\n\n  app.patch(\"/api/chat-sessions/:id\", async (req, res) => {\n    try {\n      const updates = req.body;\n      const session = await storage.updateChatSession(req.params.id, updates);\n      res.json(session);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update chat session\" });\n    }\n  });\n\n  app.delete(\"/api/chat-sessions/:id\", async (req, res) => {\n    try {\n      await storage.deleteChatSession(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete chat session\" });\n    }\n  });\n\n  // Chat Messages API for sessions\n  app.get(\"/api/chat-sessions/:id/messages\", async (req, res) => {\n    try {\n      const messages = await storage.getChatMessagesBySession(req.params.id);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch chat messages\" });\n    }\n  });\n\n  app.post(\"/api/chat-sessions/:id/messages\", async (req, res) => {\n    try {\n      const { content, documentContent, documentId } = req.body;\n\n      if (!content) {\n        return res.status(400).json({ error: 'Message content is required' });\n      }\n\n      // Document-integrated assistant prompt\n      const systemPrompt = `You are an intelligent writing assistant built into a document editor. You are helping the user work on their document.\n\nThe user's current document contains:\n\"${documentContent || 'No content yet'}\"\n\nYou can help by:\n1. Analyzing and discussing the document content\n2. Answering questions about what's written\n3. Making modifications when requested\n4. Providing writing assistance\n\nWhen the user asks about their document, refer to the content shown above. When they request changes, you can execute them using these commands:\n- [COMMAND:ADD_TEXT]new content[/COMMAND] to add text or HTML content\n- [COMMAND:REPLACE_TEXT:old_text]new text[/COMMAND] to replace text  \n- [COMMAND:DELETE_TEXT]text to remove[/COMMAND] to delete content\n- [COMMAND:FORMAT_TEXT:text:BOLD/ITALIC/UNDERLINE][/COMMAND] to format text\n\nIMPORTANT: When user requests content to be added (like colored text, paragraphs, etc.), add it directly using commands:\nExample: [COMMAND:ADD_TEXT]<p style=\"color:red;\">Red text here</p>[/COMMAND]\n\nBe proactive - when user asks for content to be added, add it immediately without asking for permission.\n\nAlways be helpful and direct about working with their document.`;\n\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\", // the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\n        messages: [\n          { role: \"system\", content: systemPrompt },\n          { role: \"user\", content: content }\n        ],\n        temperature: 0.7,\n        max_tokens: 2000,\n      });\n\n      const aiContent = response.choices[0].message.content || '';\n\n      // Parse any document commands from the response\n      const documentCommands = parseDocumentCommands(aiContent);\n      \n      // Check if the response contains HTML content that should be added (fallback for when commands aren't properly formatted)\n      const containsHTMLContent = aiContent.includes('<p') && (aiContent.includes('style=') || aiContent.includes('color'));\n      \n      // If no commands were found but HTML content exists, treat it as ADD_TEXT\n      if (documentCommands.length === 0 && containsHTMLContent) {\n        // Extract HTML content from the response\n        const htmlMatch = aiContent.match(/<p[\\s\\S]*?<\\/p>/g);\n        if (htmlMatch) {\n          const htmlContent = htmlMatch.join('\\n');\n          documentCommands.push({\n            type: 'add_text',\n            params: { text: htmlContent, position: 'end' }\n          });\n        }\n      }\n      \n      // Clean the response of command markers for display\n      const cleanContent = aiContent\n        .replace(/\\[COMMAND:.*?\\]/g, '')\n        .replace(/\\[\\/COMMAND\\]/g, '')\n        .replace(/<p[\\s\\S]*?<\\/p>/g, '') // Remove HTML content that will be added to document\n        .trim();\n\n      // Save user message\n      await storage.createChatMessage({\n        sessionId: req.params.id,\n        workspaceId: documentId,\n        workspaceType: 'document',\n        role: 'user',\n        content,\n        documentCommand: null\n      });\n\n      // Save assistant message\n      await storage.createChatMessage({\n        sessionId: req.params.id,\n        workspaceId: documentId,\n        workspaceType: 'document',\n        role: 'assistant',\n        content: cleanContent,\n        documentCommand: documentCommands.length > 0 ? documentCommands[0] : null\n      });\n\n      // Build response\n      const chatResponse = {\n        content: cleanContent,\n        role: 'assistant',\n        timestamp: new Date().toISOString(),\n        // Include document commands if any were found\n        ...(documentCommands.length > 0 && { documentCommands })\n      };\n\n      res.json(chatResponse);\n    } catch (error) {\n      console.error('ChatGPT API error:', error);\n      res.status(500).json({ error: 'Failed to get response from ChatGPT' });\n    }\n  });\n\n  // AI Chat API for documents\n  app.post(\"/api/chat/document\", async (req, res) => {\n    try {\n      const { message, documentContent, documentId } = req.body;\n      \n      if (!process.env.OPENAI_API_KEY) {\n        return res.status(400).json({ message: \"OpenAI API key not configured\" });\n      }\n\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o\", // the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are a helpful writing assistant for a document editor. Help users improve their documents, write content, format text, and answer questions about writing. Keep responses concise and focused on the user's request. When generating content, provide it in a way that can be directly inserted into the document.\"\n          },\n          {\n            role: \"user\",\n            content: `Current document content: ${documentContent}\\n\\nUser request: ${message}`\n          }\n        ],\n        max_tokens: 1000,\n        temperature: 0.7,\n      });\n\n      const content = completion.choices[0]?.message?.content || \"I couldn't generate a response. Please try again.\";\n      \n      // Save the chat message\n      await storage.createChatMessage({\n        workspaceId: documentId,\n        workspaceType: 'document',\n        role: 'user',\n        content: message,\n      });\n\n      await storage.createChatMessage({\n        workspaceId: documentId,\n        workspaceType: 'document',\n        role: 'assistant',\n        content,\n      });\n\n      res.json({ content });\n    } catch (error) {\n      console.error('Chat error:', error);\n      res.status(500).json({ message: \"Failed to process chat request\" });\n    }\n  });\n\n  // CheatSheets API\n  app.get(\"/api/cheatsheets\", async (req, res) => {\n    try {\n      const userId = \"default-user\";\n      const cheatSheets = await storage.getCheatSheetsByUser(userId);\n      res.json(cheatSheets);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch cheat sheets\" });\n    }\n  });\n\n  app.get(\"/api/cheatsheets/:id\", async (req, res) => {\n    try {\n      const cheatSheet = await storage.getCheatSheet(req.params.id);\n      if (!cheatSheet) {\n        return res.status(404).json({ message: \"Cheat sheet not found\" });\n      }\n      res.json(cheatSheet);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch cheat sheet\" });\n    }\n  });\n\n  app.post(\"/api/cheatsheets\", async (req, res) => {\n    try {\n      const validatedData = insertCheatSheetSchema.parse(req.body);\n      const cheatSheet = await storage.createCheatSheet({\n        ...validatedData,\n        userId: \"default-user\"\n      });\n      res.json(cheatSheet);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid cheat sheet data\" });\n    }\n  });\n\n  app.patch(\"/api/cheatsheets/:id\", async (req, res) => {\n    try {\n      const updates = req.body;\n      const cheatSheet = await storage.updateCheatSheet(req.params.id, updates);\n      res.json(cheatSheet);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update cheat sheet\" });\n    }\n  });\n\n  app.put(\"/api/cheatsheets/:id\", async (req, res) => {\n    try {\n      const updates = req.body;\n      const cheatSheet = await storage.updateCheatSheet(req.params.id, updates);\n      res.json(cheatSheet);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update cheat sheet\" });\n    }\n  });\n\n  // CheatSheet Chat Sessions API\n  app.get(\"/api/cheatsheets/:id/chat-sessions\", async (req, res) => {\n    try {\n      const sessions = await storage.getChatSessions(req.params.id);\n      res.json(sessions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch chat sessions\" });\n    }\n  });\n\n  app.post(\"/api/cheatsheets/:id/chat-sessions\", async (req, res) => {\n    try {\n      const validatedData = insertChatSessionSchema.parse(req.body);\n      const session = await storage.createChatSession({\n        ...validatedData,\n        documentId: req.params.id\n      } as any);\n      res.json(session);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid chat session data\" });\n    }\n  });\n\n  // Templates API\n  app.get(\"/api/templates\", async (req, res) => {\n    try {\n      const userId = \"default-user\";\n      const templates = await storage.getTemplatesByUser(userId);\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch templates\" });\n    }\n  });\n\n  app.get(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const template = await storage.getTemplate(req.params.id);\n      if (!template) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch template\" });\n    }\n  });\n\n  app.post(\"/api/templates\", async (req, res) => {\n    try {\n      const validatedData = insertTemplateSchema.parse(req.body);\n      const template = await storage.createTemplate({\n        ...validatedData,\n        userId: \"default-user\"\n      });\n      res.json(template);\n    } catch (error) {\n      res.status(400).json({ message: \"Invalid template data\" });\n    }\n  });\n\n  app.put(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const updates = req.body;\n      const template = await storage.updateTemplate(req.params.id, updates);\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update template\" });\n    }\n  });\n\n  // Chat API\n  app.get(\"/api/chat/:workspaceType/:workspaceId\", async (req, res) => {\n    try {\n      const { workspaceType, workspaceId } = req.params;\n      const messages = await storage.getChatMessages(workspaceId, workspaceType);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch chat messages\" });\n    }\n  });\n\n  app.post(\"/api/chat\", async (req, res) => {\n    try {\n      const { workspaceId, workspaceType, message, currentBoxes } = req.body;\n      \n      // Store user message\n      await storage.createChatMessage({\n        workspaceId,\n        workspaceType,\n        role: \"user\",\n        content: message\n      });\n\n      // Get AI response with box context\n      const systemPrompt = getSystemPrompt(workspaceType, currentBoxes);\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\", // the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\n        messages: [\n          { role: \"system\", content: systemPrompt },\n          { role: \"user\", content: message }\n        ],\n        response_format: { type: \"json_object\" }\n      });\n\n      const aiResponse = JSON.parse(response.choices[0].message.content || \"{}\");\n      \n      // Store AI response\n      await storage.createChatMessage({\n        workspaceId,\n        workspaceType,\n        role: \"assistant\",\n        content: JSON.stringify(aiResponse)\n      });\n\n      res.json(aiResponse);\n    } catch (error) {\n      console.error(\"Chat API error:\", error);\n      res.status(500).json({ message: \"Failed to process chat message\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n\n// Parse document commands from ChatGPT response\nfunction parseDocumentCommands(content: string): any[] {\n  const commands: any[] = [];\n  \n  // Parse ADD_TEXT commands\n  const addMatches = content.match(/\\[COMMAND:ADD_TEXT\\](.*?)\\[\\/COMMAND\\]/g);\n  if (addMatches) {\n    addMatches.forEach(match => {\n      const text = match.replace(/\\[COMMAND:ADD_TEXT\\]/, '').replace(/\\[\\/COMMAND\\]/, '');\n      commands.push({\n        type: 'add_text',\n        params: { text, position: 'end' }\n      });\n    });\n  }\n\n  // Parse REPLACE_TEXT commands\n  const replaceMatches = content.match(/\\[COMMAND:REPLACE_TEXT:(.*?)\\](.*?)\\[\\/COMMAND\\]/g);\n  if (replaceMatches) {\n    replaceMatches.forEach(match => {\n      const parts = match.match(/\\[COMMAND:REPLACE_TEXT:(.*?)\\](.*?)\\[\\/COMMAND\\]/);\n      if (parts && parts.length >= 3) {\n        commands.push({\n          type: 'replace_text',\n          params: { targetText: parts[1], newText: parts[2] }\n        });\n      }\n    });\n  }\n\n  // Parse DELETE_TEXT commands\n  const deleteMatches = content.match(/\\[COMMAND:DELETE_TEXT\\](.*?)\\[\\/COMMAND\\]/g);\n  if (deleteMatches) {\n    deleteMatches.forEach(match => {\n      const text = match.replace(/\\[COMMAND:DELETE_TEXT\\]/, '').replace(/\\[\\/COMMAND\\]/, '');\n      commands.push({\n        type: 'delete_text',\n        params: { text }\n      });\n    });\n  }\n\n  // Parse FORMAT_TEXT commands\n  const formatMatches = content.match(/\\[COMMAND:FORMAT_TEXT:(.*?):(.*?)\\]\\[\\/COMMAND\\]/g);\n  if (formatMatches) {\n    formatMatches.forEach(match => {\n      const parts = match.match(/\\[COMMAND:FORMAT_TEXT:(.*?):(.*?)\\]\\[\\/COMMAND\\]/);\n      if (parts && parts.length >= 3) {\n        const formatting: any = {};\n        const formatType = parts[2].toLowerCase();\n        if (formatType.includes('bold')) formatting.bold = true;\n        if (formatType.includes('italic')) formatting.italic = true;\n        if (formatType.includes('underline')) formatting.underline = true;\n        \n        commands.push({\n          type: 'format_text',\n          params: { text: parts[1], formatting }\n        });\n      }\n    });\n  }\n\n  // Parse CLEAR_ALL commands\n  const clearMatches = content.match(/\\[COMMAND:CLEAR_ALL\\]\\[\\/COMMAND\\]/g);\n  if (clearMatches) {\n    commands.push({\n      type: 'clear_all',\n      params: {}\n    });\n  }\n\n  return commands;\n}\n\nfunction getSystemPrompt(workspaceType: string, currentBoxes?: any[]): string {\n  switch (workspaceType) {\n    case \"document\":\n      return `You are an AI assistant helping with document editing. When users ask questions, provide responses that can be formatted with LaTeX for mathematical content. Always respond in valid JSON format with fields: \"content\" (the main response), \"latex\" (any LaTeX formulas), and \"formatting\" (how to insert into document). Focus on academic and educational content. Your response must be valid JSON.`;\n    \n    case \"cheatsheet\":\n      const boxContext = currentBoxes && currentBoxes.length > 0 \n        ? `\\n\\nCURRENT BOXES ON SHEET:\\n${currentBoxes.map((box: any, index: number) => \n            `Box ${index + 1}: \"${box.title}\" - ${box.content.substring(0, 50)}${box.content.length > 50 ? '...' : ''}`\n          ).join('\\n')}`\n        : '\\n\\nNo boxes currently on the sheet.';\n      \n      return `You are a versatile Content Assistant for cheat sheet management. You can create ANY TYPE of educational content (math formulas, text, nursery rhymes, poems, study notes, facts, etc.) OR perform operations on existing numbered boxes. Always respond in valid JSON format.${boxContext}\n\nCREATING NEW CONTENT:\nWhen users request ANY content (formulas, nursery rhymes, poems, study notes, etc.), respond with JSON containing \"boxes\" array format:\n- \"title\": Clear, descriptive name for the content\n- \"content\": The actual content (LaTeX for math, plain text for everything else)\n- \"color\": One of: \"from-blue-50 to-indigo-50 border-blue-200\", \"from-green-50 to-emerald-50 border-green-200\", \"from-purple-50 to-violet-50 border-purple-200\", \"from-orange-50 to-red-50 border-orange-200\", \"from-teal-50 to-cyan-50 border-teal-200\", \"from-pink-50 to-rose-50 border-pink-200\"\n- IMPORTANT: When user asks for N items, provide exactly N boxes in the array\n\nBOX OPERATIONS (use when users reference specific box numbers):\nFor operations like \"delete box 3\", \"edit box 5\", \"replace box 2 content\", respond with JSON containing \"operations\" array:\n- \"type\": \"delete\" | \"edit\" | \"replace\"\n- \"boxNumber\": the numbered box (1, 2, 3, etc.)\n- \"title\": new title (for edit/replace operations)\n- \"content\": new content (for edit/replace operations)\n\nJSON Examples:\n- \"Delete box 3\" → {\"operations\": [{\"type\": \"delete\", \"boxNumber\": \"3\"}]}\n- \"Replace box 2 with Newton's law\" → {\"operations\": [{\"type\": \"replace\", \"boxNumber\": \"2\", \"title\": \"Newton's Second Law\", \"content\": \"F = ma\"}]}\n- \"Edit box 5 to include momentum\" → {\"operations\": [{\"type\": \"edit\", \"boxNumber\": \"5\", \"content\": \"p = mv\"}]}\n\nCONTENT GUIDELINES:\n\nFor MATHEMATICAL FORMULAS:\n- Use SIMPLE LaTeX mathematical notation that KaTeX can render\n- Good examples: \"F = ma\", \"E = mc^2\", \"\\\\frac{d}{dx}x^n = nx^{n-1}\"\n- NEVER include units in formulas - NO \\\\text{N}, \\\\text{J}, \\\\text{V}, etc.\n- DO NOT add unit annotations like \", (N)\" or \"\\\\, (\\\\text{J})\" after formulas\n- AVOID complex vector calculus notation like \\\\nabla \\\\cdot, \\\\nabla \\\\times\n- For vector operations, use simple text like \"div F\", \"curl F\", \"grad f\"  \n- DO NOT use \\\\left( \\\\right), \\\\vec{}, or complex delimiters\n- NEVER use \\\\text{}, \\\\mathrm{}, or any text commands\n- Keep formulas clean without unit labels - just the mathematical relationship\n\nFor TEXT CONTENT (nursery rhymes, poems, notes, facts, etc.):\n- Use plain text with proper spacing and line breaks\n- Make content engaging and educational\n- Include appropriate formatting for readability\n- No LaTeX formatting needed for regular text\n- Examples: nursery rhymes, study notes, historical facts, poems, quotes\n- When user requests N items, provide exactly N boxes\n\nAlways return valid JSON response.`;\n    \n    case \"template\":\n      return `You are an AI assistant filling template sections. Users will ask you to fill specific sections of a structured template. Always respond in valid JSON format with \"sections\" object where keys are section names and values have \"title\", \"content\" (with LaTeX), and \"status\". Focus on the most essential and fundamental formulas for each topic that fit in compact spaces. Your response must be valid JSON.`;\n    \n    default:\n      return `You are a helpful AI assistant. Always respond in valid JSON format with appropriate fields for the context. Your response must be valid JSON.`;\n  }\n}\n","size_bytes":22854},"server/storage.ts":{"content":"import { \n  type User, \n  type InsertUser, \n  type Document, \n  type InsertDocument,\n  type DocumentHistory,\n  type InsertDocumentHistory,\n  type ChatSession,\n  type InsertChatSession,\n  type CheatSheet,\n  type InsertCheatSheet,\n  type Template,\n  type InsertTemplate,\n  type ChatMessage,\n  type InsertChatMessage\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\nexport interface IStorage {\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n\n  // Document methods\n  getDocument(id: string): Promise<Document | undefined>;\n  getDocumentsByUser(userId: string): Promise<Document[]>;\n  createDocument(document: InsertDocument & { userId: string }): Promise<Document>;\n  updateDocument(id: string, updates: Partial<Document>): Promise<Document>;\n  \n  // Document History methods\n  getDocumentHistory(documentId: string): Promise<DocumentHistory[]>;\n  createDocumentHistory(history: InsertDocumentHistory): Promise<DocumentHistory>;\n  \n  // Chat Session methods\n  getChatSessions(documentId: string): Promise<ChatSession[]>;\n  createChatSession(session: InsertChatSession): Promise<ChatSession>;\n  updateChatSession(id: string, updates: Partial<ChatSession>): Promise<ChatSession>;\n  deleteChatSession(id: string): Promise<void>;\n  \n  // CheatSheet methods\n  getCheatSheet(id: string): Promise<CheatSheet | undefined>;\n  getCheatSheetsByUser(userId: string): Promise<CheatSheet[]>;\n  createCheatSheet(cheatSheet: InsertCheatSheet & { userId: string }): Promise<CheatSheet>;\n  updateCheatSheet(id: string, updates: Partial<CheatSheet>): Promise<CheatSheet>;\n  \n  // Template methods\n  getTemplate(id: string): Promise<Template | undefined>;\n  getTemplatesByUser(userId: string): Promise<Template[]>;\n  createTemplate(template: InsertTemplate & { userId: string }): Promise<Template>;\n  updateTemplate(id: string, updates: Partial<Template>): Promise<Template>;\n  \n  // Chat methods\n  getChatMessages(workspaceId: string, workspaceType: string): Promise<ChatMessage[]>;\n  getChatMessagesBySession(sessionId: string): Promise<ChatMessage[]>;\n  createChatMessage(message: InsertChatMessage): Promise<ChatMessage>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n  private documents: Map<string, Document>;\n  private documentHistory: Map<string, DocumentHistory>;\n  private chatSessions: Map<string, ChatSession>;\n  private cheatSheets: Map<string, CheatSheet>;\n  private templates: Map<string, Template>;\n  private chatMessages: Map<string, ChatMessage>;\n\n  constructor() {\n    this.users = new Map();\n    this.documents = new Map();\n    this.documentHistory = new Map();\n    this.chatSessions = new Map();\n    this.cheatSheets = new Map();\n    this.templates = new Map();\n    this.chatMessages = new Map();\n    \n    // Create a default test document immediately\n    this.createTestDocument();\n  }\n  \n  private async createTestDocument() {\n    const testDoc: Document = {\n      id: \"test-doc-1\",\n      title: \"My First Document\",\n      content: \"<p>Welcome to your new document workspace! Start typing here...</p>\",\n      pages: [],\n      pageSize: \"letter\",\n      fontSize: \"12\",\n      fontFamily: \"Times New Roman\",\n      textColor: \"#000000\",\n      userId: \"default-user\",\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    this.documents.set(\"test-doc-1\", testDoc);\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async getDocument(id: string): Promise<Document | undefined> {\n    return this.documents.get(id);\n  }\n\n  async getDocumentsByUser(userId: string): Promise<Document[]> {\n    return Array.from(this.documents.values()).filter(doc => doc.userId === userId);\n  }\n\n  async createDocument(document: InsertDocument & { userId: string }): Promise<Document> {\n    const id = randomUUID();\n    const now = new Date();\n    const newDocument: Document = { \n      ...document,\n      content: document.content || \"\",\n      pages: document.pages || [],\n      pageSize: document.pageSize || \"letter\",\n      fontSize: document.fontSize || \"12\",\n      fontFamily: document.fontFamily || \"Times New Roman\",\n      textColor: document.textColor || \"#000000\",\n      id, \n      createdAt: now, \n      updatedAt: now \n    };\n    this.documents.set(id, newDocument);\n    return newDocument;\n  }\n\n  async updateDocument(id: string, updates: Partial<Document>): Promise<Document> {\n    const existing = this.documents.get(id);\n    if (!existing) throw new Error('Document not found');\n    \n    const updated: Document = { \n      ...existing, \n      ...updates, \n      updatedAt: new Date() \n    };\n    this.documents.set(id, updated);\n    return updated;\n  }\n\n  async getCheatSheet(id: string): Promise<CheatSheet | undefined> {\n    return this.cheatSheets.get(id);\n  }\n\n  async getCheatSheetsByUser(userId: string): Promise<CheatSheet[]> {\n    return Array.from(this.cheatSheets.values()).filter(sheet => sheet.userId === userId);\n  }\n\n  async createCheatSheet(cheatSheet: InsertCheatSheet & { userId: string }): Promise<CheatSheet> {\n    const id = randomUUID();\n    const now = new Date();\n    const newCheatSheet: CheatSheet = { \n      ...cheatSheet,\n      boxes: cheatSheet.boxes || [],\n      id, \n      createdAt: now, \n      updatedAt: now \n    };\n    this.cheatSheets.set(id, newCheatSheet);\n    return newCheatSheet;\n  }\n\n  async updateCheatSheet(id: string, updates: Partial<CheatSheet>): Promise<CheatSheet> {\n    const existing = this.cheatSheets.get(id);\n    if (!existing) throw new Error('CheatSheet not found');\n    \n    const updated: CheatSheet = { \n      ...existing, \n      ...updates, \n      updatedAt: new Date() \n    };\n    this.cheatSheets.set(id, updated);\n    return updated;\n  }\n\n  async getTemplate(id: string): Promise<Template | undefined> {\n    return this.templates.get(id);\n  }\n\n  async getTemplatesByUser(userId: string): Promise<Template[]> {\n    return Array.from(this.templates.values()).filter(template => template.userId === userId);\n  }\n\n  async createTemplate(template: InsertTemplate & { userId: string }): Promise<Template> {\n    const id = randomUUID();\n    const now = new Date();\n    const newTemplate: Template = { \n      ...template,\n      sections: template.sections || {},\n      id, \n      createdAt: now, \n      updatedAt: now \n    };\n    this.templates.set(id, newTemplate);\n    return newTemplate;\n  }\n\n  async updateTemplate(id: string, updates: Partial<Template>): Promise<Template> {\n    const existing = this.templates.get(id);\n    if (!existing) throw new Error('Template not found');\n    \n    const updated: Template = { \n      ...existing, \n      ...updates, \n      updatedAt: new Date() \n    };\n    this.templates.set(id, updated);\n    return updated;\n  }\n\n\n\n  async getChatSessions(documentId: string): Promise<ChatSession[]> {\n    return Array.from(this.chatSessions.values()).filter(\n      session => session.documentId === documentId\n    );\n  }\n\n  async createChatSession(insertSession: InsertChatSession): Promise<ChatSession> {\n    const id = randomUUID();\n    const now = new Date();\n    const session: ChatSession = {\n      ...insertSession,\n      id,\n      createdAt: now,\n      updatedAt: now\n    };\n    this.chatSessions.set(id, session);\n    return session;\n  }\n\n  async updateChatSession(id: string, updates: Partial<ChatSession>): Promise<ChatSession> {\n    const existing = this.chatSessions.get(id);\n    if (!existing) throw new Error('Chat session not found');\n    \n    const updated: ChatSession = {\n      ...existing,\n      ...updates,\n      updatedAt: new Date()\n    };\n    this.chatSessions.set(id, updated);\n    return updated;\n  }\n\n  async deleteChatSession(id: string): Promise<void> {\n    this.chatSessions.delete(id);\n    // Also delete associated messages\n    const messagesToDelete = Array.from(this.chatMessages.values())\n      .filter(msg => msg.sessionId === id);\n    messagesToDelete.forEach(msg => this.chatMessages.delete(msg.id));\n  }\n\n  async getChatMessages(workspaceId: string, workspaceType: string): Promise<ChatMessage[]> {\n    return Array.from(this.chatMessages.values())\n      .filter(msg => msg.workspaceId === workspaceId && msg.workspaceType === workspaceType)\n      .sort((a, b) => a.createdAt!.getTime() - b.createdAt!.getTime());\n  }\n\n  async getChatMessagesBySession(sessionId: string): Promise<ChatMessage[]> {\n    return Array.from(this.chatMessages.values())\n      .filter(msg => msg.sessionId === sessionId)\n      .sort((a, b) => new Date(a.createdAt || 0).getTime() - new Date(b.createdAt || 0).getTime());\n  }\n\n  async createChatMessage(insertMessage: InsertChatMessage): Promise<ChatMessage> {\n    const id = randomUUID();\n    const message: ChatMessage = {\n      ...insertMessage,\n      sessionId: insertMessage.sessionId || null,\n      documentCommand: insertMessage.documentCommand || null,\n      id,\n      createdAt: new Date()\n    };\n    this.chatMessages.set(id, message);\n    return message;\n  }\n\n  async getDocumentHistory(documentId: string): Promise<DocumentHistory[]> {\n    return Array.from(this.documentHistory.values())\n      .filter(history => history.documentId === documentId)\n      .sort((a, b) => (b.createdAt?.getTime() || 0) - (a.createdAt?.getTime() || 0));\n  }\n\n  async createDocumentHistory(history: InsertDocumentHistory): Promise<DocumentHistory> {\n    const id = randomUUID();\n    const now = new Date();\n    const newHistory: DocumentHistory = { \n      ...history,\n      pages: history.pages || [],\n      changeDescription: history.changeDescription || null,\n      documentId: history.documentId,\n      id, \n      createdAt: now \n    };\n    this.documentHistory.set(id, newHistory);\n    return newHistory;\n  }\n}\n\nexport const storage = new MemStorage();\n","size_bytes":10198},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, jsonb, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const documents = pgTable(\"documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull().default(\"\"),\n  pages: jsonb(\"pages\").notNull().default([]),\n  pageSize: text(\"page_size\").notNull().default(\"letter\"),\n  fontSize: text(\"font_size\").notNull().default(\"12\"),\n  fontFamily: text(\"font_family\").notNull().default(\"Times New Roman\"),\n  textColor: text(\"text_color\").notNull().default(\"#000000\"),\n  userId: varchar(\"user_id\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const documentHistory = pgTable(\"document_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").references(() => documents.id).notNull(),\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  pages: jsonb(\"pages\").notNull().default([]),\n  changeDescription: text(\"change_description\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const chatSessions = pgTable(\"chat_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").references(() => documents.id).notNull(),\n  title: text(\"title\").notNull(),\n  documentSnapshot: text(\"document_snapshot\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const cheatSheets = pgTable(\"cheat_sheets\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  boxes: jsonb(\"boxes\").notNull().default([]),\n  userId: varchar(\"user_id\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const templates = pgTable(\"templates\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  templateType: text(\"template_type\").notNull(),\n  sections: jsonb(\"sections\").notNull().default({}),\n  userId: varchar(\"user_id\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").references(() => chatSessions.id),\n  workspaceId: varchar(\"workspace_id\").notNull(),\n  workspaceType: text(\"workspace_type\").notNull(), // 'document', 'cheatsheet', 'template'\n  role: text(\"role\").notNull(), // 'user' or 'assistant'\n  content: text(\"content\").notNull(),\n  documentCommand: jsonb(\"document_command\"), // For storing parsed document commands\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport const insertDocumentSchema = createInsertSchema(documents).pick({\n  title: true,\n  content: true,\n  pages: true,\n  pageSize: true,\n  fontSize: true,\n  fontFamily: true,\n  textColor: true,\n});\n\nexport const insertDocumentHistorySchema = createInsertSchema(documentHistory).pick({\n  documentId: true,\n  title: true,\n  content: true,\n  pages: true,\n  changeDescription: true,\n});\n\nexport const insertChatSessionSchema = createInsertSchema(chatSessions).pick({\n  title: true,\n  documentSnapshot: true,\n});\n\nexport const insertCheatSheetSchema = createInsertSchema(cheatSheets).pick({\n  title: true,\n  boxes: true,\n});\n\nexport const insertTemplateSchema = createInsertSchema(templates).pick({\n  title: true,\n  templateType: true,\n  sections: true,\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).pick({\n  sessionId: true,\n  workspaceId: true,\n  workspaceType: true,\n  role: true,\n  content: true,\n  documentCommand: true,\n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Document = typeof documents.$inferSelect;\nexport type InsertDocument = z.infer<typeof insertDocumentSchema>;\nexport type DocumentHistory = typeof documentHistory.$inferSelect;\nexport type InsertDocumentHistory = z.infer<typeof insertDocumentHistorySchema>;\nexport type ChatSession = typeof chatSessions.$inferSelect;\nexport type InsertChatSession = z.infer<typeof insertChatSessionSchema>;\nexport type CheatSheet = typeof cheatSheets.$inferSelect;\nexport type InsertCheatSheet = z.infer<typeof insertCheatSheetSchema>;\nexport type Template = typeof templates.$inferSelect;\nexport type InsertTemplate = z.infer<typeof insertTemplateSchema>;\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\n\n// Additional types for complex data structures\nexport type DocumentPage = {\n  id: string;\n  content: string;\n  pageNumber: number;\n};\n\nexport type CheatSheetBox = {\n  id: string;\n  title: string;\n  content: string;\n  color: string;\n  position: { x: number; y: number };\n  size: { width: number; height: number };\n};\n\nexport type TemplateSection = {\n  id: string;\n  title: string;\n  content: string;\n  status: 'empty' | 'filling' | 'complete';\n  position: { row: number; col: number };\n};\n\nexport type DocumentCommand = {\n  type: 'delete_page' | 'format_text' | 'add_text' | 'insert_page' | 'replace_text' | 'center_text' | 'delete_text' | 'clear_all';\n  params: {\n    pageNumber?: number;\n    text?: string;\n    formatting?: { bold?: boolean; italic?: boolean; underline?: boolean };\n    position?: 'start' | 'end' | 'before' | 'after';\n    targetText?: string;\n    newText?: string;\n  };\n};\n","size_bytes":6098},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport DocumentWorkspace from \"@/pages/document-workspace\";\n\nimport TemplateWorkspace from \"@/pages/template-workspace\";\nimport CheatSheetWorkspaceNew from \"@/pages/cheatsheet-workspace-new\";\nimport TemplateWorkspaceNew from \"@/pages/template-workspace-new\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Landing} />\n      <Route path=\"/document/:id?\" component={DocumentWorkspace} />\n      <Route path=\"/cheatsheet-new/:id?\" component={CheatSheetWorkspaceNew} />\n      <Route path=\"/cheatsheet/:id?\" component={CheatSheetWorkspaceNew} />\n      <Route path=\"/template-new/:id?\" component={TemplateWorkspaceNew} />\n      <Route path=\"/template/:id?\" component={TemplateWorkspace} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1332},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(20, 14.3%, 4.1%);\n  --muted: hsl(60, 4.8%, 95.9%);\n  --muted-foreground: hsl(25, 5.3%, 44.7%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(20, 14.3%, 4.1%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(20, 14.3%, 4.1%);\n  --border: hsl(20, 5.9%, 90%);\n  --input: hsl(20, 5.9%, 90%);\n  --primary: hsl(240, 100%, 64%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(60, 4.8%, 95.9%);\n  --secondary-foreground: hsl(24, 9.8%, 10%);\n  --accent: hsl(60, 4.8%, 95.9%);\n  --accent-foreground: hsl(24, 9.8%, 10%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(20, 14.3%, 4.1%);\n  --radius: 0.5rem;\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 3.9%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 15.9%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(240, 100%, 64%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(240, 3.7%, 15.9%);\n  --secondary-foreground: hsl(0, 0%, 98%);\n  --accent: hsl(240, 3.7%, 15.9%);\n  --accent-foreground: hsl(0, 0%, 98%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n  --radius: 0.5rem;\n}\n\n/* Viewport constraints for fixed layout */\nhtml, body {\n  height: 100%;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n\n#root {\n  min-height: 100%;\n}\n\n/* StudyFlow gradient background - using uploaded background image */\n.studyflow-gradient {\n  background: url('/src/assets/background.jpg') no-repeat center center;\n  background-size: cover;\n}\n\n/* Global background for all pages - using uploaded background image */\nbody {\n  background: url('/src/assets/background.jpg') no-repeat center center fixed !important;\n  background-size: cover !important;\n  min-height: 100vh;\n  background-position: center center;\n  min-height: 100vh;\n}\n\n/* React Resizable Styles */\n.react-resizable {\n  position: relative;\n}\n\n.react-resizable-handle {\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  background-repeat: no-repeat;\n  background-origin: content-box;\n  box-sizing: border-box;\n  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSI2IiB2aWV3Qm94PSIwIDAgNiA2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnIGZpbGw9IiM5OTkiIGZpbGwtb3BhY2l0eT0iLjgiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PHBhdGggZD0ibTUgNWgtNGwtMi0yaDRsLTItMmgtNGwtMi0yaDRsLTItMmgtNGwtMi0yaDB2NHoiLz48L2c+PC9zdmc+');\n  background-position: bottom right;\n  padding: 0 3px 3px 0;\n}\n\n.react-resizable-handle-se {\n  bottom: 0;\n  right: 0;\n  cursor: se-resize;\n}\n\n/* AI-themed enhancements */\n.ai-text-glow:hover {\n  text-shadow: 0 0 8px rgba(6, 182, 212, 0.3), 0 0 16px rgba(6, 182, 212, 0.1);\n  transition: text-shadow 0.3s ease;\n}\n\n.font-modern-ai {\n  font-family: 'Inter', 'Plus Jakarta Sans', sans-serif;\n}\n\n.font-ai-serif {\n  font-family: 'Literata', 'Lora', serif;\n}\n\n/* AI border glow effects for document pages */\n.ai-page-glow {\n  position: relative;\n}\n\n.ai-page-glow::before {\n  content: '';\n  position: absolute;\n  top: -2px;\n  left: -2px;\n  right: -2px;\n  bottom: -2px;\n  background: linear-gradient(45deg, \n    rgba(6, 182, 212, 0.1), \n    rgba(147, 51, 234, 0.1), \n    rgba(59, 130, 246, 0.1)\n  );\n  border-radius: inherit;\n  z-index: -1;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.ai-page-glow:hover::before {\n  opacity: 1;\n}\n\n/* Floating animations for background symbols */\n@keyframes float-in-from-left {\n  0% {\n    transform: translateX(-80px) translateY(0px) rotate(0deg);\n  }\n  50% {\n    transform: translateX(40px) translateY(-15px) rotate(10deg);\n  }\n  100% {\n    transform: translateX(-80px) translateY(0px) rotate(0deg);\n  }\n}\n\n@keyframes float-in-from-right {\n  0% {\n    transform: translateX(80px) translateY(0px) rotate(0deg);\n  }\n  50% {\n    transform: translateX(-40px) translateY(15px) rotate(-10deg);\n  }\n  100% {\n    transform: translateX(80px) translateY(0px) rotate(0deg);\n  }\n}\n\n@keyframes float-in-from-top {\n  0% {\n    transform: translateX(0px) translateY(-60px) rotate(0deg);\n  }\n  50% {\n    transform: translateX(20px) translateY(30px) rotate(8deg);\n  }\n  100% {\n    transform: translateX(0px) translateY(-60px) rotate(0deg);\n  }\n}\n\n@keyframes float-in-from-bottom {\n  0% {\n    transform: translateX(0px) translateY(60px) rotate(0deg);\n  }\n  50% {\n    transform: translateX(-20px) translateY(-30px) rotate(-8deg);\n  }\n  100% {\n    transform: translateX(0px) translateY(60px) rotate(0deg);\n  }\n}\n\n.animate-float-right {\n  animation: float-in-from-right 20s ease-in-out infinite;\n}\n\n.animate-float-left {\n  animation: float-in-from-left 22s ease-in-out infinite;\n}\n\n.animate-float-down {\n  animation: float-in-from-top 18s ease-in-out infinite;\n}\n\n.animate-float-up {\n  animation: float-in-from-bottom 24s ease-in-out infinite;\n}\n\n/* Document editor placeholder styles */\n[contenteditable][data-placeholder]:empty::before {\n  content: attr(data-placeholder);\n  color: #94a3b8;\n  font-style: italic;\n}\n\n[contenteditable]:focus {\n  outline: none;\n}\n\n/* Print styles for document pages */\n@media print {\n  .document-page {\n    page-break-after: always;\n    box-shadow: none !important;\n    margin: 0 !important;\n    transform: none !important;\n  }\n  \n  .document-page:last-child {\n    page-break-after: avoid;\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/* Custom gradient backgrounds for workspace cards */\n.workspace-card-document {\n  background: linear-gradient(135deg, hsl(217, 91%, 60%) 0%, hsl(185, 84%, 60%) 100%);\n}\n\n.workspace-card-cheatsheet {\n  background: linear-gradient(135deg, hsl(271, 91%, 65%) 0%, hsl(336, 84%, 67%) 100%);\n}\n\n.workspace-card-template {\n  background: linear-gradient(135deg, hsl(158, 64%, 52%) 0%, hsl(180, 84%, 52%) 100%);\n}\n\n/* LaTeX rendering improvements */\n.katex {\n  font-size: 1.1em;\n}\n\n.katex-display {\n  margin: 0.5em 0;\n}\n\n/* Custom scrollbar for panels */\n.custom-scrollbar::-webkit-scrollbar {\n  width: 6px;\n}\n\n.custom-scrollbar::-webkit-scrollbar-track {\n  background: hsl(60, 4.8%, 95.9%);\n}\n\n.custom-scrollbar::-webkit-scrollbar-thumb {\n  background: hsl(25, 5.3%, 44.7%);\n  border-radius: 3px;\n}\n\n.custom-scrollbar::-webkit-scrollbar-thumb:hover {\n  background: hsl(20, 14.3%, 4.1%);\n}\n\n/* Animation classes */\n.animate-fade-in {\n  animation: fadeIn 0.3s ease-out;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.animate-scale-in {\n  animation: scaleIn 0.2s ease-out;\n}\n\n@keyframes scaleIn {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n/* Hover effects for interactive elements */\n.hover-lift {\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n}\n\n.hover-lift:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);\n}\n\n/* Modern React Resizable Styles */\n.react-resizable {\n  position: relative;\n}\n\n.modern-resize-handles .react-resizable-handle {\n  position: absolute;\n  background: linear-gradient(135deg, #7c3aed, #a855f7);\n  border: 2px solid white;\n  border-radius: 50%;\n  opacity: 0;\n  transition: all 0.2s ease;\n  z-index: 10;\n  box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);\n}\n\n.modern-resize-handles:hover .react-resizable-handle {\n  opacity: 0.8;\n}\n\n.modern-resize-handles .react-resizable-handle:hover {\n  opacity: 1 !important;\n  transform: scale(1.2);\n  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.5);\n}\n\n.modern-resize-handles .react-resizable-handle-se {\n  width: 12px;\n  height: 12px;\n  right: -6px;\n  bottom: -6px;\n  cursor: se-resize;\n}\n\n.modern-resize-handles .react-resizable-handle-sw {\n  width: 10px;\n  height: 10px;\n  left: -5px;\n  bottom: -5px;\n  cursor: sw-resize;\n  opacity: 0.6;\n}\n\n.modern-resize-handles .react-resizable-handle-ne {\n  width: 10px;\n  height: 10px;\n  right: -5px;\n  top: -5px;\n  cursor: ne-resize;\n  opacity: 0.6;\n}\n\n.modern-resize-handles .react-resizable-handle-nw {\n  width: 10px;\n  height: 10px;\n  left: -5px;\n  top: -5px;\n  cursor: nw-resize;\n  opacity: 0.6;\n}\n\n/* Improved dragging and positioning */\n.react-draggable-dragging {\n  z-index: 1000;\n}\n\n.react-draggable-dragging .modern-resize-handles .react-resizable-handle {\n  opacity: 0 !important;\n}\n\n/* Better visual feedback during resize */\n.react-resizable-handle:active,\n.react-resizable-handle:focus {\n  background: linear-gradient(135deg, #6d28d9, #7c2d12) !important;\n  transform: scale(1.3) !important;\n}\n\n/* Professional resize handles with enhanced styling */\n.professional-resize-handles .react-resizable-handle {\n  position: absolute;\n  background: linear-gradient(135deg, #6366f1, #8b5cf6, #a855f7);\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  border-radius: 4px;\n  transition: all 0.3s ease;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n  opacity: 0.7;\n  width: 12px;\n  height: 12px;\n}\n\n.professional-resize-handles:hover .react-resizable-handle {\n  opacity: 1;\n}\n\n.professional-resize-handles .react-resizable-handle:hover {\n  background: linear-gradient(135deg, #4f46e5, #7c3aed, #9333ea);\n  transform: scale(1.15);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);\n  border-color: rgba(255, 255, 255, 0.4);\n}\n\n.professional-resize-handles .react-resizable-handle:active {\n  background: linear-gradient(135deg, #4338ca, #6d28d9, #7e22ce);\n  transform: scale(1.05);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n}\n\n.professional-resize-handles .react-resizable-handle-se {\n  right: -6px;\n  bottom: -6px;\n  cursor: se-resize;\n  background-image: radial-gradient(circle at 3px 3px, rgba(255,255,255,0.8) 1px, transparent 1px);\n  background-size: 6px 6px;\n}\n\n.professional-resize-handles .react-resizable-handle-sw {\n  left: -6px;\n  bottom: -6px;\n  cursor: sw-resize;\n}\n\n.professional-resize-handles .react-resizable-handle-ne {\n  right: -6px;\n  top: -6px;\n  cursor: ne-resize;\n}\n\n.professional-resize-handles .react-resizable-handle-nw {\n  left: -6px;\n  top: -6px;\n  cursor: nw-resize;\n}\n\n/* Page layout styles for multi-page cheat sheets */\n/* CSS Grid-based page layout for cheat sheets */\n.page-container {\n  width: 612px; /* 8.5 inches at 72 DPI */\n  height: 792px; /* 11 inches at 72 DPI */\n  background: white;\n  margin: 20px auto;\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n  border-radius: 8px;\n  position: relative;\n  overflow: hidden;\n  border: 2px solid #e2e8f0;\n}\n\n/* Grid container styling for auto-sizing boxes */\n.grid-box-container {\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: flex-start;\n  border: 1px dashed rgba(99, 102, 241, 0.2);\n  border-radius: 6px;\n  transition: border-color 0.2s ease;\n  min-height: 100px;\n  padding: 5px;\n}\n\n.grid-box-container:hover {\n  border-color: rgba(99, 102, 241, 0.4);\n}\n\n.page-container::before {\n  content: '';\n  position: absolute;\n  top: 36px; /* 0.5 inch margin */\n  left: 36px;\n  right: 36px;\n  bottom: 36px;\n  border: 1px dashed #cbd5e1;\n  pointer-events: none;\n  z-index: 1;\n}\n\n/* 3-column grid overlay for visual alignment */\n.page-container::after {\n  content: '';\n  position: absolute;\n  top: 36px;\n  left: 36px;\n  width: calc(100% - 72px);\n  height: calc(100% - 72px);\n  background-image: \n    linear-gradient(90deg, rgba(99, 102, 241, 0.15) 2px, transparent 2px),\n    linear-gradient(180deg, rgba(148, 163, 184, 0.1) 1px, transparent 1px);\n  background-size: 190px 150px; /* Exact grid cell size: 180px box + 10px gutter */\n  background-position: 0 0;\n  pointer-events: none;\n  z-index: 0;\n}\n\n/* Add column separators for clearer 3-column visualization */\n.page-container .grid-separator {\n  position: absolute;\n  top: 36px;\n  bottom: 36px;\n  width: 2px;\n  background: linear-gradient(180deg, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.1));\n  pointer-events: none;\n  z-index: 1;\n}\n\n.page-container .grid-separator:nth-child(1) {\n  left: calc(36px + 190px - 1px); /* After first column */\n}\n\n.page-container .grid-separator:nth-child(2) {\n  left: calc(36px + 380px - 1px); /* After second column */\n}\n\n.page-separator {\n  height: 2px;\n  background: linear-gradient(90deg, transparent, #e2e8f0, transparent);\n  margin: 20px 0;\n}\n\n@media print {\n  .page-container {\n    margin: 0;\n    box-shadow: none;\n    border-radius: 0;\n    page-break-after: always;\n  }\n  \n  .page-separator {\n    display: none;\n  }\n}\n\n.react-resizable-handle {\n  position: absolute;\n  width: 20px;\n  height: 20px;\n  background-repeat: no-repeat;\n  background-origin: content-box;\n  box-sizing: border-box;\n  background-color: rgba(139, 92, 246, 0.3);\n  border-radius: 50% 0 0 0;\n}\n\n.react-resizable-handle-se {\n  bottom: 0;\n  right: 0;\n  cursor: se-resize;\n  background-color: rgba(139, 92, 246, 0.4);\n  border-radius: 6px 0 6px 0;\n  border: 2px solid white;\n}\n\n.react-resizable-handle-se:hover {\n  background-color: rgba(139, 92, 246, 0.7);\n  transform: scale(1.1);\n}\n\n/* Print styles for templates */\n@media print {\n  .no-print {\n    display: none !important;\n  }\n  \n  .print-template {\n    width: 8.5in;\n    height: 11in;\n    margin: 0;\n    padding: 0.5in;\n    background: white;\n    color: black;\n  }\n}\n","size_bytes":13458},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/auto-resize-math-box.tsx":{"content":"import { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport Draggable, { DraggableEvent, DraggableData } from 'react-draggable';\nimport { ResizableBox, ResizeCallbackData } from 'react-resizable';\nimport { SyntheticEvent } from 'react';\nimport 'react-resizable/css/styles.css';\nimport { Button } from '@/components/ui/button';\nimport { Edit3, Trash2 } from 'lucide-react';\n\n// Constants\nconst SIZING_CONSTANTS = {\n  TITLE_HEIGHT: 48,\n  PADDING: 24,\n  MIN_FONT_SIZE: 8,\n  MAX_FONT_SIZE: 24,\n  DEFAULT_FONT_SIZE: 14,\n  DEBOUNCE_DELAY: 100,\n} as const;\n\ninterface Size {\n  width: number;\n  height: number;\n}\n\ninterface Position {\n  x: number;\n  y: number;\n}\n\ninterface AutoResizeMathBoxProps {\n  id: string;\n  title: string;\n  content: string;\n  color: string;\n  position: Position;\n  size?: Size;\n  onPositionChange: (position: Position) => void;\n  onSizeChange: (size: Size) => void;\n  onSaveRequest: () => void;\n  onEdit?: () => void;\n  onDelete?: () => void;\n  boxNumber: number;\n  isGridMode?: boolean;\n  minWidth?: number;\n  maxWidth?: number;\n  minHeight?: number;\n  maxHeight?: number;\n  isSelected?: boolean;\n  onClick?: () => void;\n}\n\nexport default function AutoResizeMathBox({\n  id,\n  title,\n  content,\n  color,\n  position,\n  size: externalSize,\n  onPositionChange,\n  onSizeChange,\n  onSaveRequest,\n  onEdit,\n  onDelete,\n  boxNumber,\n  isGridMode = false,\n  minWidth = 100,\n  maxWidth = 1200,\n  minHeight = 80,\n  maxHeight = 800,\n  isSelected = false,\n  onClick\n}: AutoResizeMathBoxProps) {\n  const [currentSize, setCurrentSize] = useState<Size>(() => {\n    // Initialize with unique instance to prevent shared state\n    return externalSize ? { ...externalSize } : { width: 300, height: 200 };\n  });\n  const [isDragging, setIsDragging] = useState(false);\n  const [optimalFontSize, setOptimalFontSize] = useState(SIZING_CONSTANTS.DEFAULT_FONT_SIZE);\n  const [contentLayout, setContentLayout] = useState({ lineHeight: 1.4, wordSpacing: 'normal' });\n  \n  const contentRef = useRef<HTMLDivElement>(null);\n  const resizeTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Calculate optimal font size and layout for current box dimensions\n  const calculateOptimalDisplay = useCallback((boxSize: Size): { fontSize: number; lineHeight: number; wordSpacing: string; letterSpacing: string } => {\n    if (!contentRef.current || !content.trim()) {\n      return { \n        fontSize: SIZING_CONSTANTS.DEFAULT_FONT_SIZE, \n        lineHeight: 1.4, \n        wordSpacing: 'normal',\n        letterSpacing: 'normal'\n      };\n    }\n\n    const availableWidth = boxSize.width - SIZING_CONSTANTS.PADDING;\n    const availableHeight = boxSize.height - SIZING_CONSTANTS.TITLE_HEIGHT - SIZING_CONSTANTS.PADDING;\n\n    // Create measurement container\n    const measureContainer = document.createElement('div');\n    measureContainer.style.cssText = `\n      position: absolute;\n      visibility: hidden;\n      top: -9999px;\n      left: -9999px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n      hyphens: auto;\n      contain: layout style paint;\n    `;\n\n    try {\n      document.body.appendChild(measureContainer);\n      \n      // Binary search for optimal font size\n      let minFont = SIZING_CONSTANTS.MIN_FONT_SIZE;\n      let maxFont = SIZING_CONSTANTS.MAX_FONT_SIZE;\n      let bestFit = { fontSize: minFont, lineHeight: 1.2, wordSpacing: 'normal', letterSpacing: 'normal' };\n      \n      while (maxFont - minFont > 0.5) {\n        const testFont = (minFont + maxFont) / 2;\n        \n        // Test different line heights for better fitting\n        const lineHeights = [1.1, 1.2, 1.3, 1.4, 1.5];\n        let fitsWithThisFont = false;\n        \n        for (const lineHeight of lineHeights) {\n          measureContainer.style.cssText += `\n            font-size: ${testFont}px;\n            line-height: ${lineHeight};\n            width: ${availableWidth}px;\n            height: auto;\n            max-height: none;\n          `;\n          \n          measureContainer.textContent = content;\n          \n          const contentHeight = measureContainer.scrollHeight;\n          \n          if (contentHeight <= availableHeight) {\n            bestFit = { \n              fontSize: testFont, \n              lineHeight, \n              wordSpacing: availableWidth < 200 ? '-0.05em' : 'normal',\n              letterSpacing: availableWidth < 150 ? '-0.02em' : 'normal'\n            };\n            fitsWithThisFont = true;\n            break;\n          }\n        }\n        \n        if (fitsWithThisFont) {\n          minFont = testFont;\n        } else {\n          maxFont = testFont;\n        }\n      }\n      \n      // If content still doesn't fit, try more aggressive spacing\n      if (bestFit.fontSize === SIZING_CONSTANTS.MIN_FONT_SIZE) {\n        measureContainer.style.cssText += `\n          font-size: ${bestFit.fontSize}px;\n          line-height: 1.1;\n          width: ${availableWidth}px;\n          word-spacing: -0.1em;\n          letter-spacing: -0.03em;\n        `;\n        measureContainer.textContent = content;\n        \n        if (measureContainer.scrollHeight <= availableHeight) {\n          bestFit = {\n            fontSize: bestFit.fontSize,\n            lineHeight: 1.1,\n            wordSpacing: '-0.1em',\n            letterSpacing: '-0.03em'\n          };\n        }\n      }\n      \n      return bestFit;\n      \n    } catch (error) {\n      console.error('Error calculating optimal display:', error);\n      return { \n        fontSize: SIZING_CONSTANTS.DEFAULT_FONT_SIZE, \n        lineHeight: 1.4, \n        wordSpacing: 'normal',\n        letterSpacing: 'normal'\n      };\n    } finally {\n      if (measureContainer.parentNode) {\n        document.body.removeChild(measureContainer);\n      }\n    }\n  }, [content]);\n\n  // Debounced recalculation\n  const debouncedRecalculate = useCallback(() => {\n    if (resizeTimerRef.current) {\n      clearTimeout(resizeTimerRef.current);\n    }\n    \n    resizeTimerRef.current = setTimeout(() => {\n      const optimal = calculateOptimalDisplay(currentSize);\n      setOptimalFontSize(optimal.fontSize);\n      setContentLayout({\n        lineHeight: optimal.lineHeight,\n        wordSpacing: optimal.wordSpacing\n      });\n    }, SIZING_CONSTANTS.DEBOUNCE_DELAY);\n  }, [calculateOptimalDisplay, currentSize]);\n\n  // Recalculate when size or content changes\n  useEffect(() => {\n    debouncedRecalculate();\n  }, [currentSize, content, debouncedRecalculate]);\n\n  // Sync with external size changes\n  useEffect(() => {\n    if (externalSize && (externalSize.width !== currentSize.width || externalSize.height !== currentSize.height)) {\n      setCurrentSize(externalSize);\n    }\n  }, [externalSize, currentSize]);\n\n  // Cleanup\n  useEffect(() => {\n    return () => {\n      if (resizeTimerRef.current) {\n        clearTimeout(resizeTimerRef.current);\n      }\n    };\n  }, []);\n\n  const handleDragStart = useCallback(() => {\n    setIsDragging(true);\n  }, []);\n\n  const handleDragStop = useCallback((e: DraggableEvent, data: DraggableData) => {\n    // Constrain position to reasonable workspace boundaries\n    const PAGE_WIDTH = 816;\n    const PAGE_HEIGHT = 1056;\n    const MARGIN = 20;\n    const ESTIMATED_BOX_HEIGHT = 150; // Use a safe estimate instead of boxSize.height\n    \n    // Allow multiple pages horizontally, constrain vertically to page height\n    const constrainedX = Math.max(MARGIN, Math.min(data.x, PAGE_WIDTH * 5)); // Up to 5 pages wide\n    const constrainedY = Math.max(MARGIN, Math.min(data.y, PAGE_HEIGHT - ESTIMATED_BOX_HEIGHT - MARGIN));\n    \n    setIsDragging(false);\n    onPositionChange({ x: constrainedX, y: constrainedY });\n    onSaveRequest();\n  }, [onPositionChange, onSaveRequest]);\n\n  const handleResize = useCallback((e: SyntheticEvent, { size }: ResizeCallbackData) => {\n    setCurrentSize(size);\n    onSizeChange(size);\n  }, [onSizeChange]);\n\n  const handleResizeStop = useCallback(() => {\n    onSaveRequest();\n  }, [onSaveRequest]);\n\n  // Calculate initial size if not provided\n  const initialSize = useMemo(() => {\n    if (externalSize) return externalSize;\n    \n    // Quick estimation for initial size\n    const wordCount = content.split(/\\s+/).length;\n    const hasComplexMath = /\\\\[a-zA-Z]+|\\^|\\{|\\}|_/.test(content);\n    \n    let estimatedWidth = Math.min(maxWidth, Math.max(minWidth, Math.sqrt(wordCount) * 40));\n    let estimatedHeight = Math.min(maxHeight, Math.max(minHeight, wordCount * 2 + 100));\n    \n    if (hasComplexMath) {\n      estimatedHeight += 50;\n      estimatedWidth += 100;\n    }\n    \n    return { \n      width: Math.round(estimatedWidth), \n      height: Math.round(estimatedHeight) \n    };\n  }, [content, externalSize, maxWidth, minWidth, maxHeight, minHeight]);\n\n  // Use initial size if currentSize hasn't been set\n  const boxSize = currentSize.width > 0 ? currentSize : initialSize;\n\n  const borderColor = `hsl(${(boxNumber * 50) % 360}, 70%, 50%)`;\n\n  // Dynamic styles for content\n  const contentStyles = useMemo(() => ({\n    fontSize: `${optimalFontSize}px`,\n    lineHeight: contentLayout.lineHeight,\n    wordSpacing: contentLayout.wordSpacing,\n    letterSpacing: (contentLayout as any).letterSpacing || 'normal',\n    overflow: 'hidden',\n    textOverflow: 'clip',\n    wordWrap: 'break-word' as const,\n    overflowWrap: 'break-word' as const,\n    hyphens: 'auto' as const,\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'flex-start',\n    textAlign: 'left' as const,\n    width: '100%',\n    height: '100%',\n    padding: '0',\n    margin: '0',\n    color: 'black' // Set text color to black instead of white\n  }), [optimalFontSize, contentLayout]);\n\n  return (\n    <Draggable\n      position={isDragging ? undefined : position}\n      defaultPosition={isDragging ? position : undefined}\n      onStart={handleDragStart}\n      onStop={handleDragStop}\n      grid={[5, 5]}\n      handle=\".drag-handle\"\n      disabled={isGridMode}\n    >\n      <div \n        className=\"absolute\" \n        style={{ \n          width: `${boxSize.width}px`,\n          height: `${boxSize.height}px`\n        }}\n        role=\"region\"\n        aria-label={`Math box ${boxNumber}: ${title}`}\n        onClick={onClick}\n      >\n        <ResizableBox\n          width={boxSize.width}\n          height={boxSize.height}\n          minConstraints={[minWidth, minHeight]}\n          maxConstraints={[maxWidth, maxHeight]}\n          onResize={handleResize}\n          onResizeStop={handleResizeStop}\n          resizeHandles={['se']}\n          className={`relative group ${isSelected ? 'ring-2 ring-blue-500' : ''}`}\n        >\n          <div \n            className={`w-full h-full bg-gradient-to-br ${color} rounded-lg border shadow-sm hover:shadow-md transition-all duration-200 relative`} \n            style={{ borderColor: '#e2e8f0', borderWidth: '1px' }}\n          >\n            <div \n              className=\"drag-handle w-full h-full cursor-move\"\n              role=\"button\"\n              aria-label={`Drag to move box ${boxNumber}`}\n              tabIndex={0}\n            >\n              {/* Clean Title Header */}\n              <div className=\"flex items-center justify-between p-3 border-b border-gray-200\">\n                <h4 className=\"font-medium text-gray-800 text-sm truncate select-none\">\n                  {title}\n                </h4>\n                <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex items-center space-x-1\">\n                  {onEdit && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      className=\"h-5 w-5 p-0 text-gray-400 hover:text-gray-600\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onEdit();\n                      }}\n                    >\n                      <Edit3 className=\"w-3 h-3\" />\n                    </Button>\n                  )}\n                  {onDelete && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      className=\"h-5 w-5 p-0 text-gray-400 hover:text-red-600\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onDelete();\n                      }}\n                    >\n                      <Trash2 className=\"w-3 h-3\" />\n                    </Button>\n                  )}\n                </div>\n              </div>\n              \n              {/* Content Container - Math formulas centered */}\n              <div \n                className=\"relative flex items-center justify-center p-4\"\n                style={{ \n                  height: `${boxSize.height - SIZING_CONSTANTS.TITLE_HEIGHT}px`,\n                  overflow: 'hidden'\n                }}\n              >\n                <div \n                  ref={contentRef}\n                  className=\"text-center\"\n                  style={{\n                    fontSize: `${optimalFontSize}px`,\n                    lineHeight: contentLayout.lineHeight,\n                    color: 'black',\n                    fontFamily: 'serif'\n                  }}\n                  onClick={(e) => e.stopPropagation()}\n                  role=\"region\"\n                  aria-label=\"Math content\"\n                  dangerouslySetInnerHTML={{ __html: content }}\n                />\n              </div>\n              \n              {/* Bottom right resize indicator - only visible on hover */}\n              <div className=\"absolute bottom-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                <div className=\"w-3 h-3 border-r-2 border-b-2 border-gray-300\"></div>\n              </div>\n            </div>\n          </div>\n        </ResizableBox>\n      </div>\n    </Draggable>\n  );\n}","size_bytes":13777},"client/src/components/chat-panel.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { getChatMessages, sendChatMessage } from '@/lib/openai';\nimport { ChatMessage } from '@shared/schema';\nimport { Bot, Send, User, Zap, AlertCircle } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface ChatPanelProps {\n  workspaceId: string;\n  workspaceType: 'document' | 'cheatsheet' | 'template';\n  onAIResponse?: (response: any) => void;\n  className?: string;\n  currentBoxes?: any[];\n}\n\nexport default function ChatPanel({ \n  workspaceId, \n  workspaceType, \n  onAIResponse, \n  className,\n  currentBoxes\n}: ChatPanelProps) {\n  const [message, setMessage] = useState('');\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const { data: messages = [], isLoading } = useQuery({\n    queryKey: ['/api/chat', workspaceType, workspaceId],\n    queryFn: () => getChatMessages(workspaceType, workspaceId),\n    enabled: !!workspaceId,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: (msg: string) => sendChatMessage(workspaceId, workspaceType, msg, currentBoxes),\n    onSuccess: (response) => {\n      console.log('Chat mutation success, calling onAIResponse with:', response);\n      queryClient.invalidateQueries({\n        queryKey: ['/api/chat', workspaceType, workspaceId],\n      });\n      if (onAIResponse) {\n        onAIResponse(response);\n      } else {\n        console.warn('onAIResponse callback is not defined');\n      }\n      setMessage('');\n    },\n    onError: (error: any) => {\n      console.error('Chat error:', error);\n      toast({\n        title: \"ChatGPT Error\",\n        description: error.message?.includes('quota') \n          ? \"API quota exceeded. Please check your OpenAI billing or try again later.\"\n          : \"Failed to send message. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (message.trim() && !sendMessageMutation.isPending) {\n      sendMessageMutation.mutate(message.trim());\n    }\n  };\n\n  const getWorkspaceTitle = () => {\n    switch (workspaceType) {\n      case 'document': return 'AI Assistant';\n      case 'cheatsheet': return 'Formula Assistant';\n      case 'template': return 'Template Filler';\n      default: return 'AI Assistant';\n    }\n  };\n\n  const getWorkspaceColor = () => {\n    switch (workspaceType) {\n      case 'document': return 'bg-blue-500';\n      case 'cheatsheet': return 'bg-purple-500';\n      case 'template': return 'bg-emerald-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  const getPlaceholder = () => {\n    switch (workspaceType) {\n      case 'document': return 'Ask ChatGPT...';\n      case 'cheatsheet': return 'Request formulas...';\n      case 'template': return 'Template instructions...';\n      default: return 'Type a message...';\n    }\n  };\n\n  return (\n    <div className={cn(\"w-[448px] bg-white border-l border-slate-200 flex flex-col\", className)}>\n      {/* Header */}\n      <div className=\"p-4 border-b border-slate-200\">\n        <div className=\"flex items-center space-x-2 mb-3\">\n          <div className={cn(\"w-6 h-6 rounded-full flex items-center justify-center\", getWorkspaceColor())}>\n            <Bot className=\"w-3 h-3 text-white\" />\n          </div>\n          <h3 className=\"font-semibold text-slate-900\">{getWorkspaceTitle()}</h3>\n          <div className=\"w-2 h-2 bg-green-400 rounded-full ml-auto\"></div>\n        </div>\n        <p className=\"text-sm text-slate-600\">\n          {workspaceType === 'document' && \"Ask questions and get formatted answers automatically inserted into your document.\"}\n          {workspaceType === 'cheatsheet' && \"Request mathematical formulas and they'll be added as draggable, resizable boxes with LaTeX rendering.\"}\n          {workspaceType === 'template' && \"AI fills specific template sections with properly formatted content.\"}\n        </p>\n      </div>\n\n      {/* Messages */}\n      <ScrollArea className=\"flex-1 p-4\">\n        <div className=\"space-y-4\">\n          {messages.map((msg: ChatMessage) => (\n            <div key={msg.id} className={cn(\"flex\", msg.role === 'user' ? \"justify-end\" : \"\")}>\n              <div className={cn(\n                \"max-w-xs p-3 rounded-lg\",\n                msg.role === 'user' \n                  ? cn(\"text-white\", getWorkspaceColor())\n                  : \"bg-slate-100\"\n              )}>\n                <div className=\"flex items-start space-x-2\">\n                  {msg.role === 'assistant' && <Bot className=\"w-4 h-4 mt-0.5 text-slate-600\" />}\n                  {msg.role === 'user' && <User className=\"w-4 h-4 mt-0.5 text-white\" />}\n                  <div>\n                    <p className=\"text-sm\">{\n                      msg.role === 'assistant' \n                        ? (() => {\n                            try {\n                              const parsed = JSON.parse(msg.content);\n                              return parsed.content || parsed.message || msg.content;\n                            } catch {\n                              return msg.content;\n                            }\n                          })()\n                        : msg.content\n                    }</p>\n                    {msg.role === 'assistant' && (\n                      <div className=\"bg-green-50 border border-green-200 p-2 rounded text-xs text-green-800 mt-2\">\n                        <Zap className=\"w-3 h-3 inline mr-1\" />\n                        Content processed & formatted\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))}\n          \n          {sendMessageMutation.isPending && (\n            <div className=\"flex\">\n              <div className=\"bg-slate-100 p-3 rounded-lg max-w-xs\">\n                <div className=\"flex items-center space-x-2\">\n                  <Bot className=\"w-4 h-4 text-slate-600\" />\n                  <div className=\"flex space-x-1\">\n                    <div className=\"w-2 h-2 bg-slate-400 rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-slate-400 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                    <div className=\"w-2 h-2 bg-slate-400 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </ScrollArea>\n\n      {/* Input */}\n      <div className=\"p-4 border-t border-slate-200\">\n        <form onSubmit={handleSubmit} className=\"flex space-x-2\">\n          <Input\n            type=\"text\"\n            placeholder={getPlaceholder()}\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            className=\"flex-1 text-sm\"\n            disabled={sendMessageMutation.isPending}\n          />\n          <Button\n            type=\"submit\"\n            disabled={!message.trim() || sendMessageMutation.isPending}\n            className={cn(\"\", getWorkspaceColor())}\n          >\n            <Send className=\"w-4 h-4\" />\n          </Button>\n        </form>\n        {workspaceType === 'cheatsheet' && messages.length === 0 && (\n          <div className=\"mt-3 space-y-2\">\n            <div className=\"text-xs text-slate-600 mb-1\">Quick suggestions:</div>\n            <div className=\"space-y-1\">\n              <button \n                onClick={() => setMessage(\"Give me 50 essential calculus formulas with LaTeX formatting\")}\n                className=\"w-full text-left text-xs p-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded transition-colors\"\n              >\n                50 Calculus Formulas\n              </button>\n              <button \n                onClick={() => setMessage(\"Give me 50 algebra and trigonometry formulas\")}\n                className=\"w-full text-left text-xs p-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded transition-colors\"\n              >\n                50 Algebra & Trig Formulas\n              </button>\n              <button \n                onClick={() => setMessage(\"Give me 50 physics formulas with units\")}\n                className=\"w-full text-left text-xs p-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded transition-colors\"\n              >\n                50 Physics Formulas\n              </button>\n            </div>\n          </div>\n        )}\n        <div className=\"flex items-center justify-between mt-2 text-xs text-slate-500\">\n          <span>Press Enter to send</span>\n          <span className=\"flex items-center\">\n            <Zap className=\"w-3 h-3 mr-1\" />\n            Auto-format enabled\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8945},"client/src/components/document-editor.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport LaTeXRenderer from './latex-renderer';\nimport { Bold, Italic, Underline, List, ListOrdered, SquareRadical, Code, Quote, AlignLeft, AlignCenter, AlignRight } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface DocumentEditorProps {\n  content: string;\n  onChange: (content: string) => void;\n  onAIContent?: (content: any) => void;\n  className?: string;\n}\n\nexport default function DocumentEditor({ \n  content, \n  onChange, \n  onAIContent, \n  className \n}: DocumentEditorProps) {\n  const [isPreview, setIsPreview] = useState(false);\n\n  useEffect(() => {\n    if (onAIContent) {\n      // Listen for AI responses and insert them into the document\n      const handleAIResponse = (response: any) => {\n        if (response.content) {\n          const newContent = content + '\\n\\n' + response.content;\n          onChange(newContent);\n        }\n      };\n      \n      // This would be called from the chat panel\n      (window as any).handleAIResponse = handleAIResponse;\n    }\n  }, [content, onChange, onAIContent]);\n\n  const insertText = (before: string, after = '') => {\n    const textarea = document.querySelector('textarea') as HTMLTextAreaElement;\n    if (!textarea) return;\n\n    const start = textarea.selectionStart;\n    const end = textarea.selectionEnd;\n    const selectedText = content.substring(start, end);\n    const newText = content.substring(0, start) + before + selectedText + after + content.substring(end);\n    \n    onChange(newText);\n    \n    // Reset cursor position\n    setTimeout(() => {\n      textarea.focus();\n      textarea.setSelectionRange(start + before.length, start + before.length + selectedText.length);\n    }, 0);\n  };\n\n  const insertLaTeX = () => {\n    insertText('$', '$');\n  };\n\n  const renderContent = (text: string) => {\n    // Simple markdown-like rendering with LaTeX support\n    const lines = text.split('\\n');\n    return lines.map((line, index) => {\n      if (line.startsWith('# ')) {\n        return <h1 key={index} className=\"text-3xl font-bold text-slate-900 mb-4\">{line.substring(2)}</h1>;\n      } else if (line.startsWith('## ')) {\n        return <h2 key={index} className=\"text-xl font-semibold text-slate-900 mb-3\">{line.substring(3)}</h2>;\n      } else if (line.includes('$')) {\n        // Handle inline LaTeX\n        const parts = line.split('$');\n        return (\n          <p key={index} className=\"text-slate-700 mb-2\">\n            {parts.map((part, partIndex) => \n              partIndex % 2 === 1 ? (\n                <LaTeXRenderer key={partIndex} content={part} className=\"mx-1\" />\n              ) : (\n                part\n              )\n            )}\n          </p>\n        );\n      } else if (line.trim()) {\n        return <p key={index} className=\"text-slate-700 mb-2\">{line}</p>;\n      } else {\n        return <br key={index} />;\n      }\n    });\n  };\n\n  return (\n    <div className={cn(\"flex-1 flex flex-col bg-white\", className)}>\n      {/* Toolbar */}\n      <div className=\"border-b border-slate-200 p-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => insertText('**', '**')}\n                className=\"p-2 hover:bg-slate-100\"\n              >\n                <Bold className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => insertText('*', '*')}\n                className=\"p-2 hover:bg-slate-100\"\n              >\n                <Italic className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => insertText('_', '_')}\n                className=\"p-2 hover:bg-slate-100\"\n              >\n                <Underline className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <div className=\"w-px h-6 bg-slate-300\"></div>\n            <div className=\"flex items-center space-x-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => insertText('- ', '')}\n                className=\"p-2 hover:bg-slate-100\"\n              >\n                <List className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => insertText('1. ', '')}\n                className=\"p-2 hover:bg-slate-100\"\n              >\n                <ListOrdered className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <div className=\"w-px h-6 bg-slate-300\"></div>\n            <div className=\"flex items-center space-x-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => insertText('`', '`')}\n                className=\"p-2 hover:bg-slate-100\"\n              >\n                <Code className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => insertText('> ', '')}\n                className=\"p-2 hover:bg-slate-100\"\n              >\n                <Quote className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <div className=\"w-px h-6 bg-slate-300\"></div>\n            <Button\n              onClick={insertLaTeX}\n              className=\"px-3 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors text-sm\"\n            >\n              <SquareRadical className=\"w-4 h-4 mr-2\" />\n              Insert LaTeX\n            </Button>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Button\n              variant={isPreview ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setIsPreview(!isPreview)}\n            >\n              {isPreview ? \"Edit\" : \"Preview\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Editor Content */}\n      <div className=\"flex-1 p-8 overflow-y-auto\">\n        {isPreview ? (\n          <div className=\"max-w-4xl mx-auto prose prose-slate\">\n            {renderContent(content)}\n          </div>\n        ) : (\n          <div className=\"max-w-4xl mx-auto\">\n            <Textarea\n              value={content}\n              onChange={(e) => onChange(e.target.value)}\n              placeholder=\"Start writing your document...\"\n              className=\"min-h-[500px] text-base leading-relaxed resize-none border-none focus:ring-0 bg-transparent\"\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":6845},"client/src/components/draggable-test.tsx":{"content":"import { useState } from 'react';\nimport Draggable from 'react-draggable';\n\nexport default function DraggableTest() {\n  const [position, setPosition] = useState({ x: 100, y: 100 });\n\n  const handleDragStop = (e: any, data: any) => {\n    setPosition({ x: data.x, y: data.y });\n  };\n\n  const moveToGrid = () => {\n    setPosition({ x: 300, y: 200 });\n  };\n\n  const moveToCorner = () => {\n    setPosition({ x: 50, y: 50 });\n  };\n\n  return (\n    <div style={{ width: '800px', height: '600px', border: '1px solid black', position: 'relative' }}>\n      <h3>Draggable Control Test</h3>\n      <p>Current position: ({position.x}, {position.y})</p>\n      \n      <button onClick={moveToGrid} style={{ margin: '5px' }}>\n        Move to (300, 200)\n      </button>\n      <button onClick={moveToCorner} style={{ margin: '5px' }}>\n        Move to (50, 50)\n      </button>\n\n      <Draggable\n        position={position}\n        onStop={handleDragStop}\n      >\n        <div style={{\n          width: '100px',\n          height: '100px',\n          backgroundColor: 'red',\n          border: '2px solid black',\n          position: 'absolute',\n          cursor: 'move',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          color: 'white',\n          fontWeight: 'bold'\n        }}>\n          TEST BOX\n        </div>\n      </Draggable>\n    </div>\n  );\n}","size_bytes":1377},"client/src/components/latex-renderer.tsx":{"content":"import { useEffect, useRef } from 'react';\nimport katex from 'katex';\nimport 'katex/dist/katex.min.css';\n\ninterface LaTeXRendererProps {\n  content: string;\n  displayMode?: boolean;\n  className?: string;\n}\n\nexport default function LaTeXRenderer({ content, displayMode = true, className = \"\" }: LaTeXRendererProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (containerRef.current && content) {\n      // Add delay to prevent race conditions when multiple boxes render simultaneously\n      const renderTimeout = setTimeout(() => {\n        if (!containerRef.current) return;\n        \n        // Check if content is mathematical notation or regular text\n        const isMathContent = content.includes('\\\\') || content.includes('=') || content.includes('^') || content.includes('_') || content.includes('frac') || content.match(/[∫∑∏∇αβγδεζηθικλμνξοπρστυφχψω]/);\n        \n        // If it's regular text, just display it normally with proper formatting\n        if (!isMathContent) {\n          // Preserve line breaks and spaces in text content\n          const formattedText = content\n            .replace(/\\n/g, '<br>')\n            .replace(/  /g, '&nbsp;&nbsp;')\n            .trim();\n          \n          // Handle different content types for optimal display\n          if (content.match(/\\.(jpg|jpeg|png|gif|svg|webp)/i)) {\n            // Image content - create responsive image display\n            containerRef.current.innerHTML = `<div style=\"width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;\"><img src=\"${content}\" style=\"max-width: 100%; max-height: 100%; object-fit: contain;\" alt=\"Content image\" /></div>`;\n          } else {\n            // Text content - preserve formatting\n            containerRef.current.innerHTML = `<span style=\"font-family: inherit; font-size: inherit; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word;\">${formattedText}</span>`;\n          }\n          return;\n        }\n        \n        // Process content for reliable rendering\n        let mathContent = content.trim();\n        \n        try {\n          // Clear previous content\n          containerRef.current.innerHTML = '';\n          \n          // Remove surrounding dollar signs\n          mathContent = mathContent.replace(/^\\$+|\\$+$/g, '');\n          mathContent = mathContent.replace(/^\\\\\\[|\\\\\\]$/g, '');\n          mathContent = mathContent.replace(/^\\\\\\(|\\\\\\)$/g, '');\n          \n          // Enhanced LaTeX cleaning for complex mathematical expressions\n          mathContent = mathContent.replace(/\\\\+$/, ''); // Remove trailing backslashes\n          mathContent = mathContent.replace(/\\\\\\s*$/, ''); // Remove trailing backslash with space\n          mathContent = mathContent.replace(/\\\\times/g, '\\\\cdot'); // Replace times with cdot\n          \n          // Fix problematic extstyle commands but preserve valid LaTeX\n          mathContent = mathContent.replace(/\\\\extstyle\\\\begin\\{displaystyle\\}/g, '\\\\displaystyle'); // Fix malformed commands\n          mathContent = mathContent.replace(/\\\\extstyle/g, ''); // Remove invalid extstyle\n          mathContent = mathContent.replace(/\\\\begin\\{displaystyle\\}\\\\text\\{\\\\textup\\{/g, ''); // Remove nested text commands\n          mathContent = mathContent.replace(/\\\\end\\{displaystyle\\}/g, ''); // Remove end displaystyle\n          mathContent = mathContent.replace(/\\\\textstyle\\\\begin\\{displaystyle\\}/g, '\\\\displaystyle'); // Fix nested styles\n          \n          // Remove problematic text commands that break KaTeX\n          mathContent = mathContent.replace(/\\\\text\\{[^}]*\\}/g, ''); // Remove text commands (units)\n          mathContent = mathContent.replace(/\\\\mathrm\\{[^}]*\\}/g, ''); // Remove mathrm commands\n          mathContent = mathContent.replace(/\\\\textup\\{[^}]*\\}/g, ''); // Remove textup commands\n          mathContent = mathContent.replace(/\\([^)]*Units[^)]*\\)/g, ''); // Remove units in parentheses\n          \n          // Remove unit annotations in parentheses with various spacing patterns\n          mathContent = mathContent.replace(/\\s*,\\s*\\([^)]*\\)/g, ''); // Remove \", (N)\" style units\n          mathContent = mathContent.replace(/\\s*\\\\\\,\\s*\\([^)]*\\)/g, ''); // Remove \"\\, (N)\" style units  \n          mathContent = mathContent.replace(/\\s*\\\\,\\s*\\([^)]*\\)/g, ''); // Remove \"\\, (N)\" style units\n          mathContent = mathContent.replace(/\\s*\\([^)]*\\)\\s*$/g, ''); // Remove trailing unit parentheses\n          \n          // Fix common notation issues that cause KaTeX errors\n          mathContent = mathContent.replace(/\\\\Phi/g, '\\\\phi');\n          mathContent = mathContent.replace(/\\\\_/g, '_'); // Fix escaped underscores\n          mathContent = mathContent.replace(/\\\\left\\(/g, '('); // Simplify left/right delimiters\n          mathContent = mathContent.replace(/\\\\right\\)/g, ')');\n          mathContent = mathContent.replace(/\\\\left\\[/g, '[');\n          mathContent = mathContent.replace(/\\\\right\\]/g, ']');\n          mathContent = mathContent.replace(/\\\\left\\{/g, '\\\\{');\n          mathContent = mathContent.replace(/\\\\right\\}/g, '\\\\}');\n          \n          // Handle vector notation issues more aggressively\n          mathContent = mathContent.replace(/\\\\vec\\{([^}]*)\\}/g, '\\\\mathbf{$1}'); // Use mathbf instead of vec\n          mathContent = mathContent.replace(/\\\\mathbf\\{([^}]*)\\}/g, '$1'); // Remove mathbf entirely\n          mathContent = mathContent.replace(/\\\\nabla_([a-zA-Z])/g, '\\\\nabla_$1'); // Fix subscript nabla\n          mathContent = mathContent.replace(/\\\\nabla\\s*\\\\cdot/g, 'div'); // Replace nabla dot with div\n          mathContent = mathContent.replace(/\\\\nabla\\s*\\\\times/g, 'curl'); // Replace nabla cross with curl\n          mathContent = mathContent.replace(/\\\\nabla/g, '\\\\nabla'); // Keep simple nabla\n          \n          // Clean up extra spaces but preserve essential LaTeX structure\n          mathContent = mathContent.replace(/\\s+/g, ' ').trim();\n          \n          // Render the math with KaTeX - add retry logic\n          const attemptRender = (attempt = 1) => {\n            try {\n              katex.render(mathContent, containerRef.current!, {\n                displayMode: displayMode,\n                throwOnError: false,\n                strict: false,\n                trust: true,\n                errorColor: '#666',\n                output: 'html',\n                fleqn: false,\n                macros: {\n                  \"\\\\cdot\": \"\\\\cdot\",\n                  \"\\\\times\": \"\\\\times\", \n                  \"\\\\div\": \"\\\\div\",\n                  \"\\\\grad\": \"\\\\nabla\",\n                  \"\\\\curl\": \"\\\\nabla \\\\times\",\n                  \"\\\\divergence\": \"\\\\nabla \\\\cdot\"\n                }\n              });\n              \n              console.log(`LaTeX rendered successfully on attempt ${attempt}:`, mathContent);\n            } catch (renderError) {\n              console.error(`LaTeX render attempt ${attempt} failed:`, renderError, 'Content:', mathContent);\n              \n              if (attempt < 3) {\n                // Retry with slight delay\n                setTimeout(() => attemptRender(attempt + 1), 50 * attempt);\n              } else {\n                // Final fallback after 3 attempts - show simplified math\n                if (containerRef.current) {\n                  // Create a more readable fallback by simplifying the LaTeX\n                  let simplifiedMath = mathContent\n                    .replace(/\\\\frac\\{([^}]*)\\}\\{([^}]*)\\}/g, '($1)/($2)') // Convert fractions\n                    .replace(/\\\\partial/g, '∂') // Replace partial symbol\n                    .replace(/\\\\nabla\\s*\\\\cdot/g, 'div') // Replace nabla dot\n                    .replace(/\\\\nabla\\s*\\\\times/g, 'curl') // Replace nabla cross\n                    .replace(/\\\\nabla/g, '∇') // Replace nabla\n                    .replace(/\\\\cdot/g, '·') // Replace cdot\n                    .replace(/\\\\mathbf\\{([^}]*)\\}/g, '$1') // Remove mathbf\n                    .replace(/\\\\[a-zA-Z]+\\{([^}]*)\\}/g, '$1') // Remove other commands\n                    .replace(/\\\\[a-zA-Z]+/g, '') // Remove standalone commands\n                    .replace(/[{}]/g, '') // Remove braces\n                    .replace(/\\s+/g, ' ') // Clean up spaces\n                    .trim();\n                  \n                  containerRef.current.innerHTML = `<span style=\"font-family: 'Times New Roman', serif; font-size: 14px; color: #666; font-style: italic;\">${simplifiedMath}</span>`;\n                }\n              }\n            }\n          };\n          \n          attemptRender();\n          \n        } catch (error) {\n          console.error('LaTeX preprocessing failed:', error, 'Content:', content);\n          if (containerRef.current) {\n            containerRef.current.textContent = content;\n          }\n        }\n      }, Math.random() * 100); // Random delay 0-100ms to prevent simultaneous rendering\n      \n      return () => clearTimeout(renderTimeout);\n    }\n  }, [content, displayMode]);\n\n  return (\n    <div \n      ref={containerRef} \n      className={`latex-content ${className}`}\n      style={{ \n        minHeight: '20px',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        textAlign: 'center'\n      }}\n    />\n  );\n}\n","size_bytes":9273},"client/src/components/workspace-sidebar.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useQuery } from '@tanstack/react-query';\nimport { Plus, MessageSquare, FileText, Grid3X3, FileSpreadsheet, Trash2 } from 'lucide-react';\nimport { Link, useLocation } from 'wouter';\nimport { cn } from '@/lib/utils';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface WorkspaceSidebarProps {\n  workspaceType: 'document' | 'cheatsheet' | 'template';\n  currentWorkspaceId?: string;\n  onNewWorkspace: () => void;\n}\n\ninterface WorkspaceItem {\n  id: string;\n  title: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function WorkspaceSidebar({ \n  workspaceType, \n  currentWorkspaceId, \n  onNewWorkspace \n}: WorkspaceSidebarProps) {\n  const [location] = useLocation();\n\n  // Fetch workspace list based on type\n  const { data: workspaces = [], isLoading } = useQuery({\n    queryKey: [`/api/${workspaceType}s`],\n    queryFn: async () => {\n      const response = await apiRequest('GET', `/api/${workspaceType}s`);\n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  const getWorkspaceIcon = () => {\n    switch (workspaceType) {\n      case 'document': return FileText;\n      case 'cheatsheet': return Grid3X3;\n      case 'template': return FileSpreadsheet;\n      default: return MessageSquare;\n    }\n  };\n\n  const getWorkspaceTitle = () => {\n    switch (workspaceType) {\n      case 'document': return 'Documents';\n      case 'cheatsheet': return 'Cheat Sheets';\n      case 'template': return 'Templates';\n      default: return 'Workspaces';\n    }\n  };\n\n  const getNewWorkspaceText = () => {\n    switch (workspaceType) {\n      case 'document': return 'New document';\n      case 'cheatsheet': return 'New cheat sheet';\n      case 'template': return 'New template';\n      default: return 'New workspace';\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffInDays = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));\n    \n    if (diffInDays === 0) return 'Today';\n    if (diffInDays === 1) return 'Yesterday';\n    if (diffInDays < 7) return `${diffInDays} days ago`;\n    return date.toLocaleDateString();\n  };\n\n  const Icon = getWorkspaceIcon();\n\n  return (\n    <div className=\"w-64 bg-slate-900 text-white flex flex-col h-screen\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-slate-700\">\n        <div className=\"flex items-center space-x-2 mb-4\">\n          <Icon className=\"w-5 h-5\" />\n          <h2 className=\"font-semibold\">{getWorkspaceTitle()}</h2>\n        </div>\n        \n        <Button \n          onClick={onNewWorkspace}\n          className=\"w-full bg-slate-800 hover:bg-slate-700 border border-slate-600 text-white\"\n          size=\"sm\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {getNewWorkspaceText()}\n        </Button>\n      </div>\n\n      {/* Workspace List */}\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-2\">\n          {isLoading ? (\n            <div className=\"text-slate-400 text-sm p-2\">Loading...</div>\n          ) : !Array.isArray(workspaces) || workspaces.length === 0 ? (\n            <div className=\"text-slate-400 text-sm p-2\">\n              No {workspaceType}s yet. Create one to get started!\n            </div>\n          ) : (\n            <div className=\"space-y-1\">\n              {Array.isArray(workspaces) && workspaces.map((workspace: WorkspaceItem) => (\n                <Link\n                  key={workspace.id}\n                  href={`/${workspaceType}/${workspace.id}`}\n                  className={cn(\n                    'block px-3 py-2 rounded-lg text-sm hover:bg-slate-800 transition-colors cursor-pointer group',\n                    currentWorkspaceId === workspace.id && 'bg-slate-800'\n                  )}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium truncate\">\n                        {workspace.title || `Untitled ${workspaceType}`}\n                      </div>\n                      <div className=\"text-xs text-slate-400\">\n                        {formatDate(workspace.updatedAt)}\n                      </div>\n                    </div>\n                    <div className=\"opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        className=\"w-6 h-6 p-0 text-slate-400 hover:text-red-400\"\n                        onClick={async (e) => {\n                          e.preventDefault();\n                          e.stopPropagation();\n                          if (confirm(`Delete ${workspace.title}?`)) {\n                            try {\n                              await apiRequest('DELETE', `/api/${workspaceType}s/${workspace.id}`);\n                              // Refresh the list after deletion\n                              window.location.reload();\n                            } catch (error) {\n                              console.error('Delete failed:', error);\n                            }\n                          }\n                        }}\n                      >\n                        <Trash2 className=\"w-3 h-3\" />\n                      </Button>\n                    </div>\n                  </div>\n                </Link>\n              ))}\n            </div>\n          )}\n        </div>\n      </ScrollArea>\n\n      {/* Footer */}\n      <div className=\"p-4 border-t border-slate-700\">\n        <div className=\"text-xs text-slate-400\">\n          StudyFlow - Academic Productivity Platform\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5846},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/openai.ts":{"content":"export async function sendChatMessage(\n  workspaceId: string,\n  workspaceType: string,\n  message: string,\n  currentBoxes?: any[]\n) {\n  const response = await fetch('/api/chat', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      workspaceId,\n      workspaceType,\n      message,\n      currentBoxes,\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to send chat message');\n  }\n\n  return response.json();\n}\n\nexport async function getChatMessages(workspaceType: string, workspaceId: string) {\n  const response = await fetch(`/api/chat/${workspaceType}/${workspaceId}`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to fetch chat messages');\n  }\n\n  return response.json();\n}\n","size_bytes":794},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/cheatsheet-workspace.tsx":{"content":"import { useState, useEffect, useCallback, useRef } from 'react';\nimport Draggable from 'react-draggable';\nimport { ResizableBox } from 'react-resizable';\nimport 'react-resizable/css/styles.css';\nimport { useParams, Link, useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { ArrowLeft, Save, Printer, Plus, Grid3X3, Clock, SquareArrowOutUpLeft, RotateCcw } from 'lucide-react';\nimport ChatPanel from '@/components/chat-panel';\nimport LaTeXRenderer from '@/components/latex-renderer';\nimport AutoResizeMathBox from '@/components/auto-resize-math-box';\nimport DraggableTest from '@/components/draggable-test';\nimport WorkspaceSidebar from '@/components/workspace-sidebar';\nimport { CheatSheet, CheatSheetBox } from '@shared/schema';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\n\nexport default function CheatSheetWorkspace() {\n  const { id } = useParams();\n  const [, navigate] = useLocation();\n  const [currentSheet, setCurrentSheet] = useState<CheatSheet | null>(null);\n  const [boxes, setBoxes] = useState<CheatSheetBox[]>([]);\n  const [boxPositions, setBoxPositions] = useState<Record<string, { x: number; y: number }>>({});\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const updateBoxPosition = useCallback((id: string, position: { x: number; y: number }) => {\n    setBoxPositions(prev => ({ ...prev, [id]: position }));\n    setBoxes(currentBoxes => \n      currentBoxes.map(box => \n        box.id === id ? { ...box, position } : box\n      )\n    );\n  }, []);\n\n  // Fetch cheat sheets list\n  const { data: cheatSheets = [] } = useQuery({\n    queryKey: ['/api/cheatsheets'],\n  });\n\n  // Fetch current cheat sheet\n  const { data: cheatSheet } = useQuery({\n    queryKey: ['/api/cheatsheets', id],\n    enabled: !!id,\n  });\n\n  useEffect(() => {\n    if (cheatSheet) {\n      setCurrentSheet(cheatSheet as CheatSheet);\n      const loadedBoxes = Array.isArray((cheatSheet as CheatSheet).boxes) ? (cheatSheet as CheatSheet).boxes as CheatSheetBox[] : [];\n      setBoxes(loadedBoxes);\n      \n      // Initialize positions for loaded boxes if not already set\n      const newPositions: Record<string, { x: number; y: number }> = {};\n      loadedBoxes.forEach((box, index) => {\n        if (box.position) {\n          newPositions[box.id] = box.position;\n        } else {\n          // Calculate initial grid position\n          const boxIndex = index % 15; // 15 boxes per page\n          newPositions[box.id] = {\n            x: 40 + (boxIndex % 3) * 200,\n            y: 60 + Math.floor(boxIndex / 3) * 150\n          };\n        }\n      });\n      setBoxPositions(prev => ({ ...prev, ...newPositions }));\n    } else if (!id && Array.isArray(cheatSheets) && cheatSheets.length > 0) {\n      const firstSheet = cheatSheets[0] as CheatSheet;\n      setCurrentSheet(firstSheet);\n      setBoxes(Array.isArray(firstSheet.boxes) ? firstSheet.boxes as CheatSheetBox[] : []);\n    }\n  }, [cheatSheet, cheatSheets, id]);\n\n  // Create new cheat sheet\n  const createSheetMutation = useMutation({\n    mutationFn: () => apiRequest('POST', '/api/cheatsheets', {\n      title: 'New Cheat Sheet',\n      boxes: []\n    }),\n    onSuccess: async (response) => {\n      const newSheet = await response.json();\n      queryClient.invalidateQueries({ queryKey: ['/api/cheatsheets'] });\n      setCurrentSheet(newSheet);\n      setBoxes([]);\n      navigate(`/cheatsheet/${newSheet.id}`);\n    },\n  });\n\n  // Save cheat sheet\n  const saveSheetMutation = useMutation({\n    mutationFn: () => {\n      if (!currentSheet) throw new Error('No cheat sheet selected');\n      return apiRequest('PUT', `/api/cheatsheets/${currentSheet.id}`, {\n        boxes,\n        updatedAt: new Date()\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/cheatsheets'] });\n      toast({\n        title: \"Cheat sheet saved\",\n        description: \"Your cheat sheet has been saved successfully.\",\n      });\n    },\n  });\n\n  const handlePrint = () => {\n    if (boxes.length === 0) {\n      toast({\n        title: \"Nothing to print\",\n        description: \"Please add some content first.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Create a printable version\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      printWindow.document.write(`\n        <html>\n          <head>\n            <title>${currentSheet?.title || 'Cheat Sheet'}</title>\n            <style>\n              body { font-family: Arial, sans-serif; margin: 20px; }\n              .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }\n              .box { border: 2px solid #ccc; border-radius: 8px; padding: 16px; break-inside: avoid; }\n              .title { font-weight: bold; margin-bottom: 8px; color: #333; }\n              .content { font-size: 14px; line-height: 1.4; }\n              @media print { body { margin: 10px; } .box { page-break-inside: avoid; } }\n            </style>\n          </head>\n          <body>\n            <h1>${currentSheet?.title || 'Cheat Sheet'}</h1>\n            <div class=\"grid\">\n              ${boxes.map(box => `\n                <div class=\"box\">\n                  <div class=\"title\">${box.title}</div>\n                  <div class=\"content\">${box.content}</div>\n                </div>\n              `).join('')}\n            </div>\n          </body>\n        </html>\n      `);\n      printWindow.document.close();\n      printWindow.print();\n    }\n\n    toast({\n      title: \"Opening print dialog\",\n      description: \"Your cheat sheet is ready to print.\",\n    });\n  };\n\n  // Responsive masonry layout configuration\n  const [layoutDensity, setLayoutDensity] = useState<'compact' | 'balanced' | 'spacious'>('balanced');\n  const [boxesPerPage, setBoxesPerPage] = useState(12);\n  \n  const LAYOUT_CONFIG = {\n    pageWidth: 620,\n    pageHeight: 800,\n    margin: 30,\n    minBoxWidth: 160,\n    maxBoxWidth: 420,\n    minBoxHeight: 90,\n    maxBoxHeight: 380,\n    gutter: 12,\n    get contentWidth() { return this.pageWidth - (2 * this.margin); },\n    get contentHeight() { return this.pageHeight - (2 * this.margin); },\n    get columns() { \n      // Dynamic columns based on content width and density\n      const densityFactors = { compact: 4, balanced: 3, spacious: 2 };\n      return Math.max(2, densityFactors[layoutDensity] || 3);\n    }\n  };\n\n  // Advanced content-aware size analysis\n  const analyzeBoxContent = useCallback((box: CheatSheetBox) => {\n    const content = box.content || '';\n    const hasImages = content.match(/\\.(jpg|jpeg|png|gif|svg|webp)/i);\n    const hasLongText = content.length > 200;\n    const isMultiLine = content.includes('\\n') || content.includes('<br>') || content.split(' ').length > 15;\n    const isMathFormula = content.includes('\\\\') || content.includes('=') || content.includes('^') || content.includes('frac');\n    const isComplexMath = content.includes('\\\\sum') || content.includes('\\\\int') || content.includes('\\\\sqrt') || content.includes('matrix');\n    \n    let optimalWidth, optimalHeight, shape;\n    \n    if (hasImages) {\n      // Wide rectangles for image content\n      optimalWidth = Math.min(400, Math.max(280, content.length * 2));\n      optimalHeight = Math.min(300, Math.max(200, 240));\n      shape = 'wide';\n    } else if (isComplexMath) {\n      // Wide boxes for complex mathematical expressions\n      optimalWidth = Math.min(360, Math.max(240, content.length * 3));\n      optimalHeight = Math.min(200, Math.max(140, 160));\n      shape = 'wide';\n    } else if (hasLongText && isMultiLine) {\n      // Tall rectangles for long text content\n      const lines = content.split(/\\n|<br>|\\. /).length;\n      optimalWidth = Math.min(280, Math.max(200, Math.sqrt(content.length) * 12));\n      optimalHeight = Math.min(400, Math.max(180, lines * 30 + 60));\n      shape = 'tall';\n    } else if (isMathFormula) {\n      // Square-ish for simple math formulas\n      optimalWidth = Math.min(240, Math.max(180, content.length * 2.5));\n      optimalHeight = Math.min(180, Math.max(120, 140));\n      shape = 'square';\n    } else {\n      // Square for standard short content\n      const baseSize = Math.min(220, Math.max(160, content.length * 1.8));\n      optimalWidth = baseSize;\n      optimalHeight = Math.min(160, Math.max(100, baseSize * 0.8));\n      shape = 'square';\n    }\n    \n    // Assign priority based on content complexity\n    let priority = 1;\n    if (isComplexMath) priority = 4;\n    else if (isMathFormula) priority = 3;\n    else if (hasImages) priority = 2;\n    else if (hasLongText) priority = 2;\n    \n    return {\n      width: Math.round(optimalWidth / 20) * 20, // Round to 20px increments\n      height: Math.round(optimalHeight / 20) * 20,\n      area: optimalWidth * optimalHeight,\n      aspectRatio: optimalWidth / optimalHeight,\n      shape,\n      contentType: isComplexMath ? 'complex-math' : isMathFormula ? 'math' : hasLongText ? 'long-text' : hasImages ? 'image' : 'standard',\n      priority\n    };\n  }, []);\n\n  // Fixed page-aware masonry layout with proper cross-page distribution\n  const calculateMasonryLayout = useCallback((allBoxes: CheatSheetBox[]) => {\n    const { pageWidth, pageHeight, margin, gutter, contentWidth, contentHeight, columns } = LAYOUT_CONFIG;\n    \n    if (allBoxes.length === 0) return [];\n    \n    // Calculate viewport positioning\n    const estimatedMiddlePanelWidth = window.innerWidth - 256 - 448;\n    const centerOffsetX = Math.max(20, (estimatedMiddlePanelWidth - pageWidth) / 2);\n    \n    // Analyze and size all boxes with consistent sizing\n    const boxesWithSizes = allBoxes.map(box => ({\n      ...box,\n      optimalSize: analyzeBoxContent(box)\n    }));\n    \n    // Use simple sequential placement instead of priority sorting to maintain order\n    const columnWidth = (contentWidth - (columns - 1) * gutter) / columns;\n    const positions: Array<{ x: number; y: number; width: number; height: number }> = [];\n    \n    // Track column heights across ALL pages globally\n    const allPageColumnHeights: Record<number, number[]> = {};\n    const maxContentPerPage = contentHeight - (2 * margin);\n    \n    // Calculate how many boxes per page based on average box height\n    const avgBoxHeight = 140; // Average expected box height\n    const boxesPerPageEstimate = Math.floor(maxContentPerPage / (avgBoxHeight + gutter)) * columns;\n    const totalPagesNeeded = Math.ceil(allBoxes.length / boxesPerPageEstimate);\n    \n    // Initialize all pages (up to 50+ pages as needed)\n    for (let p = 0; p < Math.max(1, totalPagesNeeded); p++) {\n      allPageColumnHeights[p] = new Array(columns).fill(margin);\n    }\n    \n    // Distribute boxes evenly across pages using round-robin column placement\n    allBoxes.forEach((box, boxIndex) => {\n      const optimalSize = boxesWithSizes[boxIndex].optimalSize;\n      const { width, height } = optimalSize;\n      \n      // Calculate which page this box should go on based on distribution\n      const targetPageIndex = Math.floor(boxIndex / boxesPerPageEstimate);\n      const pageIndex = Math.min(targetPageIndex, totalPagesNeeded - 1);\n      \n      // Get column heights for target page\n      const columnHeights = allPageColumnHeights[pageIndex];\n      \n      // Find shortest column on target page\n      let shortestColumn = 0;\n      let shortestHeight = columnHeights[0];\n      \n      for (let col = 1; col < columns; col++) {\n        if (columnHeights[col] < shortestHeight) {\n          shortestHeight = columnHeights[col];\n          shortestColumn = col;\n        }\n      }\n      \n      // Calculate position\n      const pageYBase = 60 + margin + (pageIndex * (pageHeight + 40));\n      const finalWidth = Math.min(width, columnWidth);\n      const x = centerOffsetX + margin + shortestColumn * (columnWidth + gutter);\n      const y = pageYBase + columnHeights[shortestColumn];\n      \n      // Ensure box fits within page boundaries\n      const maxY = pageYBase + contentHeight - height - margin;\n      const clampedY = Math.min(y, maxY);\n      \n      // Update column height for next box\n      columnHeights[shortestColumn] += height + gutter;\n      \n      // Store position\n      positions[boxIndex] = { \n        x, \n        y: clampedY, \n        width: finalWidth, \n        height \n      };\n    });\n    \n    return positions;\n  }, [layoutDensity, boxesPerPage, analyzeBoxContent]);\n\n  // Proper grid positioning within the scrollable canvas\n  const autoArrangeBoxes = useCallback(() => {\n    if (boxes.length === 0) return;\n    \n    console.log('Auto-arranging', boxes.length, 'boxes');\n    \n    // Use simple absolute positioning that works with Draggable\n    // The boxes are positioned within the scroll container which uses absolute positioning\n    // Calculate positions relative to the scroll container, not absolute positioning\n    const scrollContainer = document.querySelector('.overflow-auto');\n    if (!scrollContainer) {\n      console.log('Scroll container not found');\n      return;\n    }\n    \n    // Get page guide bounds to position relative to the page content\n    const pageGuide = scrollContainer.querySelector('.border-dashed.bg-white\\\\/50');\n    let baseX = 50; // Fallback\n    let baseY = 80; // Fallback\n    \n    if (pageGuide) {\n      const containerRect = scrollContainer.getBoundingClientRect();\n      const pageRect = pageGuide.getBoundingClientRect();\n      \n      // Position relative to the page guide within the scroll container\n      baseX = pageRect.left - containerRect.left + 40; // 40px margin from page edge\n      baseY = pageRect.top - containerRect.top + scrollContainer.scrollTop + 60; // Account for scroll\n      \n      console.log('Container positioning:', {\n        containerRect,\n        pageRect,\n        scrollTop: scrollContainer.scrollTop,\n        baseX,\n        baseY\n      });\n    }\n    \n    const boxWidth = 180;\n    const boxHeight = 120;\n    const spacingX = 20;\n    const spacingY = 20;\n    const columns = 3; // Fixed 3 columns for consistent layout\n    \n    console.log('Canvas positioning:', { baseX, baseY, columns });\n    \n    setBoxes(currentBoxes => {\n      return currentBoxes.map((box, index) => {\n        const row = Math.floor(index / columns);\n        const col = index % columns;\n        \n        const x = baseX + (col * (boxWidth + spacingX));\n        const y = baseY + (row * (boxHeight + spacingY));\n        \n        return {\n          ...box,\n          position: { x, y },\n          size: { width: boxWidth, height: boxHeight }\n        };\n      });\n    });\n  }, []);\n  \n  // Page boundary enforcement for new box creation\n  const findNextAvailablePosition = useCallback((contentAnalysis: any) => {\n    const { pageWidth, pageHeight, margin, gutter, contentWidth, contentHeight, columns } = LAYOUT_CONFIG;\n    const estimatedMiddlePanelWidth = window.innerWidth - 256 - 448;\n    const centerOffsetX = Math.max(20, (estimatedMiddlePanelWidth - pageWidth) / 2);\n    const columnWidth = (contentWidth - (columns - 1) * gutter) / columns;\n    \n    // Track column heights per page for placement algorithm\n    const pageColumnHeights: Record<number, number[]> = {};\n    \n    // Initialize all pages and analyze existing boxes\n    const totalPages = Math.max(1, Math.ceil(boxes.length / boxesPerPage));\n    for (let p = 0; p < totalPages + 1; p++) {\n      pageColumnHeights[p] = new Array(columns).fill(0);\n    }\n    \n    // Calculate existing box positions to update column heights\n    boxes.forEach(box => {\n      const pos = boxPositions[box.id];\n      if (pos) {\n        // Determine which page this box is on\n        const pageYBase = 60; // Base offset for first page\n        const pageIndex = Math.floor((pos.y - pageYBase) / (pageHeight + 40));\n        const relativeY = pos.y - (pageYBase + pageIndex * (pageHeight + 40));\n        \n        // Determine which column this box is in\n        const relativeX = pos.x - (centerOffsetX + margin);\n        const columnIndex = Math.floor(relativeX / (columnWidth + gutter));\n        \n        if (pageColumnHeights[pageIndex] && columnIndex >= 0 && columnIndex < columns) {\n          const boxHeight = box.size?.height || contentAnalysis.height;\n          pageColumnHeights[pageIndex][columnIndex] = Math.max(\n            pageColumnHeights[pageIndex][columnIndex],\n            relativeY + boxHeight + gutter\n          );\n        }\n      }\n    });\n    \n    // Find best position on any page\n    for (let pageIndex = 0; pageIndex <= totalPages; pageIndex++) {\n      const columnHeights = pageColumnHeights[pageIndex];\n      \n      // Find shortest column on this page\n      let shortestColumn = 0;\n      let shortestHeight = columnHeights[0];\n      \n      for (let col = 1; col < columns; col++) {\n        if (columnHeights[col] < shortestHeight) {\n          shortestHeight = columnHeights[col];\n          shortestColumn = col;\n        }\n      }\n      \n      // Check if box fits on this page\n      const wouldFitY = shortestHeight + contentAnalysis.height;\n      \n      if (wouldFitY <= contentHeight - margin) {\n        // Found a suitable position\n        const pageYBase = 60 + pageIndex * (pageHeight + 40);\n        return {\n          x: centerOffsetX + margin + shortestColumn * (columnWidth + gutter),\n          y: pageYBase + shortestHeight,\n          pageIndex\n        };\n      }\n    }\n    \n    // Fallback to new page if nothing fits\n    const newPageIndex = totalPages;\n    const pageYBase = 60 + newPageIndex * (pageHeight + 40);\n    return {\n      x: centerOffsetX + margin,\n      y: pageYBase,\n      pageIndex: newPageIndex\n    };\n  }, [boxes, boxPositions, boxesPerPage]);\n\n\n\n  // Calculate total pages based on box distribution\n  const calculateTotalPages = () => {\n    if (boxes.length === 0) return 1;\n    \n    const { contentHeight, margin } = LAYOUT_CONFIG;\n    const avgBoxHeight = 140;\n    const gutter = 20;\n    const columns = 3;\n    \n    const maxContentPerPage = contentHeight - (2 * margin);\n    const boxesPerPageEstimate = Math.floor(maxContentPerPage / (avgBoxHeight + gutter)) * columns;\n    \n    return Math.max(1, Math.ceil(boxes.length / boxesPerPageEstimate));\n  };\n  \n  const totalPages = calculateTotalPages();\n  \n  // Auto-arrange disabled since we're using direct positioning in render\n  // useEffect(() => {\n  //   if (boxes.length > 0) {\n  //     console.log('Triggering auto-arrange for', boxes.length, 'boxes');\n  //     \n  //     // Simple delay to ensure state is ready\n  //     const timer = setTimeout(() => {\n  //       autoArrangeBoxes();\n  //     }, 200);\n  //     return () => clearTimeout(timer);\n  //   }\n  // }, [boxes.length, autoArrangeBoxes]);\n\n  const handleAIResponse = useCallback((response: any) => {\n    console.log('AI Response received in handleAIResponse:', response);\n    \n    // Handle box operations (delete, edit, etc.)\n    if (response.operations && Array.isArray(response.operations)) {\n      setBoxes(currentBoxes => {\n        console.log('Processing operations, current boxes:', currentBoxes.length);\n        let updatedBoxes = [...currentBoxes];\n        \n        response.operations.forEach((operation: any) => {\n          const boxNumber = parseInt(operation.boxNumber);\n          const boxIndex = boxNumber - 1; // Convert to 0-based index\n          \n          switch (operation.type) {\n            case 'delete':\n              if (boxIndex >= 0 && boxIndex < updatedBoxes.length) {\n                updatedBoxes.splice(boxIndex, 1);\n              }\n              break;\n            case 'edit':\n            case 'replace':\n              if (boxIndex >= 0 && boxIndex < updatedBoxes.length) {\n                const existingBox = updatedBoxes[boxIndex];\n                updatedBoxes[boxIndex] = {\n                  ...existingBox,\n                  title: operation.title || existingBox.title,\n                  content: operation.content || existingBox.content\n                };\n              }\n              break;\n          }\n        });\n        \n        return updatedBoxes;\n      });\n      \n      // Trigger save after state update\n      setTimeout(() => saveSheetMutation.mutate(), 100);\n    }\n    // Handle new boxes creation with immediate smart layout\n    else if (response.boxes && Array.isArray(response.boxes)) {\n      console.log('Creating new boxes with smart layout:', response.boxes.length, 'boxes');\n      \n      setBoxes(currentBoxes => {\n        console.log('Current boxes before adding new ones:', currentBoxes.length);\n        \n        const newBoxes = response.boxes.map((box: any, index: number) => {\n          return {\n            id: `box-${Date.now()}-${index}`,\n            title: box.title || 'Formula',\n            content: box.content || '',\n            color: box.color || getRandomColor(),\n            position: { x: 0, y: 0 }, // Will be set by smart layout\n            size: { width: 200, height: 120 } // Will be set by smart layout\n          };\n        });\n        \n        const allBoxes = [...currentBoxes, ...newBoxes];\n        console.log('Final boxes count after adding:', allBoxes.length);\n        \n        // Apply smart layout immediately to all boxes\n        setTimeout(() => {\n          const layoutPositions = calculateMasonryLayout(allBoxes);\n          const newPositions: Record<string, { x: number; y: number }> = {};\n          \n          const finalBoxes = allBoxes.map((box, index) => {\n            const layout = layoutPositions[index];\n            if (layout) {\n              newPositions[box.id] = { x: layout.x, y: layout.y };\n              return {\n                ...box,\n                position: { x: layout.x, y: layout.y },\n                size: { width: layout.width, height: layout.height }\n              };\n            }\n            return box;\n          });\n          \n          setBoxes(finalBoxes);\n          setBoxPositions(newPositions);\n          saveSheetMutation.mutate();\n        }, 50);\n        \n        return allBoxes;\n      });\n    }\n    else {\n      console.log('No boxes or operations found in response:', response);\n    }\n  }, [saveSheetMutation]);\n\n\n\n  const updateBoxSize = useCallback((id: string, size: { width: number, height: number }) => {\n    setBoxes(prev => prev.map(box => \n      box.id === id \n        ? { ...box, size: { width: Math.max(200, size.width), height: Math.max(100, size.height) } }\n        : box\n    ));\n  }, []);\n\n  // Auto-resize is now handled by ResizeObserver in AutoResizeMathBox component\n  // This function is kept for compatibility but is no longer used for auto-sizing\n\n  // ChatGPT positioning commands handler  \n  const handleChatGPTPositioning = useCallback((command: string, boxId?: string, targetPage?: number, position?: string) => {\n    const { pageWidth, pageHeight, margin, contentWidth, contentHeight } = LAYOUT_CONFIG;\n    const estimatedMiddlePanelWidth = window.innerWidth - 256 - 448;\n    const centerOffsetX = Math.max(20, (estimatedMiddlePanelWidth - pageWidth) / 2);\n    \n    if (!boxId) return false;\n    \n    const targetPageIndex = (targetPage || 1) - 1; // Convert to 0-based index\n    const pageYBase = 60 + targetPageIndex * (pageHeight + 40);\n    \n    let newX = centerOffsetX + margin;\n    let newY = pageYBase + margin;\n    \n    // Parse position commands\n    if (position?.includes('top-right')) {\n      newX = centerOffsetX + contentWidth - 200; // Assume 200px box width\n      newY = pageYBase + margin;\n    } else if (position?.includes('bottom-left')) {\n      newX = centerOffsetX + margin;\n      newY = pageYBase + contentHeight - 150; // Assume 150px box height\n    } else if (position?.includes('center')) {\n      newX = centerOffsetX + contentWidth / 2 - 100;\n      newY = pageYBase + contentHeight / 2 - 75;\n    }\n    \n    // Apply position\n    setBoxPositions(prev => ({\n      ...prev,\n      [boxId]: { x: newX, y: newY }\n    }));\n    \n    return true;\n  }, []);\n\n  const debounceAndSave = useCallback(\n    (() => {\n      let timeoutId: NodeJS.Timeout;\n      return () => {\n        clearTimeout(timeoutId);\n        timeoutId = setTimeout(() => {\n          if (currentSheet) {\n            saveSheetMutation.mutate();\n          }\n        }, 1000);\n      };\n    })(),\n    [currentSheet, saveSheetMutation]\n  );\n\n  // Re-organize all boxes into proper grid layout\n  const autoFitAllBoxes = useCallback(() => {\n    // Simply trigger a re-render since boxes are now managed by CSS Grid\n    setBoxes(prev => [...prev]);\n    \n    toast({\n      title: \"Grid layout refreshed\",\n      description: \"All boxes positioned in structured 3-column grid layout.\",\n    });\n  }, [toast]);\n\n  // Advanced collision-free positioning with intelligent spacing and neat sequencing\n  const applySmartLayout = useCallback(() => {\n    if (boxes.length === 0) return;\n    \n    console.log('Applying collision-free smart layout to', boxes.length, 'boxes');\n    \n    const margin = LAYOUT_CONFIG.margin;\n    const spacingBuffer = 20; // Extra spacing between boxes to prevent touching\n    const gutter = LAYOUT_CONFIG.gutter + spacingBuffer;\n    const columns = LAYOUT_CONFIG.columns;\n    const estimatedMiddlePanelWidth = window.innerWidth - 256 - 448;\n    const centerOffsetX = Math.max(20, (estimatedMiddlePanelWidth - LAYOUT_CONFIG.pageWidth) / 2);\n    \n    // Calculate content-aware dimensions for all boxes first\n    const allBoxes = boxes.map(box => ({\n      ...box,\n      dimensions: analyzeBoxContent(box)\n    }));\n    \n    // Advanced collision detection and positioning algorithm\n    const placedBoxes: Array<{\n      id: string;\n      x: number;\n      y: number;\n      width: number;\n      height: number;\n      page: number;\n    }> = [];\n    \n    const newPositions: { [key: string]: { x: number; y: number } } = {};\n    const newSizes: { [key: string]: { width: number; height: number } } = {};\n    \n    // Helper function to check if two boxes collide with buffer zone\n    const hasCollision = (x1: number, y1: number, w1: number, h1: number, \n                         x2: number, y2: number, w2: number, h2: number): boolean => {\n      return !(x1 + w1 + spacingBuffer <= x2 || \n               x2 + w2 + spacingBuffer <= x1 || \n               y1 + h1 + spacingBuffer <= y2 || \n               y2 + h2 + spacingBuffer <= y1);\n    };\n    \n    // Helper function to find collision-free position with proper line wrapping\n    const findSafePosition = (box: any, targetPage: number): { x: number; y: number; page: number } => {\n      const pageTop = 20 + (targetPage * (LAYOUT_CONFIG.pageHeight + 40));\n      const pageContentTop = pageTop + margin;\n      const pageContentBottom = pageTop + LAYOUT_CONFIG.pageHeight - margin;\n      const pageContentLeft = centerOffsetX + margin;\n      const pageContentRight = centerOffsetX + LAYOUT_CONFIG.pageWidth - margin;\n      \n      // Flow-based positioning: left to right, then next line, like text\n      let currentY = pageContentTop;\n      \n      while (currentY + box.dimensions.height <= pageContentBottom) {\n        let currentX = pageContentLeft;\n        let lineMaxHeight = box.dimensions.height; // Track the tallest box on this line\n        \n        // Try to place boxes on current line from left to right\n        while (currentX + box.dimensions.width <= pageContentRight) {\n          // Check for collisions with existing boxes on this page\n          const hasAnyCollision = placedBoxes\n            .filter(placed => placed.page === targetPage)\n            .some(placed => hasCollision(currentX, currentY, box.dimensions.width, box.dimensions.height,\n                                       placed.x, placed.y, placed.width, placed.height));\n          \n          if (!hasAnyCollision) {\n            return { x: currentX, y: currentY, page: targetPage };\n          }\n          \n          // Find next available X position by checking existing boxes on this line\n          const boxesOnThisLine = placedBoxes.filter(placed => \n            placed.page === targetPage && \n            placed.y >= currentY && \n            placed.y < currentY + lineMaxHeight + spacingBuffer\n          );\n          \n          if (boxesOnThisLine.length > 0) {\n            // Find the rightmost box on this line and place after it\n            const rightmostBox = boxesOnThisLine.reduce((rightmost, current) => \n              current.x + current.width > rightmost.x + rightmost.width ? current : rightmost\n            );\n            currentX = rightmostBox.x + rightmostBox.width + spacingBuffer;\n            lineMaxHeight = Math.max(lineMaxHeight, rightmostBox.height);\n          } else {\n            // Move by box width if no collision but no space\n            currentX += box.dimensions.width + spacingBuffer;\n          }\n        }\n        \n        // Move to next line using the actual height of boxes on current line\n        currentY += lineMaxHeight + spacingBuffer;\n      }\n      \n      // If no space found on current page, move to next page\n      return findSafePosition(box, targetPage + 1);\n    };\n    \n    // Place each box in sequence with flow-based positioning (like text flow)\n    allBoxes.forEach((box, index) => {\n      // Start from page 0 and let the algorithm find the best position\n      const position = findSafePosition(box, 0);\n      \n      // Record the placed box\n      placedBoxes.push({\n        id: box.id,\n        x: position.x,\n        y: position.y,\n        width: box.dimensions.width,\n        height: box.dimensions.height,\n        page: position.page\n      });\n      \n      newPositions[box.id] = { x: position.x, y: position.y };\n      newSizes[box.id] = box.dimensions;\n    });\n    \n    // Update box positions and sizes\n    setBoxes(currentBoxes => {\n      return currentBoxes.map(box => {\n        const newPos = newPositions[box.id];\n        const newSize = newSizes[box.id];\n        if (newPos && newSize) {\n          return {\n            ...box,\n            position: newPos,\n            size: newSize\n          };\n        }\n        return box;\n      });\n    });\n    \n    // Update position state separately\n    setBoxPositions(newPositions);\n    \n    // Save changes\n    setTimeout(() => saveSheetMutation.mutate(), 100);\n    \n    toast({\n      title: \"Collision-free layout applied\",\n      description: `${boxes.length} boxes arranged with intelligent spacing and automatic collision avoidance.`,\n    });\n  }, [boxes, analyzeBoxContent, saveSheetMutation, toast]);\n\n\n\n  const getRandomColor = () => {\n    const colors = [\n      'from-blue-50 to-indigo-50 border-blue-200',\n      'from-green-50 to-emerald-50 border-green-200',\n      'from-purple-50 to-violet-50 border-purple-200',\n      'from-orange-50 to-red-50 border-orange-200',\n      'from-teal-50 to-cyan-50 border-teal-200',\n      'from-pink-50 to-rose-50 border-pink-200'\n    ];\n    return colors[Math.floor(Math.random() * colors.length)];\n  };\n\n  const formatTimeAgo = (date: Date | string) => {\n    const now = new Date();\n    const past = new Date(date);\n    const diffInHours = Math.floor((now.getTime() - past.getTime()) / (1000 * 60 * 60));\n    \n    if (diffInHours < 1) return 'Just now';\n    if (diffInHours < 24) return `${diffInHours}h ago`;\n    return `${Math.floor(diffInHours / 24)}d ago`;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-slate-200 px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-4\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"sm\">\n                <ArrowLeft className=\"w-4 h-4\" />\n              </Button>\n            </Link>\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 workspace-card-cheatsheet rounded-lg flex items-center justify-center\">\n                <Grid3X3 className=\"text-white text-sm\" />\n              </div>\n              <h1 className=\"text-xl font-bold text-slate-900\">Dynamic Cheat Sheet</h1>\n            </div>\n          </div>\n          <div className=\"flex items-center space-x-3\">\n            <Button \n              onClick={() => saveSheetMutation.mutate()}\n              disabled={saveSheetMutation.isPending}\n              className=\"bg-purple-600 hover:bg-purple-700\"\n            >\n              <Save className=\"w-4 h-4 mr-2\" />\n              Save Sheet\n            </Button>\n            <Button \n              variant=\"outline\"\n              onClick={handlePrint}\n              disabled={boxes.length === 0}\n            >\n              <Printer className=\"w-4 h-4 mr-2\" />\n              Print\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Three-pane layout */}\n      <div className=\"flex h-[calc(100vh-73px)]\">\n        {/* Left Panel: Workspace History */}\n        <WorkspaceSidebar\n          workspaceType=\"cheatsheet\"\n          currentWorkspaceId={currentSheet?.id}\n          onNewWorkspace={() => {\n            createSheetMutation.mutate();\n          }}\n        />\n\n        {/* Middle Panel: Cheat Sheet Content */}\n        <div className=\"flex-1 flex flex-col bg-white\">\n          {/* Sheet Controls */}\n          <div className=\"border-b border-slate-200 p-4\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-lg font-semibold text-slate-900\">\n                {currentSheet?.title || 'New Cheat Sheet'}\n              </h2>\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"flex items-center space-x-2 text-sm text-slate-600\">\n                  <span>{boxes.length} boxes</span>\n                  <span>•</span>\n                  <span>{Math.max(1, Math.ceil(boxes.length / boxesPerPage))} pages • {layoutDensity} density</span>\n                </div>\n                {boxes.length > 0 && (\n                  <div className=\"flex space-x-2 items-center\">\n                    <select \n                      value={layoutDensity} \n                      onChange={(e) => setLayoutDensity(e.target.value as 'compact' | 'balanced' | 'spacious')}\n                      className=\"text-xs px-2 py-1 border rounded\"\n                    >\n                      <option value=\"compact\">Compact</option>\n                      <option value=\"balanced\">Balanced</option>\n                      <option value=\"spacious\">Spacious</option>\n                    </select>\n                    <select \n                      value={boxesPerPage} \n                      onChange={(e) => setBoxesPerPage(parseInt(e.target.value))}\n                      className=\"text-xs px-2 py-1 border rounded\"\n                    >\n                      <option value=\"8\">8 per page</option>\n                      <option value=\"12\">12 per page</option>\n                      <option value=\"16\">16 per page</option>\n                      <option value=\"20\">20 per page</option>\n                    </select>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={applySmartLayout}\n                      className=\"text-xs gap-1\"\n                    >\n                      <RotateCcw className=\"h-3 w-3\" />\n                      Smart Layout\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n\n\n\n          {/* Cheat Sheet Content - Page-Constrained Layout */}\n          <div className=\"flex-1 relative bg-gray-100 overflow-auto scroll-smooth\">\n            {/* Page System with Visual Boundaries */}\n            <div className=\"relative\" style={{ minHeight: `${totalPages * (LAYOUT_CONFIG.pageHeight + 40) + 40}px` }}>\n              {/* Render page boundaries as visual guides - centered - support up to 50+ pages */}\n              {Array.from({ length: Math.max(1, Math.min(50, totalPages)) }, (_, pageIndex) => {\n                const estimatedMiddlePanelWidth = window.innerWidth - 256 - 448;\n                const centerOffsetX = Math.max(20, (estimatedMiddlePanelWidth - LAYOUT_CONFIG.pageWidth) / 2);\n                \n                return (\n                  <div\n                    key={pageIndex}\n                    className=\"absolute border-2 border-dashed border-gray-300 bg-white/50 rounded-lg\"\n                    style={{\n                      top: `${20 + pageIndex * (LAYOUT_CONFIG.pageHeight + 40)}px`,\n                      left: `${centerOffsetX}px`,\n                      width: `${LAYOUT_CONFIG.pageWidth}px`,\n                      height: `${LAYOUT_CONFIG.pageHeight}px`,\n                      zIndex: 0\n                    }}\n                  >\n                    {/* Page header */}\n                    <div className=\"absolute top-2 right-4 text-xs text-gray-400\">\n                      Page {pageIndex + 1} of {Math.max(1, totalPages)}\n                    </div>\n                    \n                    {/* Page margins guide */}\n                    <div \n                      className=\"absolute border border-blue-200 border-dashed\"\n                      style={{\n                        top: `${LAYOUT_CONFIG.margin}px`,\n                        left: `${LAYOUT_CONFIG.margin}px`,\n                        width: `${LAYOUT_CONFIG.pageWidth - (LAYOUT_CONFIG.margin * 2)}px`,\n                        height: `${LAYOUT_CONFIG.pageHeight - (LAYOUT_CONFIG.margin * 2)}px`\n                      }}\n                    />\n                  </div>\n                );\n              })}\n              \n              {/* Single container for all boxes with absolute positioning */}\n              <div className=\"absolute inset-0\" style={{ zIndex: 20 }}>\n                {boxes.map((box, boxIndex) => {\n                  // Use masonry layout positions or fallback positions\n                  const statePos = boxPositions[box.id];\n                  const fallbackPos = {\n                    x: 50 + (boxIndex % 3) * 200,\n                    y: 80 + Math.floor(boxIndex / 3) * 150\n                  };\n                  \n                  let actualPos = statePos || fallbackPos;\n                  let actualSize = box.size || { width: 200, height: 120 };\n                  \n                  // Apply content-aware sizing for new boxes\n                  if (!statePos) {\n                    const contentAnalysis = analyzeBoxContent(box);\n                    actualSize = { width: contentAnalysis.width, height: contentAnalysis.height };\n                    setBoxPositions(prev => ({ ...prev, [box.id]: actualPos }));\n                  }\n                  \n                  return (\n                    <div key={`box-container-${box.id}`}>\n                      <AutoResizeMathBox\n                        key={box.id}\n                        id={box.id}\n                        title={box.title}\n                        content={box.content}\n                        color={box.color}\n                        position={actualPos}\n                        size={actualSize}\n                        onPositionChange={(position) => updateBoxPosition(box.id, position)}\n                        onSizeChange={(size) => updateBoxSize(box.id, size)}\n                        onSaveRequest={debounceAndSave}\n                        boxNumber={boxIndex + 1}\n                        isGridMode={false}\n                      />\n                    </div>\n                  );\n                })}\n              </div>\n              \n              {/* Empty state when no boxes */}\n              {boxes.length === 0 && (\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                  <div className=\"text-center py-16 max-w-md\">\n                    <Grid3X3 className=\"w-16 h-16 mx-auto mb-4 text-slate-300\" />\n                    <h3 className=\"text-lg font-semibold text-slate-900 mb-2\">Empty Cheat Sheet</h3>\n                    <p className=\"text-slate-600 mb-4\">Ask the AI assistant to add formulas and content boxes</p>\n                    <div className=\"text-sm text-slate-500\">\n                      Try: \"Give me 50 essential math formulas\" or \"Add calculus derivatives\"\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel: ChatGPT */}\n        <ChatPanel\n          workspaceId={currentSheet?.id || 'new'}\n          workspaceType=\"cheatsheet\"\n          onAIResponse={handleAIResponse}\n          currentBoxes={boxes}\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":40434},"client/src/pages/document-workspace.tsx":{"content":"import { useState, useEffect, useRef, useCallback } from 'react';\nimport { useParams } from 'wouter';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\nimport TextAlign from '@tiptap/extension-text-align';\nimport Underline from '@tiptap/extension-underline';\nimport { Color } from '@tiptap/extension-color';\nimport { TextStyle } from '@tiptap/extension-text-style';\nimport { FontFamily } from '@tiptap/extension-font-family';\nimport Highlight from '@tiptap/extension-highlight';\nimport StandaloneDocumentEngine from '@/components/standalone-document-engine';\n\n// Extend Window interface for standalone document API\ndeclare global {\n  interface Window {\n    standaloneDocumentAPI?: {\n      print: () => void;\n      save: () => void;\n      exportPDF: () => void;\n      exportJSON: () => void;\n      formatText: (command: string) => void;\n      insertText: (text: string) => void;\n      getData: () => void;\n      clearContent: () => void;\n      setContent: (content: string) => void;\n    };\n  }\n}\n\n// Custom FontSize extension\nconst FontSize = TextStyle.extend({\n  name: 'fontSize',\n  addAttributes() {\n    return {\n      fontSize: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.style.fontSize?.replace('pt', ''),\n        renderHTML: (attributes: any) => {\n          if (!attributes.fontSize) return {}\n          return { style: `font-size: ${attributes.fontSize}pt` }\n        },\n      }\n    }\n  }\n});\nimport { Button } from '@/components/ui/button';\nimport { Separator } from '@/components/ui/separator';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Save, FileText, Bold, Italic, Underline as UnderlineIcon, \n  AlignLeft, AlignCenter, AlignRight, AlignJustify,\n  List, ListOrdered, ZoomIn, ZoomOut, Printer, Type, Palette, \n  Undo2, Redo2, History, MessageSquare, Plus, Clock, Send,\n  Edit3, Share, Trash2, Copy, Download, Eye, MoreVertical,\n  Brain, Sparkles, Command, ChevronDown, ChevronRight,\n  Strikethrough, Scissors, ClipboardPaste, Minus,\n  Indent, Outdent, Layout, Image, Table, Link, Settings, X, Wand2\n} from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Document, ChatSession, ChatMessage, DocumentCommand } from '@shared/schema';\nimport { useToast } from '@/hooks/use-toast';\nimport { LayoutEngine, createLayoutEngine } from '@/lib/layout-engine';\nimport { DocumentCommandInterface, createDocumentInterface } from '@/lib/document-commands';\n\n// Debounce function\nfunction debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): (...args: Parameters<T>) => void {\n  let timeout: NodeJS.Timeout;\n  return (...args: Parameters<T>) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func(...args), wait);\n  };\n}\n\n// Page sizes (in inches, converted to pixels at 96 DPI)\nconst PAGE_SIZES = {\n  'letter': { width: 816, height: 1056, name: 'Letter (8.5\" × 11\")' },\n  'legal': { width: 816, height: 1344, name: 'Legal (8.5\" × 14\")' },\n  'a4': { width: 794, height: 1123, name: 'A4 (8.27\" × 11.69\")' },\n  'a3': { width: 1123, height: 1587, name: 'A3 (11.69\" × 16.54\")' },\n  'tabloid': { width: 1056, height: 1632, name: 'Tabloid (11\" × 17\")' },\n  'executive': { width: 696, height: 1008, name: 'Executive (7.25\" × 10.5\")' },\n  'ledger': { width: 1632, height: 1056, name: 'Ledger (17\" × 11\")' },\n} as const;\n\nexport default function DocumentWorkspace() {\n  const { id } = useParams<{ id: string }>();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Document state\n  const [zoomLevel, setZoomLevel] = useState(100);\n  const [fontSize, setFontSize] = useState(12);\n  const [fontFamily, setFontFamily] = useState('Times New Roman');\n  const [textColor, setTextColor] = useState('#000000');\n  const [pageSize, setPageSize] = useState<keyof typeof PAGE_SIZES>('letter');\n  const [pageOrientation, setPageOrientation] = useState('portrait');\n  \n  // Ruler and margin states for Word-style functionality\n  const [leftMargin, setLeftMargin] = useState(96); // 1 inch in pixels at 96 DPI\n  const [rightMargin, setRightMargin] = useState(96); // 1 inch in pixels\n  const [topMargin, setTopMargin] = useState(96); // 1 inch in pixels\n  const [bottomMargin, setBottomMargin] = useState(96); // 1 inch in pixels\n  const [paragraphIndent, setParagraphIndent] = useState(0); // First line indent\n  const [hangingIndent, setHangingIndent] = useState(0); // Left indent for continuing lines\n  const [rulerUnit, setRulerUnit] = useState<'inches' | 'cm'>('inches');\n  const [isDraggingMarker, setIsDraggingMarker] = useState<string | null>(null);\n  \n  // AI Improve state\n  const [isAiImproving, setIsAiImproving] = useState(false);\n  const [autoSaveStatus, setAutoSaveStatus] = useState('saved'); // 'saving' | 'saved' | 'error'\n  const [documentStats, setDocumentStats] = useState({ words: 0, readTime: 0 });\n  const [currentPage, setCurrentPage] = useState(1);\n  \n  // Layout engine integration\n  const [layoutEngine, setLayoutEngine] = useState<LayoutEngine>(() => \n    createLayoutEngine(pageSize, fontSize)\n  );\n  const [documentInterface, setDocumentInterface] = useState<DocumentCommandInterface>(() => \n    createDocumentInterface('', pageSize, fontSize)\n  );\n  const [pageMetrics, setPageMetrics] = useState(() => \n    layoutEngine.getCurrentMetrics()\n  );\n  \n  // Chat state - simplified, always ready\n  const [chatInput, setChatInput] = useState('');\n  const [defaultSessionId, setDefaultSessionId] = useState<string | null>(null);\n  const [expandedSessions, setExpandedSessions] = useState<Set<string>>(new Set());\n\n  // Editor setup with extensive functionality - fallback for old system\n  const editor = useEditor({\n    extensions: [\n      StarterKit.configure({\n        heading: {\n          levels: [1, 2, 3],\n        },\n      }),\n      TextAlign.configure({\n        types: ['heading', 'paragraph'],\n      }),\n      Underline.configure({\n        HTMLAttributes: {\n          class: 'underline',\n        },\n      }),\n      Color,\n      FontFamily,\n      FontSize,\n      Highlight.configure({\n        multicolor: true,\n      }),\n    ],\n    content: '',\n    editorProps: {\n      attributes: {\n        class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none min-h-full w-full',\n        style: `font-family: ${fontFamily}; font-size: ${fontSize}pt; color: ${textColor}; line-height: 1.6;`,\n      },\n    },\n    onUpdate: ({ editor }) => {\n      // Auto-save document changes\n      debouncedSave();\n    },\n  });\n\n  // Document engine state for new pagination system\n  const [documentContent, setDocumentContent] = useState('');\n  const [useStandaloneEngine, setUseStandaloneEngine] = useState(true); // Switch to new engine\n\n  // Fetch document\n  const { data: document, isLoading: documentLoading } = useQuery<Document>({\n    queryKey: ['document', id],\n    queryFn: async () => {\n      const response = await fetch(`/api/documents/${id}`);\n      if (!response.ok) throw new Error('Failed to fetch document');\n      return response.json();\n    },\n    enabled: !!id,\n  });\n\n  // Fetch document history\n  const { data: documentHistory = [], refetch: refetchHistory } = useQuery({\n    queryKey: ['documentHistory', id],\n    queryFn: async () => {\n      const response = await fetch(`/api/documents/${id}/history`);\n      if (!response.ok) throw new Error('Failed to fetch document history');\n      return response.json();\n    },\n    enabled: !!id,\n  });\n\n  // Fetch chat sessions for this document\n  const { data: chatSessions = [], refetch: refetchSessions } = useQuery<ChatSession[]>({\n    queryKey: ['chatSessions', id],\n    queryFn: async () => {\n      const response = await fetch(`/api/documents/${id}/chat-sessions`);\n      if (!response.ok) throw new Error('Failed to fetch chat sessions');\n      return response.json();\n    },\n    enabled: !!id,\n  });\n\n  // Fetch messages for default session\n  const { data: chatMessages = [], refetch: refetchMessages } = useQuery<ChatMessage[]>({\n    queryKey: ['chatMessages', defaultSessionId],\n    queryFn: async () => {\n      const response = await fetch(`/api/chat-sessions/${defaultSessionId}/messages`);\n      if (!response.ok) throw new Error('Failed to fetch chat messages');\n      return response.json();\n    },\n    enabled: !!defaultSessionId,\n  });\n\n  // Create default session automatically when document loads\n  useEffect(() => {\n    if (document && !defaultSessionId && chatSessions.length === 0) {\n      createDefaultSession();\n    } else if (chatSessions.length > 0 && !defaultSessionId) {\n      setDefaultSessionId(chatSessions[0].id);\n    }\n  }, [document, chatSessions, defaultSessionId]);\n\n  // Create default chat session automatically\n  const createDefaultSession = async () => {\n    try {\n      const response = await fetch(`/api/documents/${id}/chat-sessions`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: `Chat Session ${new Date().toLocaleDateString()}`,\n          documentSnapshot: editor?.getHTML() || '<p></p>',\n        }),\n      });\n      if (response.ok) {\n        const session = await response.json();\n        setDefaultSessionId(session.id);\n        refetchSessions();\n      }\n    } catch (error) {\n      console.error('Failed to create default session:', error);\n    }\n  };\n\n  // Helper functions for standalone document engine communication\n  const sendToDocumentEngine = (type: string, data?: any) => {\n    const iframe = window.document.querySelector('iframe[title=\"Standalone Document Editor\"]') as HTMLIFrameElement;\n    if (iframe && iframe.contentWindow) {\n      iframe.contentWindow.postMessage({ type, data }, window.location.origin);\n    }\n  };\n\n  const getDocumentEngineContent = (): Promise<string> => {\n    return new Promise((resolve) => {\n      const handleMessage = (event: MessageEvent) => {\n        if (event.data.type === 'DOCUMENT_DATA') {\n          window.removeEventListener('message', handleMessage);\n          resolve(event.data.content || '');\n        }\n      };\n      window.addEventListener('message', handleMessage);\n      sendToDocumentEngine('GET_DOCUMENT');\n      \n      // Timeout fallback\n      setTimeout(() => {\n        window.removeEventListener('message', handleMessage);\n        resolve('');\n      }, 1000);\n    });\n  };\n\n  // Update document mutation\n  const updateDocumentMutation = useMutation({\n    mutationFn: async (updates: Partial<Document>) => {\n      const response = await fetch(`/api/documents/${id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updates),\n      });\n      if (!response.ok) throw new Error('Failed to update document');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['document', id] });\n    },\n  });\n\n  // Send chat message mutation with document command parsing\n  const sendMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      // If no default session, create one first\n      if (!defaultSessionId) {\n        await createDefaultSession();\n      }\n      \n      const currentContent = useStandaloneEngine ? documentContent : (editor?.getHTML() || '');\n      const response = await fetch(`/api/chat-sessions/${defaultSessionId}/messages`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          content: message, \n          documentContent: currentContent,\n          documentId: id \n        }),\n      });\n      if (!response.ok) throw new Error('Failed to send message');\n      return response.json();\n    },\n    onSuccess: (response: any) => {\n      refetchMessages();\n      setChatInput('');\n      \n      // Execute document commands if any (now supporting multiple commands)\n      if (response.documentCommands && Array.isArray(response.documentCommands)) {\n        response.documentCommands.forEach((command: DocumentCommand) => {\n          executeDocumentCommand(command);\n        });\n      } else if (response.documentCommand) {\n        // Backwards compatibility for single command\n        executeDocumentCommand(response.documentCommand);\n      }\n      \n      // Insert text response into document if it's content\n      if (response.insertText) {\n        if (useStandaloneEngine && window.standaloneDocumentAPI) {\n          window.standaloneDocumentAPI.insertText(response.insertText);\n        } else if (editor) {\n          if (response.insertAtEnd) {\n            editor.commands.focus('end');\n            editor.commands.insertContent(response.insertText);\n          } else {\n            editor.commands.focus();\n            editor.commands.insertContent(response.insertText);\n          }\n        }\n      }\n    },\n  });\n\n  // Execute document commands from ChatGPT\n  const executeDocumentCommand = useCallback((command: DocumentCommand) => {\n    // Support both standalone engine and TipTap editor\n    if (useStandaloneEngine && window.standaloneDocumentAPI) {\n      // Execute commands on standalone document engine\n      switch (command.type) {\n        case 'delete_page':\n        case 'clear_all':\n          window.standaloneDocumentAPI.clearContent();\n          toast({ title: `Document cleared` });\n          break;\n          \n        case 'add_text':\n          const { text: addText, position } = command.params;\n          if (addText) {\n            window.standaloneDocumentAPI.insertText(addText);\n            toast({ title: \"Text added to document\" });\n          }\n          break;\n          \n        case 'format_text':\n          const { text: formatText, formatting } = command.params;\n          if (formatText && formatting) {\n            if (formatting.bold) {\n              sendToDocumentEngine('FORMAT_TEXT', { command: 'bold' });\n            }\n            if (formatting.italic) {\n              sendToDocumentEngine('FORMAT_TEXT', { command: 'italic' });\n            }\n            if (formatting.underline) {\n              sendToDocumentEngine('FORMAT_TEXT', { command: 'underline' });\n            }\n            toast({ title: `Formatted text: \"${formatText}\"` });\n          }\n          break;\n          \n        case 'replace_text':\n          const { targetText, newText } = command.params;\n          if (targetText && newText) {\n            // Get current content and replace\n            getDocumentEngineContent().then((content) => {\n              const updatedContent = content.replace(new RegExp(targetText, 'gi'), newText);\n              if (window.standaloneDocumentAPI) {\n                window.standaloneDocumentAPI.setContent(updatedContent);\n              }\n              toast({ title: `Replaced \"${targetText}\" with \"${newText}\"` });\n            });\n          }\n          break;\n          \n        case 'delete_text':\n          const { text: deleteText } = command.params;\n          if (deleteText) {\n            getDocumentEngineContent().then((content) => {\n              const updatedContent = content.replace(new RegExp(deleteText, 'gi'), '');\n              if (window.standaloneDocumentAPI) {\n                window.standaloneDocumentAPI.setContent(updatedContent);\n              }\n              toast({ title: `Deleted text: \"${deleteText}\"` });\n            });\n          }\n          break;\n          \n        case 'center_text':\n          // For now, insert text with center styling hint\n          const { text: centerText } = command.params;\n          if (centerText) {\n            window.standaloneDocumentAPI.insertText(`[CENTER]${centerText}[/CENTER]`);\n            toast({ title: `Centered text: \"${centerText}\"` });\n          }\n          break;\n      }\n      \n      // Save changes after executing command\n      debouncedSave();\n      return;\n    }\n    \n    // Original TipTap editor commands\n    if (!editor) return;\n\n    switch (command.type) {\n      case 'delete_page':\n        // For simplicity, we'll clear content or remove sections\n        if (command.params.pageNumber === 1) {\n          editor.commands.clearContent();\n          toast({ title: `Page ${command.params.pageNumber} cleared` });\n        }\n        break;\n        \n      case 'center_text':\n        const { text: centerText } = command.params;\n        if (centerText) {\n          // Find and center the specific text using Tiptap commands\n          const content = editor.getHTML();\n          if (content.includes(centerText)) {\n            // Use Tiptap's search and select functionality\n            const doc = editor.state.doc;\n            let found = false;\n            \n            doc.descendants((node, pos) => {\n              if (found) return false;\n              \n              if (node.isText && node.text && node.text.includes(centerText)) {\n                const textStart = pos + node.text.indexOf(centerText);\n                const textEnd = textStart + centerText.length;\n                \n                // Select the text and center it\n                editor.chain()\n                  .focus()\n                  .setTextSelection({ from: textStart, to: textEnd })\n                  .setTextAlign('center')\n                  .run();\n                \n                found = true;\n                return false;\n              }\n            });\n            \n            toast({ title: `Centered text: \"${centerText}\"` });\n          }\n        }\n        break;\n        \n      case 'format_text':\n        const { text, formatting } = command.params;\n        if (text && formatting) {\n          // Find and format specific text\n          const content = editor.getHTML();\n          let newContent = content;\n          \n          if (formatting.bold) {\n            newContent = newContent.replace(new RegExp(text, 'gi'), `<strong>${text}</strong>`);\n          }\n          if (formatting.italic) {\n            newContent = newContent.replace(new RegExp(`(?<!<strong>)${text}(?!</strong>)`, 'gi'), `<em>${text}</em>`);\n          }\n          if (formatting.underline) {\n            newContent = newContent.replace(new RegExp(text, 'gi'), `<u>${text}</u>`);\n          }\n          \n          editor.commands.setContent(newContent);\n          toast({ title: `Formatted text: \"${text}\"` });\n        }\n        break;\n        \n      case 'add_text':\n        const { text: addText, position, pageNumber } = command.params;\n        if (addText) {\n          // Check if the content is already HTML formatted\n          const isHTML = addText.includes('<') && addText.includes('>');\n          const contentToAdd = isHTML ? addText : `<p>${addText}</p>`;\n          \n          if (position === 'end') {\n            editor.commands.focus('end');\n            editor.commands.insertContent(contentToAdd);\n          } else if (position === 'start') {\n            editor.commands.focus('start');\n            editor.commands.insertContent(contentToAdd);\n          } else {\n            editor.commands.focus();\n            editor.commands.insertContent(contentToAdd);\n          }\n          toast({ title: pageNumber ? `Added text to page ${pageNumber}` : \"Text added to document\" });\n        }\n        break;\n        \n      case 'replace_text':\n        const { targetText, newText } = command.params;\n        if (targetText && newText) {\n          const content = editor.getHTML();\n          const updatedContent = content.replace(new RegExp(targetText, 'gi'), newText);\n          editor.commands.setContent(updatedContent);\n          toast({ title: `Replaced \"${targetText}\" with \"${newText}\"` });\n        }\n        break;\n        \n      case 'delete_text':\n        const { text: deleteText } = command.params;\n        if (deleteText) {\n          const content = editor.getHTML();\n          const updatedContent = content.replace(new RegExp(deleteText, 'gi'), '');\n          editor.commands.setContent(updatedContent);\n          toast({ title: `Deleted text: \"${deleteText}\"` });\n        }\n        break;\n        \n      case 'clear_all':\n        editor.commands.clearContent();\n        toast({ title: \"Document cleared\" });\n        break;\n    }\n    \n    // Save changes after executing command\n    debouncedSave();\n  }, [editor, toast]);\n\n  // Debounced save function\n  const debouncedSave = useCallback(\n    debounce(() => {\n      const content = useStandaloneEngine ? documentContent : (editor?.getHTML() || '');\n      if (content) {\n        updateDocumentMutation.mutate({\n          content,\n          pageSize,\n          fontSize: fontSize.toString(),\n          fontFamily,\n          textColor,\n        });\n      }\n    }, 1000),\n    [useStandaloneEngine, documentContent, editor, pageSize, fontSize, fontFamily, textColor]\n  );\n\n  // Initialize editor with document content\n  useEffect(() => {\n    if (document && editor && document.content && !editor.getHTML().includes(document.content)) {\n      editor.commands.setContent(document.content || '<p></p>');\n      setPageSize((document.pageSize as keyof typeof PAGE_SIZES) || 'letter');\n      setFontSize(parseInt(document.fontSize || '12'));\n      setFontFamily(document.fontFamily || 'Times New Roman');\n      setTextColor(document.textColor || '#000000');\n    }\n  }, [document, editor]);\n\n  // Update editor props when formatting changes\n  useEffect(() => {\n    if (editor) {\n      editor.setOptions({\n        editorProps: {\n          attributes: {\n            class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none min-h-full w-full',\n            style: `font-family: ${fontFamily}; font-size: ${fontSize}pt; color: ${textColor}; line-height: 1.6;`,\n          },\n        },\n      });\n    }\n  }, [editor, fontFamily, fontSize, textColor]);\n\n  // Calculate page metrics - with error protection\n  const currentPageSize = PAGE_SIZES[pageSize] || PAGE_SIZES.letter;\n  // Swap dimensions for landscape orientation\n  let baseWidth = currentPageSize.width;\n  let baseHeight = currentPageSize.height;\n  if (pageOrientation === 'landscape') {\n    [baseWidth, baseHeight] = [baseHeight, baseWidth];\n  }\n  const pageWidth = baseWidth * (zoomLevel / 100);\n  const pageHeight = baseHeight * (zoomLevel / 100);\n  const padding = 64 * (zoomLevel / 100); // 64px padding scaled with zoom\n\n  // True Content Distribution using Layout Engine\n  const [pageContent, setPageContent] = useState<Array<{ pageNumber: number; content: string; wordCount: number; characterCount: number; isFull: boolean }>>([\n    { pageNumber: 1, content: '', wordCount: 0, characterCount: 0, isFull: false }\n  ]);\n  const editorRef = useRef<HTMLDivElement>(null);\n\n  // Content distribution effect - splits content across real pages\n  useEffect(() => {\n    if (editor && layoutEngine) {\n      const distributeContent = () => {\n        const htmlContent = editor.getHTML();\n        \n        // Use layout engine to split content into pages\n        const layoutResult = layoutEngine.LAYOUT_TEXT(htmlContent);\n        \n        if (layoutResult.pages.length > 0) {\n          setPageContent(layoutResult.pages);\n        } else {\n          // Fallback: single empty page\n          setPageContent([{ pageNumber: 1, content: '', wordCount: 0, characterCount: 0, isFull: false }]);\n        }\n      };\n\n      // Distribute content when it changes\n      const timer = setTimeout(distributeContent, 100);\n      return () => clearTimeout(timer);\n    }\n  }, [editor?.getHTML(), layoutEngine, pageHeight, padding, zoomLevel]);\n\n  // Page count is now derived from distributed content\n  const derivedPageCount = pageContent.length;\n\n  // Handle send message\n  const handleSendMessage = () => {\n    if (chatInput.trim()) {\n      sendMessageMutation.mutate(chatInput.trim());\n    }\n  };\n\n  // Generate smart title from document content\n  const generateSmartTitle = (content: string): string => {\n    const textContent = content.replace(/<[^>]*>/g, '').trim();\n    if (!textContent) return 'Untitled Document';\n    \n    // Extract first meaningful sentence or phrase\n    const sentences = textContent.split(/[.!?]+/);\n    let title = sentences[0]?.trim() || '';\n    \n    // If too long, get first few words\n    if (title.length > 50) {\n      const words = title.split(' ').slice(0, 6);\n      title = words.join(' ') + (words.length < title.split(' ').length ? '...' : '');\n    }\n    \n    // If still empty or too short, use first line\n    if (!title || title.length < 10) {\n      const lines = textContent.split('\\n').filter(line => line.trim());\n      title = lines[0]?.trim().slice(0, 50) + (lines[0]?.length > 50 ? '...' : '') || 'Document Draft';\n    }\n    \n    return title;\n  };\n\n  // Create new chat session\n  const createNewChatSession = async () => {\n    try {\n      const content = editor?.getHTML() || '<p></p>';\n      const smartTitle = generateSmartTitle(content);\n      \n      const response = await fetch(`/api/documents/${id}/chat-sessions`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: smartTitle,\n          documentSnapshot: content,\n        }),\n      });\n      if (response.ok) {\n        const newSession = await response.json();\n        setDefaultSessionId(newSession.id);\n        refetchSessions();\n        toast({ title: \"New chat session created\" });\n      }\n    } catch (error) {\n      console.error('Failed to create chat session:', error);\n      toast({ title: \"Failed to create chat session\", variant: \"destructive\" });\n    }\n  };\n\n  // Load document version from history\n  const loadDocumentVersion = (historyItem: any) => {\n    if (editor && historyItem.content) {\n      editor.commands.setContent(historyItem.content);\n      toast({ title: `Loaded version: ${historyItem.title}` });\n    }\n  };\n\n  // Share chat session\n  const shareSession = async (sessionItem: any) => {\n    try {\n      const shareUrl = `${window.location.origin}/document/${id}/chat/${sessionItem.id}`;\n      await navigator.clipboard.writeText(shareUrl);\n      toast({ title: \"Share link copied to clipboard\" });\n    } catch (error) {\n      toast({ title: \"Failed to copy share link\", variant: \"destructive\" });\n    }\n  };\n\n  // Download version as text file\n  const downloadVersion = (historyItem: any) => {\n    const textContent = historyItem.content.replace(/<[^>]*>/g, '');\n    const blob = new Blob([textContent], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = window.document.createElement('a');\n    a.href = url;\n    a.download = `${historyItem.title}.txt`;\n    window.document.body.appendChild(a);\n    a.click();\n    window.document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n    toast({ title: \"Version downloaded\" });\n  };\n\n  // Delete chat session\n  const deleteSession = async (sessionItem: any) => {\n    try {\n      if (confirm(`Delete chat session \"${sessionItem.title}\"?`)) {\n        const response = await fetch(`/api/chat-sessions/${sessionItem.id}`, {\n          method: 'DELETE',\n        });\n        if (response.ok) {\n          if (defaultSessionId === sessionItem.id) {\n            setDefaultSessionId(null);\n          }\n          refetchSessions();\n          toast({ title: \"Chat session deleted\" });\n        }\n      }\n    } catch (error) {\n      toast({ title: \"Failed to delete session\", variant: \"destructive\" });\n    }\n  };\n\n  // Rename functionality state\n  const [renamingHistoryId, setRenamingHistoryId] = useState<string | null>(null);\n  const [renameTitle, setRenameTitle] = useState('');\n\n  // Start renaming\n  const startRenaming = (historyItem: any) => {\n    setRenamingHistoryId(historyItem.id);\n    setRenameTitle(historyItem.title);\n  };\n\n  // Save rename\n  const saveRename = async (sessionId: string) => {\n    try {\n      const response = await fetch(`/api/chat-sessions/${sessionId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ title: renameTitle }),\n      });\n      if (response.ok) {\n        setRenamingHistoryId(null);\n        refetchSessions();\n        toast({ title: \"Chat session renamed\" });\n      }\n    } catch (error) {\n      toast({ title: \"Failed to rename session\", variant: \"destructive\" });\n    }\n  };\n\n  // Toggle session expansion\n  const toggleSessionExpansion = (sessionId: string) => {\n    const newExpanded = new Set(expandedSessions);\n    if (newExpanded.has(sessionId)) {\n      newExpanded.delete(sessionId);\n    } else {\n      newExpanded.add(sessionId);\n    }\n    setExpandedSessions(newExpanded);\n  };\n\n  // AI Improve functionality\n  const aiImproveMutation = useMutation({\n    mutationFn: async () => {\n      if (!id) throw new Error('Document ID not available');\n      \n      const content = useStandaloneEngine ? documentContent : (editor?.getHTML() || '');\n      if (!content.trim()) throw new Error('No content to improve');\n\n      const response = await apiRequest('POST', '/api/ai/improve-content', {\n        content,\n        documentId: id,\n        instruction: 'Improve this content while maintaining its structure and meaning. Focus on clarity, grammar, and readability.'\n      });\n      return await response.json();\n    },\n    onMutate: () => {\n      setIsAiImproving(true);\n    },\n    onSuccess: (response: any) => {\n      if (response.improvedContent) {\n        if (useStandaloneEngine && window.standaloneDocumentAPI) {\n          window.standaloneDocumentAPI.setContent(response.improvedContent);\n        } else if (editor) {\n          editor.commands.setContent(response.improvedContent);\n        }\n        toast({ title: \"Content improved by AI\", description: \"Your document has been enhanced for clarity and readability.\" });\n      }\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"AI Improve failed\", \n        description: error.message || \"Please try again later.\", \n        variant: \"destructive\" \n      });\n    },\n    onSettled: () => {\n      setIsAiImproving(false);\n    },\n  });\n\n  // Calculate document statistics\n  useEffect(() => {\n    if (!editor) return;\n    \n    const updateStats = () => {\n      const text = editor.getText();\n      const words = text.trim() ? text.trim().split(/\\s+/).length : 0;\n      const readTime = Math.max(1, Math.ceil(words / 200)); // 200 words per minute\n      setDocumentStats({ words, readTime });\n    };\n\n    updateStats();\n    const interval = setInterval(updateStats, 2000); // Update every 2 seconds\n    return () => clearInterval(interval);\n  }, [editor]);\n\n  if (documentLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-lg font-medium text-gray-700 dark:text-gray-300\">Loading document...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col\" style={{ background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)' }}>\n      \n      {/* Enhanced Microsoft Word-Style Toolbar with Soft Blue Background */}\n      <div className=\"border-b border-pink-200/30 flex-shrink-0\" style={{ \n        background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)',\n        boxShadow: '0 4px 16px rgba(255, 255, 255, 0.6) inset, 0 2px 8px rgba(0, 0, 0, 0.05)'\n      }}>\n\n\n\n        {/* Main toolbar content - 2 lines */}\n        <div className=\"p-3 space-y-3\">\n          {/* First toolbar line */}\n          <div className=\"flex items-center justify-center space-x-3 overflow-x-auto px-4\">\n            {/* AI Features - First section */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\">\n                <Type className=\"w-6 h-6 text-blue-600\" />\n                <span className=\"text-xs\">{documentStats.words} words</span>\n              </button>\n              <button className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\">\n                <Clock className=\"w-6 h-6 text-green-600\" />\n                <span className=\"text-xs\">{documentStats.readTime} min</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => aiImproveMutation.mutate()}\n                disabled={isAiImproving || !editor}\n              >\n                <Sparkles className=\"w-5 h-5 text-purple-600\" />\n                <span className=\"text-xs\">{isAiImproving ? 'Improving...' : 'AI Improve'}</span>\n              </button>\n              <button \n                onClick={async () => {\n                  const content = useStandaloneEngine ? documentContent : (document?.content || '');\n                  \n                  if (!content || content.trim().length === 0) {\n                    toast({\n                      title: \"No content to adjust\",\n                      description: \"Please add some text to your document first.\",\n                    });\n                    return;\n                  }\n                  \n                  try {\n                    const response = await fetch('/api/ai/adjust-tone', {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify({ \n                        content,\n                        targetTone: 'professional',\n                        preserveEquations: true \n                      })\n                    });\n                    \n                    if (!response.ok) throw new Error('AI service unavailable');\n                    \n                    const { adjustedContent } = await response.json();\n                    \n                    if (useStandaloneEngine && window.standaloneDocumentAPI) {\n                      window.standaloneDocumentAPI.setContent(adjustedContent);\n                    } else {\n                      await updateDocumentMutation.mutateAsync({ content: adjustedContent });\n                    }\n                    \n                    toast({\n                      title: \"Tone adjusted!\",\n                      description: \"Your writing tone has been made more professional while preserving technical content.\",\n                    });\n                  } catch (error) {\n                    toast({\n                      title: \"Tone adjustment failed\",\n                      description: \"Please try again or check your connection.\",\n                      variant: \"destructive\"\n                    });\n                  }\n                }}\n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n              >\n                <span className=\"w-4 h-4 text-center\">🎭</span>\n                <span className=\"text-xs\">Tone</span>\n              </button>\n            </div>\n\n            {/* File operations */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={async () => {\n                  if (useStandaloneEngine) {\n                    try {\n                      const content = await getDocumentEngineContent();\n                      navigator.clipboard.writeText(content);\n                      toast({ title: \"Content copied to clipboard\" });\n                    } catch (error) {\n                      toast({ title: \"Copy failed\", description: \"Please use Ctrl+C\", variant: \"destructive\" });\n                    }\n                  } else if (!editor) {\n                    toast({ title: \"Editor not ready\", variant: \"destructive\" });\n                    return;\n                  } else {\n                    try {\n                      const content = editor.getHTML() || '';\n                      navigator.clipboard.writeText(content);\n                      toast({ title: \"Content copied to clipboard\" });\n                    } catch (error) {\n                      toast({ title: \"Copy failed\", description: \"Please use Ctrl+C\", variant: \"destructive\" });\n                    }\n                  }\n                }}\n              >\n                <Copy className=\"w-6 h-6 text-orange-500\" />\n                <span className=\"text-xs\">Copy</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => {\n                  if (!editor) {\n                    toast({ title: \"Editor not ready\", variant: \"destructive\" });\n                    return;\n                  }\n                  try {\n                    // If no selection, select all\n                    if (editor.state.selection.empty) {\n                      editor.chain().focus().selectAll().run();\n                    }\n                    \n                    const content = editor.getHTML() || '';\n                    navigator.clipboard.writeText(content);\n                    editor.chain().focus().deleteSelection().run();\n                    toast({ title: \"Content cut to clipboard\" });\n                  } catch (error) {\n                    toast({ title: \"Cut failed\", description: \"Please use Ctrl+X\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <Scissors className=\"w-6 h-6 text-red-500\" />\n                <span className=\"text-xs\">Cut</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={async () => {\n                  try {\n                    const text = await navigator.clipboard.readText();\n                    if (useStandaloneEngine) {\n                      sendToDocumentEngine('INSERT_TEXT', { text });\n                      toast({ title: \"Content pasted\" });\n                    } else {\n                      editor?.chain().focus().insertContent(text).run();\n                      toast({ title: \"Content pasted\" });\n                    }\n                  } catch (err) {\n                    toast({ title: \"Paste failed\", description: \"Please use Ctrl+V instead\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <ClipboardPaste className=\"w-6 h-6 text-green-500\" />\n                <span className=\"text-xs\">Paste</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => editor?.chain().focus().undo().run()}\n                disabled={!editor?.can().undo()}\n              >\n                <Undo2 className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"text-xs\">Undo</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => editor?.chain().focus().redo().run()}\n                disabled={!editor?.can().redo()}\n              >\n                <Redo2 className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"text-xs\">Redo</span>\n              </button>\n            </div>\n\n            {/* Font controls */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <Select \n                value={fontFamily} \n                onValueChange={(value) => {\n                  if (useStandaloneEngine) {\n                    sendToDocumentEngine('SET_FONT', { fontFamily: value });\n                    setFontFamily(value);\n                    toast({ title: `Font changed to ${value}` });\n                  } else if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      // Apply font family to selected text only\n                      editor.chain().focus().setFontFamily(value).run();\n                      toast({ title: `Font changed to ${value} for selected text` });\n                    } else {\n                      toast({ title: \"Please select text to change font family\" });\n                    }\n                  }\n                }}\n              >\n                <SelectTrigger className=\"w-36 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Times New Roman\">Times New Roman</SelectItem>\n                  <SelectItem value=\"Arial\">Arial</SelectItem>\n                  <SelectItem value=\"Calibri\">Calibri</SelectItem>\n                  <SelectItem value=\"Georgia\">Georgia</SelectItem>\n                  <SelectItem value=\"Verdana\">Verdana</SelectItem>\n                  <SelectItem value=\"Helvetica\">Helvetica</SelectItem>\n                  <SelectItem value=\"Courier New\">Courier New</SelectItem>\n                  <SelectItem value=\"Comic Sans MS\">Comic Sans MS</SelectItem>\n                  <SelectItem value=\"Impact\">Impact</SelectItem>\n                  <SelectItem value=\"Trebuchet MS\">Trebuchet MS</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select \n                value={fontSize.toString()} \n                onValueChange={(value) => {\n                  const newSize = parseInt(value);\n                  if (!isNaN(newSize) && newSize >= 8 && newSize <= 72) {\n                    if (editor) {\n                      const { selection } = editor.state;\n                      if (!selection.empty) {\n                        // Apply size to selected text only using custom FontSize extension\n                        editor.chain().focus().setMark('textStyle', { fontSize: newSize.toString() }).run();\n                        toast({ title: `Font size changed to ${newSize}pt for selected text` });\n                      } else {\n                        toast({ title: \"Please select text to change font size\" });\n                      }\n                    }\n                  }\n                }}\n              >\n                <SelectTrigger className=\"w-16 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"8\">8</SelectItem>\n                  <SelectItem value=\"9\">9</SelectItem>\n                  <SelectItem value=\"10\">10</SelectItem>\n                  <SelectItem value=\"11\">11</SelectItem>\n                  <SelectItem value=\"12\">12</SelectItem>\n                  <SelectItem value=\"14\">14</SelectItem>\n                  <SelectItem value=\"16\">16</SelectItem>\n                  <SelectItem value=\"18\">18</SelectItem>\n                  <SelectItem value=\"20\">20</SelectItem>\n                  <SelectItem value=\"22\">22</SelectItem>\n                  <SelectItem value=\"24\">24</SelectItem>\n                  <SelectItem value=\"26\">26</SelectItem>\n                  <SelectItem value=\"28\">28</SelectItem>\n                  <SelectItem value=\"36\">36</SelectItem>\n                  <SelectItem value=\"48\">48</SelectItem>\n                  <SelectItem value=\"72\">72</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => {\n                  const newSize = Math.min(72, fontSize + 2);\n                  \n                  if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      // Apply size to selected text only using custom FontSize extension\n                      editor.chain().focus().setMark('textStyle', { fontSize: newSize.toString() }).run();\n                      toast({ title: `Font size increased to ${newSize}pt for selected text` });\n                    } else {\n                      toast({ title: \"Please select text to change font size\" });\n                    }\n                  }\n                }}\n                disabled={fontSize >= 72}\n              >\n                <Plus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => {\n                  const newSize = Math.max(8, fontSize - 2);\n                  \n                  if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      // Apply size to selected text only using custom FontSize extension\n                      editor.chain().focus().setMark('textStyle', { fontSize: newSize.toString() }).run();\n                      toast({ title: `Font size decreased to ${newSize}pt for selected text` });\n                    } else {\n                      toast({ title: \"Please select text to change font size\" });\n                    }\n                  }\n                }}\n                disabled={fontSize <= 8}\n              >\n                <Minus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n            </div>\n\n            {/* Text formatting */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('bold') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => {\n                  if (useStandaloneEngine) {\n                    sendToDocumentEngine('FORMAT_TEXT', { command: 'bold' });\n                  } else {\n                    editor?.chain().focus().toggleBold().run();\n                  }\n                }}\n              >\n                <Bold className=\"w-6 h-6 text-blue-600 font-bold\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('italic') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => {\n                  if (useStandaloneEngine) {\n                    sendToDocumentEngine('FORMAT_TEXT', { command: 'italic' });\n                  } else {\n                    editor?.chain().focus().toggleItalic().run();\n                  }\n                }}\n              >\n                <Italic className=\"w-6 h-6 text-blue-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('underline') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => {\n                  if (useStandaloneEngine) {\n                    sendToDocumentEngine('FORMAT_TEXT', { command: 'underline' });\n                  } else {\n                    editor?.chain().focus().toggleUnderline().run();\n                  }\n                }}\n              >\n                <UnderlineIcon className=\"w-6 h-6 text-blue-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('strike') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => {\n                  if (useStandaloneEngine) {\n                    sendToDocumentEngine('FORMAT_TEXT', { command: 'strikethrough' });\n                  } else {\n                    editor?.chain().focus().toggleStrike().run();\n                  }\n                }}\n              >\n                <Strikethrough className=\"w-6 h-6 text-red-600\" />\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                title=\"Subscript\"\n                onClick={() => {\n                  if (!editor) return;\n                  const { selection } = editor.state;\n                  const selectedText = editor.state.doc.textBetween(selection.from, selection.to, ' ');\n                  \n                  if (selectedText.trim()) {\n                    // Replace selected text with subscript version\n                    editor.chain().focus().deleteSelection().insertContent(`<sub>${selectedText}</sub>`).run();\n                  } else {\n                    // Insert placeholder subscript\n                    editor.chain().focus().insertContent('<sub>text</sub>').run();\n                  }\n                }}\n                disabled={!editor}\n              >\n                <span className=\"text-base text-blue-600\">X₂</span>\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                title=\"Superscript\"\n                onClick={() => {\n                  if (!editor) return;\n                  const { selection } = editor.state;\n                  const selectedText = editor.state.doc.textBetween(selection.from, selection.to, ' ');\n                  \n                  if (selectedText.trim()) {\n                    // Replace selected text with superscript version\n                    editor.chain().focus().deleteSelection().insertContent(`<sup>${selectedText}</sup>`).run();\n                  } else {\n                    // Insert placeholder superscript\n                    editor.chain().focus().insertContent('<sup>text</sup>').run();\n                  }\n                }}\n                disabled={!editor}\n              >\n                <span className=\"text-base text-blue-600\">X²</span>\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                title=\"Highlight\"\n                onClick={() => {\n                  if (!editor) return;\n                  const { selection } = editor.state;\n                  \n                  if (!selection.empty) {\n                    // Apply proper highlighting to selected text only\n                    editor.chain().focus().toggleHighlight({ color: '#ffff00' }).run();\n                    toast({ title: \"Text highlighted\" });\n                  } else {\n                    toast({ title: \"Please select text to highlight\" });\n                  }\n                }}\n                disabled={!editor}\n              >\n                <div className=\"w-6 h-6 bg-yellow-400 border rounded\" />\n              </button>\n              <input\n                type=\"color\"\n                value={textColor}\n                onChange={(e) => {\n                  const newColor = e.target.value;\n                  if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      // Apply color to selected text only\n                      editor.chain().focus().setColor(newColor).run();\n                      toast({ title: \"Color changed for selected text\" });\n                    } else {\n                      toast({ title: \"Please select text to change color\" });\n                    }\n                  }\n                }}\n                className=\"w-8 h-6 border rounded cursor-pointer\"\n                title=\"Font Color\"\n                disabled={!editor}\n              />\n            </div>\n\n            {/* Text alignment */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'left' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('left').run()}\n              >\n                <AlignLeft className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'center' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('center').run()}\n              >\n                <AlignCenter className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'right' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('right').run()}\n              >\n                <AlignRight className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'justify' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('justify').run()}\n              >\n                <AlignJustify className=\"w-6 h-6 text-green-600\" />\n              </button>\n            </div>\n\n            {/* Lists and indentation */}\n            <div className=\"flex items-center space-x-1\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('bulletList') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleBulletList().run()}\n              >\n                <List className=\"w-6 h-6 text-purple-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('orderedList') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleOrderedList().run()}\n              >\n                <ListOrdered className=\"w-6 h-6 text-purple-600\" />\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                title=\"Increase Indent\"\n                onClick={() => {\n                  if (editor?.isActive('listItem')) {\n                    editor.chain().focus().sinkListItem('listItem').run();\n                  }\n                }}\n                disabled={!editor?.isActive('listItem')}\n              >\n                <Indent className=\"w-6 h-6 text-orange-600\" />\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                title=\"Decrease Indent\"\n                onClick={() => {\n                  if (editor?.isActive('listItem')) {\n                    editor.chain().focus().liftListItem('listItem').run();\n                  }\n                }}\n                disabled={!editor?.isActive('listItem')}\n              >\n                <Outdent className=\"w-6 h-6 text-orange-600\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Second toolbar line */}\n          <div className=\"flex items-center justify-center space-x-3 overflow-x-auto px-4\">\n\n            {/* Page Layout Controls */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-300 pr-4\">\n              <Select value={pageSize} onValueChange={(value: keyof typeof PAGE_SIZES) => {\n                try {\n                  setPageSize(value);\n                  // Update layout engine with new page size\n                  const newLayoutEngine = createLayoutEngine(value, fontSize);\n                  setLayoutEngine(newLayoutEngine);\n                  setPageMetrics(newLayoutEngine.getCurrentMetrics());\n                  \n                  toast({ title: `Page size changed to ${value}` });\n                } catch (error) {\n                  console.error('Error updating page size:', error);\n                  toast({ \n                    title: \"Error changing page size\", \n                    description: \"Please try again\", \n                    variant: \"destructive\" \n                  });\n                }\n              }}>\n                <SelectTrigger className=\"w-36 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue placeholder=\"Page Size\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"letter\">Letter (8.5\" × 11\")</SelectItem>\n                  <SelectItem value=\"legal\">Legal (8.5\" × 14\")</SelectItem>\n                  <SelectItem value=\"a4\">A4 (8.27\" × 11.69\")</SelectItem>\n                  <SelectItem value=\"a3\">A3 (11.69\" × 16.54\")</SelectItem>\n                  <SelectItem value=\"tabloid\">Tabloid (11\" × 17\")</SelectItem>\n                  <SelectItem value=\"executive\">Executive (7.25\" × 10.5\")</SelectItem>\n                  <SelectItem value=\"ledger\">Ledger (17\" × 11\")</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select value={pageOrientation} onValueChange={(value: 'portrait' | 'landscape') => {\n                setPageOrientation(value);\n                // Trigger page layout recalculation\n                const newLayoutEngine = createLayoutEngine(pageSize, fontSize);\n                setLayoutEngine(newLayoutEngine);\n                setPageMetrics(newLayoutEngine.getCurrentMetrics());\n                toast({ title: `Page orientation changed to ${value}` });\n              }}>\n                <SelectTrigger className=\"w-24 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"portrait\">Portrait</SelectItem>\n                  <SelectItem value=\"landscape\">Landscape</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <button className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\">\n                <Layout className=\"w-4 h-4 text-blue-600\" />\n                <span className=\"text-xs\">Margins</span>\n              </button>\n              \n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => setRulerUnit(rulerUnit === 'inches' ? 'cm' : 'inches')}\n                title=\"Toggle ruler units\"\n              >\n                <span className=\"text-xs text-blue-600\">{rulerUnit === 'inches' ? 'in' : 'cm'}</span>\n              </button>\n              \n              {/* Page Metrics Display */}\n              <div className=\"text-xs text-gray-500 dark:text-gray-400 px-2 border-l border-gray-300\">\n                <div>{pageMetrics.charactersPerLine} chars/line</div>\n                <div>{pageMetrics.linesPerPage} lines/page</div>\n              </div>\n            </div>\n\n            {/* Insert options */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-300 pr-4\">\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => {\n                  if (editor) {\n                    // Create hidden file input for image upload\n                    const input = window.document.createElement('input');\n                    input.type = 'file';\n                    input.accept = 'image/*';\n                    input.onchange = (e: Event) => {\n                      const file = (e.target as HTMLInputElement).files?.[0];\n                      if (file) {\n                        const reader = new FileReader();\n                        reader.onload = (e) => {\n                          const imageSrc = e.target?.result as string;\n                          editor.chain().focus().insertContent(`<img src=\"${imageSrc}\" alt=\"${file.name}\" style=\"max-width: 100%; height: auto;\" />`).run();\n                          toast({ title: \"Image inserted successfully\" });\n                        };\n                        reader.readAsDataURL(file);\n                      }\n                    };\n                    input.click();\n                  }\n                }}\n                disabled={!editor}\n              >\n                <Image className=\"w-5 h-5 text-green-600\" />\n                <span className=\"text-xs\">Image</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => {\n                  if (editor) {\n                    // Insert a simple HTML table since Tiptap table extension might not be available\n                    const tableHTML = `\n                      <table style=\"border-collapse: collapse; width: 100%; margin: 16px 0;\">\n                        <thead>\n                          <tr>\n                            <th style=\"border: 1px solid #ccc; padding: 8px; background-color: #f5f5f5;\">Header 1</th>\n                            <th style=\"border: 1px solid #ccc; padding: 8px; background-color: #f5f5f5;\">Header 2</th>\n                            <th style=\"border: 1px solid #ccc; padding: 8px; background-color: #f5f5f5;\">Header 3</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          <tr>\n                            <td style=\"border: 1px solid #ccc; padding: 8px;\">Cell 1</td>\n                            <td style=\"border: 1px solid #ccc; padding: 8px;\">Cell 2</td>\n                            <td style=\"border: 1px solid #ccc; padding: 8px;\">Cell 3</td>\n                          </tr>\n                          <tr>\n                            <td style=\"border: 1px solid #ccc; padding: 8px;\">Cell 4</td>\n                            <td style=\"border: 1px solid #ccc; padding: 8px;\">Cell 5</td>\n                            <td style=\"border: 1px solid #ccc; padding: 8px;\">Cell 6</td>\n                          </tr>\n                        </tbody>\n                      </table>\n                    `;\n                    editor.chain().focus().insertContent(tableHTML).run();\n                    toast({ title: \"Table inserted\" });\n                  }\n                }}\n                disabled={!editor}\n              >\n                <Table className=\"w-5 h-5 text-blue-600\" />\n                <span className=\"text-xs\">Table</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => {\n                  if (editor) {\n                    const url = prompt('Enter URL:');\n                    if (url) {\n                      editor.chain().focus().setLink({ href: url }).run();\n                      toast({ title: \"Link added\" });\n                    }\n                  }\n                }}\n                disabled={!editor}\n              >\n                <Link className=\"w-5 h-5 text-purple-600\" />\n                <span className=\"text-xs\">Link</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => {\n                  if (editor) {\n                    editor.chain().focus().insertContent('<div style=\"page-break-before: always;\"></div>').run();\n                    toast({ title: \"Page break inserted\" });\n                  }\n                }}\n                disabled={!editor}\n              >\n                <FileText className=\"w-5 h-5 text-orange-600\" />\n                <span className=\"text-xs\">Page Break</span>\n              </button>\n            </div>\n\n            {/* Zoom controls */}\n            <div className=\"flex items-center space-x-2\">\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => {\n                  if (!document?.content || document.content.trim().length === 0) {\n                    toast({\n                      title: \"No content to download\",\n                      description: \"Please add some text to your document first.\",\n                    });\n                    return;\n                  }\n                  \n                  // Create a clean HTML document for download\n                  const cleanContent = document.content\n                    .replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '') // Remove scripts\n                    .replace(/<style\\b[^<]*(?:(?!<\\/style>)<[^<]*)*<\\/style>/gi, ''); // Remove styles\n                  \n                  const blob = new Blob([\n                    `<!DOCTYPE html>\n                    <html>\n                    <head>\n                      <meta charset=\"UTF-8\">\n                      <title>${document.title || 'Document'}</title>\n                      <style>\n                        body { font-family: ${fontFamily}, serif; font-size: ${fontSize}pt; color: ${textColor}; line-height: 1.6; margin: 40px; }\n                        @media print { body { margin: 0; } }\n                      </style>\n                    </head>\n                    <body>\n                      ${cleanContent}\n                    </body>\n                    </html>`\n                  ], { type: 'text/html' });\n                  \n                  const url = URL.createObjectURL(blob);\n                  const a = window.document.createElement('a');\n                  a.href = url;\n                  a.download = `${document.title || 'Document'}.html`;\n                  a.click();\n                  URL.revokeObjectURL(url);\n                  \n                  toast({ \n                    title: \"Document downloaded\",\n                    description: `${document.title || 'Document'}.html has been saved to your downloads.`\n                  });\n                }}\n              >\n                <Save className=\"w-5 h-5 text-green-600\" />\n                <span className=\"text-xs\">Download</span>\n              </button>\n\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => setZoomLevel(Math.max(25, zoomLevel - 25))}\n              >\n                <Minus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n              <span className=\"text-sm font-medium w-16 text-center text-gray-700\">{zoomLevel}%</span>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => setZoomLevel(Math.min(200, zoomLevel + 25))}\n              >\n                <Plus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n              <Select value={zoomLevel.toString()} onValueChange={(value) => setZoomLevel(parseInt(value))}>\n                <SelectTrigger className=\"w-20 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"50\">50%</SelectItem>\n                  <SelectItem value=\"75\">75%</SelectItem>\n                  <SelectItem value=\"100\">100%</SelectItem>\n                  <SelectItem value=\"125\">125%</SelectItem>\n                  <SelectItem value=\"150\">150%</SelectItem>\n                  <SelectItem value=\"200\">200%</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main content area */}\n      <ResizablePanelGroup direction=\"horizontal\" className=\"h-full\">\n        {/* Left panel - Document History */}\n        <ResizablePanel defaultSize={17} minSize={12} maxSize={25}>\n          <div className=\"h-full shadow-lg\" style={{ \n            background: 'white',\n            boxShadow: '0 8px 24px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(255, 255, 255, 0.6) inset'\n          }}>\n            <div className=\"p-4 border-b border-gray-200/30 dark:border-slate-600\" style={{ \n              background: 'white',\n              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.04)'\n            }}>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center\">\n                    <MessageSquare className=\"w-5 h-5 mr-2\" />\n                    Chat Sessions\n                  </h2>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                    All conversations with your document\n                  </p>\n                </div>\n                <Button\n                  size=\"sm\"\n                  onClick={createNewChatSession}\n                  className=\"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700\"\n                >\n                  <Plus className=\"w-4 h-4 mr-1\" />\n                  New Chat\n                </Button>\n              </div>\n            </div>\n            \n            <ScrollArea className=\"h-full p-4\" style={{\n              background: 'transparent'\n            }}>\n              <div className=\"space-y-2\">\n                {chatSessions.map((sessionItem: any) => (\n                  <div key={sessionItem.id} className=\"group\">\n                    <div \n                      className={`p-3 rounded-lg border transition-all duration-200 cursor-pointer ${\n                        defaultSessionId === sessionItem.id\n                          ? 'bg-blue-100 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700'\n                          : 'bg-white/50 dark:bg-slate-700/50 border-white/30 dark:border-slate-600 hover:bg-blue-50 dark:hover:bg-blue-900/20'\n                      }`}\n                      onClick={() => setDefaultSessionId(sessionItem.id)}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-2 flex-1\">\n                          <MessageSquare className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n                          {renamingHistoryId === sessionItem.id ? (\n                            <Input\n                              value={renameTitle}\n                              onChange={(e) => setRenameTitle(e.target.value)}\n                              className=\"text-sm h-6 px-1\"\n                              onKeyPress={(e) => {\n                                if (e.key === 'Enter') {\n                                  saveRename(sessionItem.id);\n                                } else if (e.key === 'Escape') {\n                                  setRenamingHistoryId(null);\n                                }\n                              }}\n                              onBlur={() => saveRename(sessionItem.id)}\n                              autoFocus\n                            />\n                          ) : (\n                            <span className=\"font-medium text-gray-900 dark:text-white truncate\">\n                              {sessionItem.title}\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                          <Button \n                            size=\"sm\" \n                            variant=\"ghost\" \n                            className=\"p-1\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              startRenaming(sessionItem);\n                            }}\n                            title=\"Rename session\"\n                          >\n                            <Edit3 className=\"w-3 h-3\" />\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"ghost\" \n                            className=\"p-1\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              shareSession(sessionItem);\n                            }}\n                            title=\"Share session link\"\n                          >\n                            <Share className=\"w-3 h-3\" />\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"ghost\" \n                            className=\"p-1 text-red-500\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              deleteSession(sessionItem);\n                            }}\n                            title=\"Delete session\"\n                          >\n                            <Trash2 className=\"w-3 h-3\" />\n                          </Button>\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                        {new Date(sessionItem.createdAt || Date.now()).toLocaleString()}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                \n                {chatSessions.length === 0 && (\n                  <div className=\"text-center py-8\">\n                    <MessageSquare className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n                      No chat sessions yet\n                    </p>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={createNewChatSession}\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      Create First Chat\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </ScrollArea>\n          </div>\n        </ResizablePanel>\n\n        <ResizableHandle />\n\n        {/* Center panel - Document Editor with True Pagination */}\n        <ResizablePanel defaultSize={50} minSize={30}>\n          <div className=\"h-full relative\" style={{\n            background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)'\n          }}>\n\n\n            \n            {/* Document content area */}\n            <div className=\"flex-1 relative overflow-auto\" style={{\n              background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)',\n              height: '100%'\n            }}>\n              {useStandaloneEngine ? (\n                <div className=\"h-full overflow-y-auto\">\n                  <StandaloneDocumentEngine\n                    onDataUpdate={(data) => {\n                      setDocumentContent(data.content);\n                      setDocumentStats({\n                        words: data.stats.wordCount,\n                        readTime: Math.ceil(data.stats.wordCount / 200)\n                      });\n                      setCurrentPage(data.stats.pageCount);\n                    }}\n                    initialContent={document?.content}\n                    className=\"min-h-full\"\n                  />\n                </div>\n              ) : (\n                <ScrollArea className=\"h-full\" style={{\n                  background: 'transparent'\n                }}>\n                  <div className=\"flex justify-center py-8 px-4 min-h-full\" style={{\n                    background: 'transparent'\n                  }}>\n                    {/* Document pages content */}\n                    <div className=\"relative\">\n                      {/* Render pages with real distributed content */}\n                      {pageContent.map((page, pageIndex) => (\n                        <div\n                          key={page.pageNumber}\n                          className=\"bg-white dark:bg-slate-100 mb-8 relative group transition-all duration-500\"\n                          style={{\n                            width: `${pageWidth}px`,\n                            height: `${pageHeight}px`,\n                            boxShadow: '0 2px 16px rgba(0, 0, 0, 0.06)',\n                            minHeight: `${pageHeight}px`,\n                            paddingLeft: `${leftMargin}px`,\n                            paddingRight: `${rightMargin}px`,\n                            paddingTop: `${topMargin}px`,\n                            paddingBottom: `${bottomMargin}px`\n                          }}\n                        >\n                          {/* Apply paragraph indents to content */}\n                          <div\n                            style={{\n                              textIndent: `${paragraphIndent}px`,\n                              marginLeft: `${hangingIndent}px`\n                            }}\n                          >\n                            <EditorContent \n                              editor={editor} \n                              className=\"prose prose-lg max-w-none dark:prose-invert focus:outline-none\"\n                            />\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </ScrollArea>\n              )}\n            </div>\n          </div>\n        </ResizablePanel>\n\n        <ResizableHandle />\n\n        {/* Right panel - Always-On ChatGPT Interface (increased by 30%) */}\n        <ResizablePanel defaultSize={33} minSize={25} maxSize={45}>\n          <div className=\"h-full shadow-lg flex flex-col\" style={{ \n            background: 'white',\n            boxShadow: '0 8px 24px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(255, 255, 255, 0.6) inset'\n          }}>\n            {/* ChatGPT Assistant Header - Fixed at top */}\n            <div className=\"flex-shrink-0 border-b border-gray-200/30 dark:border-slate-600 p-4\" style={{ \n              background: 'white',\n              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.04)'\n            }}>\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg\">\n                    <Brain className=\"w-4 h-4 text-white\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900 dark:text-white text-sm\">ChatGPT Assistant</h3>\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 font-light\">\n                      Always available • {derivedPageCount} pages\n                    </p>\n                  </div>\n                </div>\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" title=\"AI Active\"></div>\n              </div>\n              \n              {/* Smart AI Suggestions - Compact */}\n              <div className=\"space-y-2\">\n                <h4 className=\"text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider\">Quick Actions</h4>\n                <div className=\"grid grid-cols-1 gap-1\">\n                  <button className=\"w-full text-left p-2 text-xs bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700 transition-all duration-300 text-gray-700 dark:text-gray-300\">\n                    💡 Rephrase selection\n                  </button>\n                  <button className=\"w-full text-left p-2 text-xs bg-purple-50 hover:bg-purple-100 dark:bg-purple-900/20 dark:hover:bg-purple-900/30 rounded-lg border border-purple-200 dark:border-purple-700 transition-all duration-300 text-gray-700 dark:text-gray-300\">\n                    📝 Add summary\n                  </button>\n                  <button className=\"w-full text-left p-2 text-xs bg-green-50 hover:bg-green-100 dark:bg-green-900/20 dark:hover:bg-green-900/30 rounded-lg border border-green-200 dark:border-green-700 transition-all duration-300 text-gray-700 dark:text-gray-300\">\n                    🎯 Check tone\n                  </button>\n                </div>\n              </div>\n            </div>\n            \n            {/* Chat messages area - Flexible middle section with independent scroll */}\n            <div className=\"flex-1 overflow-y-auto p-4 min-h-0\">\n              <div className=\"space-y-2\">\n                {chatMessages.length === 0 && (\n                  <div className=\"text-center py-6\">\n                    <Sparkles className=\"w-8 h-8 text-purple-400 mx-auto mb-3\" />\n                    <h4 className=\"font-medium text-gray-900 dark:text-white mb-2 text-sm\">\n                      Ready to Help!\n                    </h4>\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-3\">\n                      Try natural language requests:\n                    </p>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-500 space-y-1\">\n                      <p>\"create a title about Ali\"</p>\n                      <p>\"make the text bold\"</p>\n                      <p>\"add a paragraph\"</p>\n                    </div>\n                  </div>\n                )}\n                \n                {chatMessages.map((message: ChatMessage) => (\n                  <div\n                    key={message.id}\n                    className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'} mb-2`}\n                  >\n                    <div\n                      className={`max-w-[85%] p-2 rounded-lg text-xs ${\n                        message.role === 'user'\n                          ? 'bg-blue-500 text-white'\n                          : 'bg-gray-100 dark:bg-slate-700 text-gray-900 dark:text-white border shadow-sm'\n                      }`}\n                    >\n                      <p className=\"whitespace-pre-wrap leading-relaxed\">{message.content}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n            \n            {/* Chat input - Fixed at bottom */}\n            <div className=\"flex-shrink-0 border-t border-gray-200/30 dark:border-gray-700 p-4\" style={{ \n              background: 'white',\n              boxShadow: '0 -2px 8px rgba(0, 0, 0, 0.04)'\n            }}>\n              <div className=\"space-y-2\">\n                <div className=\"flex space-x-2\">\n                  <Textarea\n                    placeholder=\"Ask me to help with your document...\"\n                    value={chatInput}\n                    onChange={(e) => setChatInput(e.target.value)}\n                    className=\"flex-1 min-h-[50px] max-h-[50px] resize-none text-sm\"\n                    onKeyPress={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey) {\n                        e.preventDefault();\n                        handleSendMessage();\n                      }\n                    }}\n                  />\n                  <Button\n                    onClick={handleSendMessage}\n                    disabled={!chatInput.trim() || sendMessageMutation.isPending}\n                    className=\"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 self-end\"\n                  >\n                    <Send className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  Try: \"create a title\", \"make text bold\", \"add paragraph\"\n                </p>\n              </div>\n            </div>\n          </div>\n        </ResizablePanel>\n      </ResizablePanelGroup>\n\n\n\n    </div>\n  );\n}\n","size_bytes":85829},"client/src/pages/landing.tsx":{"content":"import { Link } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { FileText, Grid3X3, FileSpreadsheet, Play, Check, X, BookOpen, Calculator, PenTool, Layout, Brain } from 'lucide-react';\nimport { useState } from 'react';\n\nexport default function Landing() {\n  const [videoModal, setVideoModal] = useState<{ isOpen: boolean; type: string; title: string }>({\n    isOpen: false,\n    type: '',\n    title: ''\n  });\n\n  const openVideoModal = (type: string, title: string) => {\n    setVideoModal({ isOpen: true, type, title });\n  };\n\n  const closeVideoModal = () => {\n    setVideoModal({ isOpen: false, type: '', title: '' });\n  };\n  return (\n    <div className=\"min-h-screen relative\">\n      {/* Frosted overlay with floating math symbols */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-white/15 via-blue-400/5 to-purple-600/10 backdrop-blur-[1px] z-0\">\n        {/* Floating math symbols - more visible */}\n        <div className=\"absolute top-[40%] left-[5%] text-3xl text-white/25 font-light select-none animate-float-right\">∫</div>\n        <div className=\"absolute top-[60%] right-[8%] text-2xl text-white/20 font-light select-none animate-float-left\">π</div>\n        <div className=\"absolute top-[75%] left-[20%] text-3xl text-white/25 font-light select-none animate-float-right\">√</div>\n        <div className=\"absolute top-[30%] left-[85%] text-2xl text-white/20 font-light select-none animate-float-left\">λ</div>\n        <div className=\"absolute top-[85%] right-[30%] text-3xl text-white/25 font-light select-none animate-float-up\">∞</div>\n        <div className=\"absolute top-[25%] right-[10%] text-2xl text-white/20 font-light select-none animate-float-left\">∇</div>\n        <div className=\"absolute top-[90%] left-[70%] text-3xl text-white/25 font-light select-none animate-float-up\">θ</div>\n        <div className=\"absolute top-[35%] left-[3%] text-2xl text-white/20 font-light select-none animate-float-right\">α</div>\n        <div className=\"absolute top-[45%] right-[25%] text-2xl text-white/20 font-light select-none animate-float-up\">Σ</div>\n        <div className=\"absolute top-[20%] left-[40%] text-3xl text-white/25 font-light select-none animate-float-right\">∂</div>\n        <div className=\"absolute top-[80%] left-[45%] text-2xl text-white/20 font-light select-none animate-float-left\">Ω</div>\n        <div className=\"absolute top-[15%] right-[60%] text-2xl text-white/20 font-light select-none animate-float-up\">φ</div>\n      </div>\n      {/* Header */}\n      <header className=\"absolute top-0 left-0 right-0 z-10 px-8 py-6\">\n        <div className=\"flex items-center justify-between w-full\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"w-20 h-20 flex items-center justify-center\">\n              <img \n                src=\"/src/assets/brain-logo.png\" \n                alt=\"StudyFlow\" \n                className=\"w-20 h-20 brightness-110 contrast-125\"\n              />\n            </div>\n            <h1 className=\"text-xl font-light text-white tracking-wider\" style={{ fontFamily: '\"Space Grotesk\", sans-serif', fontWeight: '300', letterSpacing: '0.15em' }}>StudyFlow</h1>\n          </div>\n          <div className=\"flex items-center space-x-4\">\n            <Button variant=\"ghost\" className=\"text-white/90 hover:text-white font-medium hover:bg-white/10 transition-all duration-300 px-5 py-2 text-sm rounded-lg\" style={{ fontFamily: '\"Inter\", sans-serif', fontWeight: '500' }}>\n              Log In\n            </Button>\n            <Button variant=\"ghost\" className=\"text-white/90 hover:text-white font-medium hover:bg-white/10 transition-all duration-300 px-5 py-2 text-sm rounded-lg\" style={{ fontFamily: '\"Inter\", sans-serif', fontWeight: '500' }}>\n              Register\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <main className=\"relative z-10 max-w-6xl mx-auto px-8 py-16 pb-32\">\n        <div className=\"text-center mb-20\">\n          <h1 className=\"text-8xl font-normal text-white mb-6 leading-tight tracking-wide\" style={{ fontFamily: '\"Crimson Text\", serif' }}>\n            StudyFlow\n          </h1>\n          <p className=\"text-xl text-white/90 mb-16 font-medium tracking-wide italic\" style={{ fontFamily: '\"Playfair Display\", serif' }}>\n            \"Where brilliant minds craft their masterpieces\"\n          </p>\n        </div>\n\n        {/* Workspace Cards and Video Previews */}\n        <div className=\"flex justify-center gap-10 mb-16 max-w-7xl mx-auto\">\n          {/* Template Workspace */}\n          <div className=\"space-y-6\">\n            <Link href=\"/template-new/new\">\n              <div className=\"w-[368px] h-[346px] rounded-2xl px-5 py-6 hover:scale-[1.02] transition-all duration-300 cursor-pointer group flex flex-col justify-center items-center border border-white/30\" style={{ \n                background: 'linear-gradient(145deg, rgba(200, 240, 220, 0.6), rgba(184, 230, 204, 0.4))', \n                backdropFilter: 'blur(10px)',\n                boxShadow: '0 8px 20px rgba(0, 0, 0, 0.08)'\n              }}>\n                <div className=\"flex flex-col items-center\">\n                  <div className=\"w-16 h-16 bg-black rounded-xl flex items-center justify-center mb-6 group-hover:scale-105 transition-transform duration-300\">\n                    <Layout className=\"text-white text-2xl\" />\n                  </div>\n                  <h3 className=\"text-2xl font-bold text-gray-900 mb-2 text-center\" style={{ fontFamily: '\"Inter\", sans-serif' }}>Template</h3>\n                  <p className=\"text-lg text-gray-700 text-center font-normal\">With Built-in AI</p>\n                </div>\n              </div>\n            </Link>\n            \n            {/* Embedded Video Preview */}\n            <button \n              onClick={() => openVideoModal('template', 'Smart Templates Powered by AI')}\n              className=\"w-full aspect-video bg-gradient-to-br from-cyan-300 via-purple-300 to-blue-300 rounded-2xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 group\"\n            >\n              <div className=\"w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                <Play className=\"text-white text-xl ml-1\" />\n              </div>\n            </button>\n\n\n          </div>\n\n          {/* Cheat Sheet Workspace */}\n          <div className=\"space-y-6\">\n            <Link href=\"/cheatsheet-new/new\">\n              <div className=\"w-[368px] h-[346px] rounded-2xl px-5 py-6 hover:scale-[1.02] transition-all duration-300 cursor-pointer group flex flex-col justify-center items-center border border-white/30\" style={{ \n                background: 'linear-gradient(145deg, rgba(245, 230, 211, 0.6), rgba(255, 192, 203, 0.4))', \n                backdropFilter: 'blur(10px)',\n                boxShadow: '0 8px 20px rgba(0, 0, 0, 0.08)'\n              }}>\n                <div className=\"flex flex-col items-center\">\n                  <div className=\"w-16 h-16 bg-black rounded-xl flex items-center justify-center mb-6 group-hover:scale-105 transition-transform duration-300\">\n                    <Brain className=\"text-white text-2xl\" />\n                  </div>\n                  <h3 className=\"text-2xl font-bold text-gray-900 mb-2 text-center\" style={{ fontFamily: '\"Inter\", sans-serif' }}>Cheatsheet</h3>\n                  <p className=\"text-lg text-gray-700 text-center font-normal\">With Built-in AI</p>\n                </div>\n              </div>\n            </Link>\n            \n            {/* Embedded Video Preview */}\n            <button \n              onClick={() => openVideoModal('cheatsheet', 'Cheat Sheets Powered by AI')}\n              className=\"w-full aspect-video bg-gradient-to-br from-cyan-300 via-purple-300 to-blue-300 rounded-2xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 group\"\n            >\n              <div className=\"w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                <Play className=\"text-white text-xl ml-1\" />\n              </div>\n            </button>\n\n\n          </div>\n\n          {/* Document Workspace */}\n          <div className=\"space-y-6\">\n            <Link href=\"/document/test-doc-1\">\n              <div className=\"w-[368px] h-[346px] rounded-2xl px-5 py-6 hover:scale-[1.02] transition-all duration-300 cursor-pointer group flex flex-col justify-center items-center border border-white/30\" style={{ \n                background: 'linear-gradient(145deg, rgba(173, 216, 230, 0.6), rgba(221, 160, 221, 0.4))', \n                backdropFilter: 'blur(10px)',\n                boxShadow: '0 8px 20px rgba(0, 0, 0, 0.08)'\n              }}>\n                <div className=\"flex flex-col items-center\">\n                  <div className=\"w-16 h-16 bg-black rounded-xl flex items-center justify-center mb-6 group-hover:scale-105 transition-transform duration-300\">\n                    <PenTool className=\"text-white text-2xl\" />\n                  </div>\n                  <h3 className=\"text-2xl font-bold text-gray-900 mb-2 text-center\" style={{ fontFamily: '\"Inter\", sans-serif' }}>Document</h3>\n                  <p className=\"text-lg text-gray-700 text-center font-normal\">With Built-in AI</p>\n                </div>\n              </div>\n            </Link>\n            \n            {/* Embedded Video Preview */}\n            <button \n              onClick={() => openVideoModal('document', 'Smart Documents Powered by AI')}\n              className=\"w-full aspect-video bg-gradient-to-br from-cyan-300 via-purple-300 to-blue-300 rounded-2xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 group\"\n            >\n              <div className=\"w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform duration-300\">\n                <Play className=\"text-white text-xl ml-1\" />\n              </div>\n            </button>\n\n\n          </div>\n        </div>\n\n        {/* Additional Features Section */}\n        <div className=\"mt-24 mx-auto max-w-6xl space-y-8\">\n          {/* First Row - 2 boxes centered */}\n          <div className=\"flex justify-center gap-8\">\n            {/* Academic Excellence */}\n            <div className=\"bg-gradient-to-r from-white/25 via-blue-50/20 to-purple-50/15 backdrop-blur-md border border-white/40 rounded-xl p-6 shadow-lg w-80 hover:scale-105 hover:shadow-2xl hover:shadow-cyan-200/30 hover:bg-gradient-to-r hover:from-white/35 hover:via-blue-50/30 hover:to-purple-50/25 transition-all duration-300 cursor-pointer group\">\n              <h4 className=\"text-base font-semibold text-gray-800 mb-3 flex items-center\">\n                <BookOpen className=\"w-5 h-5 mr-2 text-cyan-600 group-hover:scale-110 group-hover:rotate-3 transition-transform duration-300\" />\n                Academic Excellence\n              </h4>\n              <p className=\"text-sm text-gray-700 leading-relaxed\">Structured layouts designed for research papers, thesis documents, and academic publications.</p>\n            </div>\n            \n            {/* Smart Organization */}\n            <div className=\"bg-gradient-to-r from-white/25 via-purple-50/20 to-blue-50/15 backdrop-blur-md border border-white/40 rounded-xl p-6 shadow-lg w-80 hover:scale-105 hover:shadow-2xl hover:shadow-purple-200/30 hover:bg-gradient-to-r hover:from-white/35 hover:via-purple-50/30 hover:to-blue-50/25 transition-all duration-300 cursor-pointer group\">\n              <h4 className=\"text-base font-semibold text-gray-800 mb-3 flex items-center\">\n                <Calculator className=\"w-5 h-5 mr-2 text-purple-600 group-hover:scale-110 group-hover:-rotate-3 transition-transform duration-300\" />\n                Smart Organization\n              </h4>\n              <p className=\"text-sm text-gray-700 leading-relaxed\">AI-powered content placement with automatic formula categorization and visual hierarchy.</p>\n            </div>\n          </div>\n          \n          {/* Second Row - 3 boxes */}\n          <div className=\"grid grid-cols-3 gap-6 max-w-5xl mx-auto\">\n            {/* Microsoft Word Level */}\n            <div className=\"bg-gradient-to-r from-white/25 via-blue-50/20 to-green-50/15 backdrop-blur-md border border-white/40 rounded-xl p-6 shadow-lg hover:scale-105 hover:shadow-2xl hover:shadow-blue-200/30 hover:bg-gradient-to-r hover:from-white/35 hover:via-blue-50/30 hover:to-green-50/25 transition-all duration-300 cursor-pointer group\">\n              <h4 className=\"text-base font-semibold text-gray-800 mb-3 flex items-center\">\n                <PenTool className=\"w-5 h-5 mr-2 text-blue-600 group-hover:scale-110 group-hover:rotate-6 transition-transform duration-300\" />\n                Microsoft Word Level\n              </h4>\n              <p className=\"text-sm text-gray-700 leading-relaxed\">True pagination with live editing, content flow, and professional document standards.</p>\n            </div>\n            \n            {/* Print Ready */}\n            <div className=\"bg-gradient-to-r from-white/25 via-cyan-50/20 to-purple-50/15 backdrop-blur-md border border-white/40 rounded-xl p-6 shadow-lg hover:scale-105 hover:shadow-2xl hover:shadow-cyan-200/30 hover:bg-gradient-to-r hover:from-white/35 hover:via-cyan-50/30 hover:to-purple-50/25 transition-all duration-300 cursor-pointer group\">\n              <h4 className=\"text-base font-semibold text-gray-800 mb-3 flex items-center\">\n                <Layout className=\"w-5 h-5 mr-2 text-cyan-600 group-hover:scale-110 group-hover:-rotate-6 transition-transform duration-300\" />\n                Print Ready\n              </h4>\n              <p className=\"text-sm text-gray-700 leading-relaxed\">Perfect formatting with IEEE, APA, and MLA compliance for professional submissions.</p>\n            </div>\n            \n            {/* Dynamic Layouts */}\n            <div className=\"bg-gradient-to-r from-white/25 via-purple-50/20 to-blue-50/15 backdrop-blur-md border border-white/40 rounded-xl p-6 shadow-lg hover:scale-105 hover:shadow-2xl hover:shadow-purple-200/30 hover:bg-gradient-to-r hover:from-white/35 hover:via-purple-50/30 hover:to-blue-50/25 transition-all duration-300 cursor-pointer group\">\n              <h4 className=\"text-base font-semibold text-gray-800 mb-3 flex items-center\">\n                <Grid3X3 className=\"w-5 h-5 mr-2 text-purple-600 group-hover:scale-110 group-hover:rotate-12 transition-transform duration-300\" />\n                Dynamic Layouts\n              </h4>\n              <p className=\"text-sm text-gray-700 leading-relaxed\">Intelligent box sizing and collision detection for optimal space utilization.</p>\n            </div>\n          </div>\n          \n          {/* Third Row - 1 box centered */}\n          <div className=\"flex justify-center\">\n            {/* AI Integration */}\n            <div className=\"bg-gradient-to-r from-white/25 via-blue-50/20 to-green-50/15 backdrop-blur-md border border-white/40 rounded-xl p-6 shadow-lg w-80 hover:scale-105 hover:shadow-2xl hover:shadow-blue-200/30 hover:bg-gradient-to-r hover:from-white/35 hover:via-blue-50/30 hover:to-green-50/25 transition-all duration-300 cursor-pointer group\">\n              <h4 className=\"text-base font-semibold text-gray-800 mb-3 flex items-center\">\n                <Brain className=\"w-5 h-5 mr-2 text-blue-600 group-hover:scale-110 group-hover:rotate-3 transition-transform duration-300\" />\n                AI Integration\n              </h4>\n              <p className=\"text-sm text-gray-700 leading-relaxed\">Real-time ChatGPT assistance with direct document insertion and contextual suggestions.</p>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      {/* Video Modal */}\n      <Dialog open={videoModal.isOpen} onOpenChange={closeVideoModal}>\n        <DialogContent className=\"max-w-4xl max-h-[85vh] p-0 border-0 bg-gradient-to-br from-white/40 via-cyan-50/30 to-purple-50/20 backdrop-blur-2xl shadow-2xl\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 via-transparent to-white/10 backdrop-blur-sm rounded-lg\"></div>\n          <div className=\"relative z-10\">\n            <DialogHeader className=\"p-6 pb-0\">\n              <DialogTitle className=\"text-3xl font-black text-gray-900 tracking-tight bg-gradient-to-r from-gray-900 via-gray-700 to-gray-900 bg-clip-text\">\n                {videoModal.title}\n              </DialogTitle>\n            </DialogHeader>\n            <div className=\"p-6 pt-4\">\n              <div className=\"aspect-video bg-gradient-to-br from-gray-900/95 via-gray-800/90 to-gray-900/95 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/20 shadow-xl\">\n                <div className=\"text-center text-white\">\n                  <div className=\"w-20 h-20 bg-gradient-to-br from-white/20 via-cyan-200/30 to-purple-200/20 backdrop-blur-md border border-white/30 rounded-full flex items-center justify-center shadow-lg mx-auto mb-6\">\n                    <Play className=\"w-10 h-10 text-white ml-1\" />\n                  </div>\n                  <p className=\"text-xl mb-3 font-semibold tracking-wide\">Video Demonstration</p>\n                  <p className=\"text-sm opacity-90 max-w-md mx-auto leading-relaxed\">\n                    {videoModal.type === 'template' && 'See how Smart Templates help you create structured academic layouts instantly with AI-powered design assistance'}\n                    {videoModal.type === 'cheatsheet' && 'Watch how Cheat Sheets organize your formulas with intelligent auto-sizing and dynamic layout management'}\n                    {videoModal.type === 'document' && 'Experience Smart Documents with AI assistance and beautiful LaTeX rendering for academic excellence'}\n                  </p>\n                </div>\n              </div>\n              <div className=\"mt-6 text-center\">\n                <Button \n                  onClick={closeVideoModal} \n                  variant=\"outline\"\n                  className=\"bg-gradient-to-r from-white/60 via-cyan-50/50 to-purple-50/40 backdrop-blur-md border-white/40 hover:from-white/70 hover:via-cyan-50/60 hover:to-purple-50/50 hover:backdrop-blur-lg transition-all duration-300 font-medium\"\n                >\n                  Close\n                </Button>\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":18596},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/template-workspace.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useParams, useLocation } from 'wouter';\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\nimport TextAlign from '@tiptap/extension-text-align';\nimport Underline from '@tiptap/extension-underline';\nimport { Color } from '@tiptap/extension-color';\nimport { TextStyle } from '@tiptap/extension-text-style';\nimport { FontFamily } from '@tiptap/extension-font-family';\nimport Highlight from '@tiptap/extension-highlight';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { \n  Save, FileSpreadsheet, Bold, Italic, Underline as UnderlineIcon, Strikethrough,\n  AlignLeft, AlignCenter, AlignRight, AlignJustify, List, ListOrdered, Copy,\n  Scissors, ClipboardPaste, Undo2, Redo2, Plus, Minus, Indent, Outdent, Type, Palette\n} from 'lucide-react';\nimport WorkspaceSidebar from '@/components/workspace-sidebar';\nimport ChatPanel from '@/components/chat-panel';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Template } from '@shared/schema';\nimport { useToast } from '@/hooks/use-toast';\n\n// Custom FontSize extension\nconst FontSize = TextStyle.extend({\n  addAttributes() {\n    return {\n      fontSize: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.style.fontSize?.replace('pt', ''),\n        renderHTML: (attributes: any) => {\n          if (!attributes.fontSize) return {}\n          return { style: `font-size: ${attributes.fontSize}pt` }\n        },\n      }\n    }\n  }\n});\n\nexport default function TemplateWorkspace() {\n  const { id } = useParams();\n  const [, navigate] = useLocation();\n  const [currentTemplate, setCurrentTemplate] = useState<Template | null>(null);\n  const [sections, setSections] = useState<any>({});\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  // Editor state for toolbar functionality\n  const [fontSize, setFontSize] = useState(12);\n  const [fontFamily, setFontFamily] = useState('Arial');\n  const [textColor, setTextColor] = useState('#000000');\n\n  // Editor setup with extensive functionality\n  const editor = useEditor({\n    extensions: [\n      StarterKit.configure({\n        heading: {\n          levels: [1, 2, 3],\n        },\n      }),\n      TextAlign.configure({\n        types: ['heading', 'paragraph'],\n      }),\n      Underline,\n      Color,\n      FontFamily,\n      FontSize,\n      Highlight\n    ],\n    content: '<p>Start editing your template content...</p>',\n    editorProps: {\n      attributes: {\n        class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none',\n      },\n    },\n  });\n\n  // Fetch current template\n  const { data: template } = useQuery({\n    queryKey: ['/api/templates', id],\n    enabled: !!id,\n  });\n\n  useEffect(() => {\n    if (template) {\n      setCurrentTemplate(template as Template);\n      setSections((template as Template).sections || {});\n    }\n  }, [template]);\n\n  // Create new template\n  const createTemplateMutation = useMutation({\n    mutationFn: () => apiRequest('POST', '/api/templates', {\n      title: 'New Template',\n      templateType: 'generic',\n      sections: {}\n    }),\n    onSuccess: async (response) => {\n      const newTemplate = await response.json();\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      setCurrentTemplate(newTemplate);\n      setSections({});\n      navigate(`/template/${newTemplate.id}`);\n    },\n  });\n\n  // Save template\n  const saveTemplateMutation = useMutation({\n    mutationFn: () => {\n      if (!currentTemplate) throw new Error('No template selected');\n      return apiRequest('PUT', `/api/templates/${currentTemplate.id}`, {\n        sections,\n        updatedAt: new Date()\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/templates'] });\n      toast({\n        title: \"Template saved\",\n        description: \"Your template has been saved successfully.\",\n      });\n    },\n  });\n\n  const handleAIResponse = (response: any) => {\n    if (response.sections) {\n      setSections(prev => ({ ...prev, ...response.sections }));\n    }\n  };\n\n  return (\n    <div className=\"h-screen flex flex-col\">\n      {/* Enhanced Microsoft Word-Style Toolbar for Templates */}\n      <div className=\"bg-white/95 dark:bg-slate-800/95 backdrop-blur-sm border-b border-white/20 flex-shrink-0\">\n        {/* Document title bar */}\n        <div className=\"flex items-center justify-between px-4 py-2 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center space-x-2\">\n            <FileSpreadsheet className=\"w-6 h-6 text-green-600\" />\n            <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">{currentTemplate?.title || 'Template'}</h1>\n          </div>\n          <Button\n            onClick={() => saveTemplateMutation.mutate()}\n            disabled={saveTemplateMutation.isPending || !currentTemplate}\n            className=\"bg-green-600 hover:bg-green-700\"\n          >\n            <Save className=\"w-4 h-4 mr-2\" />\n            Save Template\n          </Button>\n        </div>\n\n        {/* Main toolbar content - 2 lines */}\n        <div className=\"p-3 space-y-3\">\n          {/* First toolbar line */}\n          <div className=\"flex items-center space-x-4 overflow-x-auto\">\n            {/* File operations */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-300 pr-4\">\n              <Button \n                size=\"sm\" \n                variant=\"outline\" \n                onClick={() => {\n                  if (!editor) {\n                    toast({ title: \"Editor not ready\", variant: \"destructive\" });\n                    return;\n                  }\n                  try {\n                    const content = editor.getHTML() || '';\n                    navigator.clipboard.writeText(content);\n                    toast({ title: \"Content copied to clipboard\" });\n                  } catch (error) {\n                    toast({ title: \"Copy failed\", description: \"Please use Ctrl+C\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <Copy className=\"w-4 h-4 mr-1\" />\n                Copy\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\"\n                onClick={() => {\n                  if (!editor) {\n                    toast({ title: \"Editor not ready\", variant: \"destructive\" });\n                    return;\n                  }\n                  try {\n                    if (editor.state.selection.empty) {\n                      editor.chain().focus().selectAll().run();\n                    }\n                    \n                    const content = editor.getHTML() || '';\n                    navigator.clipboard.writeText(content);\n                    editor.chain().focus().deleteSelection().run();\n                    toast({ title: \"Content cut to clipboard\" });\n                  } catch (error) {\n                    toast({ title: \"Cut failed\", description: \"Please use Ctrl+X\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <Scissors className=\"w-4 h-4 mr-1\" />\n                Cut\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\"\n                onClick={async () => {\n                  try {\n                    const text = await navigator.clipboard.readText();\n                    editor?.chain().focus().insertContent(text).run();\n                    toast({ title: \"Content pasted\" });\n                  } catch (err) {\n                    toast({ title: \"Paste failed\", description: \"Please use Ctrl+V instead\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <ClipboardPaste className=\"w-4 h-4 mr-1\" />\n                Paste\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\"\n                onClick={() => editor?.chain().focus().undo().run()}\n                disabled={!editor?.can().undo()}\n              >\n                <Undo2 className=\"w-4 h-4 mr-1\" />\n                Undo\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\"\n                onClick={() => editor?.chain().focus().redo().run()}\n                disabled={!editor?.can().redo()}\n              >\n                <Redo2 className=\"w-4 h-4 mr-1\" />\n                Redo\n              </Button>\n            </div>\n\n            {/* Font controls */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-300 pr-4\">\n              <Select \n                value={fontFamily} \n                onValueChange={(value) => {\n                  if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      editor.chain().focus().setFontFamily(value).run();\n                      toast({ title: `Font changed to ${value} for selected text` });\n                    } else {\n                      toast({ title: \"Please select text to change font family\" });\n                    }\n                  }\n                }}\n              >\n                <SelectTrigger className=\"w-36\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Times New Roman\">Times New Roman</SelectItem>\n                  <SelectItem value=\"Arial\">Arial</SelectItem>\n                  <SelectItem value=\"Calibri\">Calibri</SelectItem>\n                  <SelectItem value=\"Georgia\">Georgia</SelectItem>\n                  <SelectItem value=\"Verdana\">Verdana</SelectItem>\n                  <SelectItem value=\"Helvetica\">Helvetica</SelectItem>\n                  <SelectItem value=\"Courier New\">Courier New</SelectItem>\n                  <SelectItem value=\"Comic Sans MS\">Comic Sans MS</SelectItem>\n                  <SelectItem value=\"Impact\">Impact</SelectItem>\n                  <SelectItem value=\"Trebuchet MS\">Trebuchet MS</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select \n                value={fontSize.toString()} \n                onValueChange={(value) => {\n                  const newSize = parseInt(value);\n                  if (!isNaN(newSize) && newSize >= 8 && newSize <= 72) {\n                    if (editor) {\n                      const { selection } = editor.state;\n                      if (!selection.empty) {\n                        editor.chain().focus().setMark('textStyle', { fontSize: newSize.toString() }).run();\n                        toast({ title: `Font size changed to ${newSize}pt for selected text` });\n                      } else {\n                        toast({ title: \"Please select text to change font size\" });\n                      }\n                    }\n                  }\n                }}\n              >\n                <SelectTrigger className=\"w-16\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"8\">8</SelectItem>\n                  <SelectItem value=\"9\">9</SelectItem>\n                  <SelectItem value=\"10\">10</SelectItem>\n                  <SelectItem value=\"11\">11</SelectItem>\n                  <SelectItem value=\"12\">12</SelectItem>\n                  <SelectItem value=\"14\">14</SelectItem>\n                  <SelectItem value=\"16\">16</SelectItem>\n                  <SelectItem value=\"18\">18</SelectItem>\n                  <SelectItem value=\"20\">20</SelectItem>\n                  <SelectItem value=\"22\">22</SelectItem>\n                  <SelectItem value=\"24\">24</SelectItem>\n                  <SelectItem value=\"26\">26</SelectItem>\n                  <SelectItem value=\"28\">28</SelectItem>\n                  <SelectItem value=\"36\">36</SelectItem>\n                  <SelectItem value=\"48\">48</SelectItem>\n                  <SelectItem value=\"72\">72</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Button \n                size=\"sm\" \n                variant=\"outline\" \n                onClick={() => {\n                  const newSize = Math.min(72, fontSize + 2);\n                  if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      editor.chain().focus().setMark('textStyle', { fontSize: newSize.toString() }).run();\n                      toast({ title: `Font size increased to ${newSize}pt for selected text` });\n                    } else {\n                      toast({ title: \"Please select text to change font size\" });\n                    }\n                  }\n                }}\n                disabled={fontSize >= 72}\n              >\n                <Plus className=\"w-3 h-3\" />\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\" \n                onClick={() => {\n                  const newSize = Math.max(8, fontSize - 2);\n                  if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      editor.chain().focus().setMark('textStyle', { fontSize: newSize.toString() }).run();\n                      toast({ title: `Font size decreased to ${newSize}pt for selected text` });\n                    } else {\n                      toast({ title: \"Please select text to change font size\" });\n                    }\n                  }\n                }}\n                disabled={fontSize <= 8}\n              >\n                <Minus className=\"w-3 h-3\" />\n              </Button>\n            </div>\n\n            {/* Text formatting */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-300 pr-4\">\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive('bold') ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().toggleBold().run()}\n              >\n                <Bold className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive('italic') ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().toggleItalic().run()}\n              >\n                <Italic className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive('underline') ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().toggleUnderline().run()}\n              >\n                <UnderlineIcon className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive('strike') ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().toggleStrike().run()}\n              >\n                <Strikethrough className=\"w-4 h-4\" />\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\" \n                title=\"Highlight\"\n                onClick={() => {\n                  if (!editor) return;\n                  const { selection } = editor.state;\n                  \n                  if (!selection.empty) {\n                    editor.chain().focus().toggleHighlight({ color: '#ffff00' }).run();\n                    toast({ title: \"Text highlighted\" });\n                  } else {\n                    toast({ title: \"Please select text to highlight\" });\n                  }\n                }}\n                disabled={!editor}\n              >\n                <div className=\"w-4 h-4 bg-yellow-300 border rounded\" />\n              </Button>\n              <input\n                type=\"color\"\n                value={textColor}\n                onChange={(e) => {\n                  const newColor = e.target.value;\n                  if (editor) {\n                    const { selection } = editor.state;\n                    if (!selection.empty) {\n                      editor.chain().focus().setColor(newColor).run();\n                      toast({ title: \"Color changed for selected text\" });\n                    } else {\n                      toast({ title: \"Please select text to change color\" });\n                    }\n                  }\n                }}\n                className=\"w-8 h-6 border rounded cursor-pointer\"\n                title=\"Font Color\"\n                disabled={!editor}\n              />\n            </div>\n\n            {/* Text alignment */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-300 pr-4\">\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive({ textAlign: 'left' }) ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().setTextAlign('left').run()}\n              >\n                <AlignLeft className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive({ textAlign: 'center' }) ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().setTextAlign('center').run()}\n              >\n                <AlignCenter className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive({ textAlign: 'right' }) ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().setTextAlign('right').run()}\n              >\n                <AlignRight className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive({ textAlign: 'justify' }) ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().setTextAlign('justify').run()}\n              >\n                <AlignJustify className=\"w-4 h-4\" />\n              </Button>\n            </div>\n\n            {/* Lists and indentation */}\n            <div className=\"flex items-center space-x-1\">\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive('bulletList') ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().toggleBulletList().run()}\n              >\n                <List className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={editor?.isActive('orderedList') ? 'default' : 'outline'}\n                onClick={() => editor?.chain().focus().toggleOrderedList().run()}\n              >\n                <ListOrdered className=\"w-4 h-4\" />\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\" \n                title=\"Increase Indent\"\n                onClick={() => {\n                  if (editor?.isActive('listItem')) {\n                    editor.chain().focus().sinkListItem('listItem').run();\n                  }\n                }}\n                disabled={!editor?.isActive('listItem')}\n              >\n                <Indent className=\"w-4 h-4\" />\n              </Button>\n              <Button \n                size=\"sm\" \n                variant=\"outline\" \n                title=\"Decrease Indent\"\n                onClick={() => {\n                  if (editor?.isActive('listItem')) {\n                    editor.chain().focus().liftListItem('listItem').run();\n                  }\n                }}\n                disabled={!editor?.isActive('listItem')}\n              >\n                <Outdent className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {/* Second toolbar line - Template specific controls */}\n          <div className=\"flex items-center space-x-4 overflow-x-auto\">\n            <div className=\"flex items-center space-x-2 border-r border-gray-300 pr-4\">\n              <span className=\"text-sm font-medium text-gray-700\">Template Type:</span>\n              <Select value={currentTemplate?.templateType || 'generic'} onValueChange={() => {}}>\n                <SelectTrigger className=\"w-32\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"generic\">Generic</SelectItem>\n                  <SelectItem value=\"academic\">Academic</SelectItem>\n                  <SelectItem value=\"business\">Business</SelectItem>\n                  <SelectItem value=\"report\">Report</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              <span className=\"text-sm text-gray-600\">{Object.keys(sections).length} sections</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Three-pane layout */}\n      <div className=\"flex h-[calc(100vh-73px)]\">\n        {/* Left Panel: Template History */}\n        <WorkspaceSidebar\n          workspaceType=\"template\"\n          currentWorkspaceId={currentTemplate?.id}\n          onNewWorkspace={() => {\n            createTemplateMutation.mutate();\n          }}\n        />\n\n        {/* Middle Panel: Template Editor */}\n        <div className=\"flex-1 flex flex-col bg-white\">\n          {/* Tab Interface for switching between Rich Editor and Sections */}\n          <div className=\"border-b border-gray-200 bg-white p-2\">\n            <div className=\"flex space-x-2\">\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                className=\"bg-green-100 text-green-700\"\n                onClick={() => {}}\n              >\n                <Type className=\"w-4 h-4 mr-1\" />\n                Rich Text Editor\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => {}}\n              >\n                <FileSpreadsheet className=\"w-4 h-4 mr-1\" />\n                Template Sections\n              </Button>\n            </div>\n          </div>\n\n          {/* Rich Text Editor Section - Word Document Style */}\n          <div className=\"flex-1 bg-gray-100 p-6 overflow-auto flex justify-center\">\n            {/* Single Page Container - Letter Size */}\n            <div className=\"bg-white shadow-lg\" style={{ \n              width: '8.5in', \n              minHeight: '11in',\n              maxWidth: '816px',\n              padding: '1in',\n              margin: '20px 0',\n              boxShadow: '0 4px 8px rgba(0,0,0,0.1), 0 6px 20px rgba(0,0,0,0.05)'\n            }}>\n              <div className=\"mb-4\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Template Content</h3>\n                <p className=\"text-sm text-gray-600\">Use the toolbar above to format your template content with fonts, colors, alignment, and more.</p>\n              </div>\n              \n              {/* Tiptap Editor - Full page content */}\n              <div className=\"min-h-[9in]\">\n                <EditorContent\n                  editor={editor}\n                  className=\"prose prose-lg max-w-none focus:outline-none\"\n                  style={{\n                    fontFamily,\n                    fontSize: `${fontSize}pt`,\n                    color: textColor,\n                    lineHeight: '1.6',\n                    minHeight: '9in',\n                    border: 'none',\n                    outline: 'none'\n                  }}\n                />\n              </div>\n\n              {/* Page Footer */}\n              <div className=\"mt-4 pt-4 border-t border-gray-200 flex justify-between items-center text-sm text-gray-500\">\n                <div>\n                  {editor ? `${editor.storage.characterCount?.characters() || 0} characters` : '0 characters'}\n                </div>\n                <div>\n                  Font: {fontFamily} | Size: {fontSize}pt | Page 1\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Original Template Sections - Hidden for now but can be toggled */}\n          <div className=\"hidden\">\n            <div className=\"border-b border-slate-200 p-4\">\n              <h2 className=\"text-lg font-semibold text-slate-900\">\n                {currentTemplate?.title || 'New Template'}\n              </h2>\n            </div>\n            \n            <div className=\"flex-1 p-6\">\n              {currentTemplate ? (\n                <div className=\"h-full\">\n                  <div className=\"grid gap-4 h-full\">\n                    {Object.keys(sections).length > 0 ? (\n                      Object.entries(sections).map(([key, value]) => (\n                        <div key={key} className=\"border border-slate-200 rounded-lg p-4\">\n                          <h3 className=\"font-semibold text-slate-900 mb-2\">{key}</h3>\n                          <textarea\n                            value={value as string}\n                            onChange={(e) => setSections(prev => ({ ...prev, [key]: e.target.value }))}\n                            className=\"w-full h-32 p-2 border border-slate-200 rounded resize-none focus:outline-none focus:ring-2 focus:ring-green-500\"\n                            placeholder={`Enter content for ${key}...`}\n                          />\n                        </div>\n                      ))\n                    ) : (\n                      <div className=\"flex items-center justify-center h-full\">\n                        <div className=\"text-center\">\n                          <FileSpreadsheet className=\"w-16 h-16 mx-auto mb-4 text-slate-300\" />\n                          <h3 className=\"text-lg font-semibold text-slate-900 mb-2\">Empty Template</h3>\n                          <p className=\"text-slate-600 mb-4\">Ask the AI assistant to create template sections</p>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"flex items-center justify-center h-full\">\n                  <div className=\"text-center\">\n                    <FileSpreadsheet className=\"w-16 h-16 mx-auto mb-4 text-slate-300\" />\n                    <h3 className=\"text-lg font-semibold text-slate-900 mb-2\">No Template Selected</h3>\n                    <p className=\"text-slate-600 mb-4\">Create a new template or select one from the sidebar</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel: AI Assistant */}\n        <ChatPanel\n          workspaceId={currentTemplate?.id || 'new'}\n          workspaceType=\"template\"\n          onAIResponse={handleAIResponse}\n        />\n      </div>\n    </div>\n  );\n}","size_bytes":26824},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }","size_bytes":1126},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"server/chatgpt-routes.ts":{"content":"import express from 'express';\nimport OpenAI from 'openai';\n\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\nconst router = express.Router();\n\n// Real ChatGPT-like conversation route\nrouter.post('/chat-sessions/:sessionId/messages', async (req, res) => {\n  try {\n    const { sessionId } = req.params;\n    const { content, documentContent, documentId } = req.body;\n\n    if (!content) {\n      return res.status(400).json({ error: 'Message content is required' });\n    }\n\n    // Build conversation context with document awareness but natural conversation\n    const systemPrompt = `You are ChatGPT, a helpful AI assistant created by OpenAI. You can have natural conversations about any topic, help with writing, answer questions, provide explanations, and assist with various tasks.\n\nYou are currently integrated into StudyFlow, a document editing platform. The user is working on a document, and you can help them with:\n- Writing and editing content\n- Answering questions about any topic\n- Providing explanations and clarifications  \n- Helping with research and analysis\n- Giving feedback and suggestions\n- Performing document operations when requested\n\nWhen the user asks you to modify their document (like \"add this to my document\", \"replace that text\", \"delete this section\", etc.), you can provide specific commands. But most importantly, have natural conversations just like the real ChatGPT.\n\nCurrent document content length: ${documentContent ? documentContent.length : 0} characters\n\nIMPORTANT: Respond naturally and conversationally. Only provide structured commands when the user explicitly asks you to modify their document. For general questions, explanations, help, or conversation, respond normally as you would on ChatGPT.com.\n\nIf the user asks you to modify the document, you can include special markers in your response:\n- [COMMAND:ADD_TEXT]text content here[/COMMAND] to add text\n- [COMMAND:REPLACE_TEXT:old_text]new text here[/COMMAND] to replace text\n- [COMMAND:DELETE_TEXT]text to delete[/COMMAND] to delete text\n- [COMMAND:FORMAT_TEXT:text_to_format:BOLD/ITALIC/UNDERLINE][/COMMAND] to format text\n\nBut again, only use these when explicitly asked to modify the document. For everything else, just chat naturally.`;\n\n    // Get chat history for this session to maintain conversation context\n    // Note: In a real implementation, you'd fetch this from storage\n    const messages: OpenAI.Chat.ChatCompletionMessageParam[] = [\n      { role: \"system\", content: systemPrompt },\n      { role: \"user\", content: content }\n    ];\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\", // the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\n      messages: messages,\n      temperature: 0.7, // Natural conversation temperature\n      max_tokens: 2000,\n      // No forced JSON format - let ChatGPT respond naturally\n    });\n\n    const aiContent = response.choices[0].message.content || '';\n\n    // Parse any document commands from the response\n    const documentCommands = parseDocumentCommands(aiContent);\n    \n    // Clean the response of command markers for display\n    const cleanContent = aiContent\n      .replace(/\\[COMMAND:.*?\\]/g, '')\n      .replace(/\\[\\/COMMAND\\]/g, '')\n      .trim();\n\n    // Build response in the format expected by the frontend\n    const chatResponse = {\n      content: cleanContent,\n      role: 'assistant',\n      timestamp: new Date().toISOString(),\n      // Include document commands if any were found\n      ...(documentCommands.length > 0 && { documentCommands })\n    };\n\n    res.json(chatResponse);\n  } catch (error) {\n    console.error('ChatGPT API error:', error);\n    res.status(500).json({ error: 'Failed to get response from ChatGPT' });\n  }\n});\n\n// Parse document commands from ChatGPT response\nfunction parseDocumentCommands(content: string): any[] {\n  const commands: any[] = [];\n  \n  // Parse ADD_TEXT commands\n  const addMatches = content.match(/\\[COMMAND:ADD_TEXT\\](.*?)\\[\\/COMMAND\\]/g);\n  if (addMatches) {\n    addMatches.forEach(match => {\n      const text = match.replace(/\\[COMMAND:ADD_TEXT\\]/, '').replace(/\\[\\/COMMAND\\]/, '');\n      commands.push({\n        type: 'add_text',\n        params: { text, position: 'end' }\n      });\n    });\n  }\n\n  // Parse REPLACE_TEXT commands\n  const replaceMatches = content.match(/\\[COMMAND:REPLACE_TEXT:(.*?)\\](.*?)\\[\\/COMMAND\\]/g);\n  if (replaceMatches) {\n    replaceMatches.forEach(match => {\n      const parts = match.match(/\\[COMMAND:REPLACE_TEXT:(.*?)\\](.*?)\\[\\/COMMAND\\]/);\n      if (parts && parts.length >= 3) {\n        commands.push({\n          type: 'replace_text',\n          params: { targetText: parts[1], newText: parts[2] }\n        });\n      }\n    });\n  }\n\n  // Parse DELETE_TEXT commands\n  const deleteMatches = content.match(/\\[COMMAND:DELETE_TEXT\\](.*?)\\[\\/COMMAND\\]/g);\n  if (deleteMatches) {\n    deleteMatches.forEach(match => {\n      const text = match.replace(/\\[COMMAND:DELETE_TEXT\\]/, '').replace(/\\[\\/COMMAND\\]/, '');\n      commands.push({\n        type: 'delete_text',\n        params: { text }\n      });\n    });\n  }\n\n  // Parse FORMAT_TEXT commands\n  const formatMatches = content.match(/\\[COMMAND:FORMAT_TEXT:(.*?):(.*?)\\]\\[\\/COMMAND\\]/g);\n  if (formatMatches) {\n    formatMatches.forEach(match => {\n      const parts = match.match(/\\[COMMAND:FORMAT_TEXT:(.*?):(.*?)\\]\\[\\/COMMAND\\]/);\n      if (parts && parts.length >= 3) {\n        const formatting: any = {};\n        const formatType = parts[2].toLowerCase();\n        if (formatType.includes('bold')) formatting.bold = true;\n        if (formatType.includes('italic')) formatting.italic = true;\n        if (formatType.includes('underline')) formatting.underline = true;\n        \n        commands.push({\n          type: 'format_text',\n          params: { text: parts[1], formatting }\n        });\n      }\n    });\n  }\n\n  return commands;\n}\n\nexport default router;","size_bytes":5952},"server/ai-routes.ts":{"content":"import express from 'express';\nimport OpenAI from 'openai';\n\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\nconst router = express.Router();\n\n// AI Writing Improvement Route\nrouter.post('/improve-writing', async (req, res) => {\n  try {\n    const { content, preserveEquations = true, preserveNotations = true } = req.body;\n\n    if (!content || content.trim().length === 0) {\n      return res.status(400).json({ error: 'Content is required' });\n    }\n\n    const systemPrompt = `You are an intelligent writing assistant that makes text better while keeping everything well-organized and properly formatted.\n\nINTELLIGENT IMPROVEMENT APPROACH:\n- Fix grammar, spelling, and awkward phrasing naturally\n- Enhance clarity and flow without changing the author's voice\n- Improve word choice and sentence structure thoughtfully\n- Maintain professional tone and readability\n- Preserve all existing formatting (headings, paragraphs, bold, italic, etc.)\n- Keep the document structure intact (separate paragraphs stay separate)\n- Respect the author's intended organization and layout\n${preserveEquations ? '- Keep all mathematical content exactly as written' : ''}\n${preserveNotations ? '- Preserve technical terminology and scientific notations' : ''}\n\nSMART BEHAVIOR:\n- Never merge well-structured paragraphs into a blob\n- Never remove intentional formatting or structure\n- Never change technical terms or proper nouns unnecessarily  \n- Never alter the fundamental meaning or style\n- Always maintain the document's visual organization\n\nYour goal is to make the writing cleaner, clearer, and more polished while respecting how the author organized their content.`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\", // the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: content }\n      ],\n      temperature: 0.3, // Lower temperature for consistent, focused improvements\n    });\n\n    const improvedContent = response.choices[0].message.content;\n\n    res.json({ improvedContent });\n  } catch (error) {\n    console.error('AI improve writing error:', error);\n    res.status(500).json({ error: 'Failed to improve writing' });\n  }\n});\n\n// AI Tone Adjustment Route\nrouter.post('/adjust-tone', async (req, res) => {\n  try {\n    const { content, targetTone = 'professional', preserveEquations = true } = req.body;\n\n    if (!content || content.trim().length === 0) {\n      return res.status(400).json({ error: 'Content is required' });\n    }\n\n    const toneInstructions = {\n      professional: 'formal, clear, and authoritative while maintaining readability',\n      academic: 'scholarly, precise, and objective with appropriate academic language',\n      casual: 'conversational, friendly, and approachable while remaining clear',\n      formal: 'highly formal, structured, and ceremonious language',\n      creative: 'engaging, expressive, and imaginative while staying coherent'\n    };\n\n    const systemPrompt = `You are an intelligent writing assistant that adjusts tone while preserving content quality and organization.\n\nTONE TARGET: Make the text ${toneInstructions[targetTone as keyof typeof toneInstructions] || toneInstructions.professional}.\n\nSMART TONE ADJUSTMENT:\n- Modify word choice and phrasing to match the target tone\n- Adjust sentence structure and complexity appropriately\n- Maintain the author's intended meaning and key points\n- Preserve document structure and paragraph organization\n- Keep all formatting (headings, lists, emphasis) intact\n${preserveEquations ? '- Keep mathematical content exactly as written' : ''}\n- Respect technical terms and proper terminology\n\nINTELLIGENT BEHAVIOR:\n- Never flatten well-structured content\n- Never remove intentional formatting\n- Never change factual information or core concepts\n- Always maintain logical flow and readability\n\nAdjust the tone thoughtfully while keeping the content well-organized and professionally presented.`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\", // the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: content }\n      ],\n      temperature: 0.4, // Slightly higher for tone variation while maintaining consistency\n    });\n\n    const adjustedContent = response.choices[0].message.content;\n\n    res.json({ adjustedContent });\n  } catch (error) {\n    console.error('AI tone adjustment error:', error);\n    res.status(500).json({ error: 'Failed to adjust tone' });\n  }\n});\n\n// AI Content Improvement Route (alternative endpoint)\nrouter.post('/improve-content', async (req, res) => {\n  try {\n    const { content, documentId, instruction } = req.body;\n\n    if (!content || content.trim().length === 0) {\n      return res.status(400).json({ error: 'Content is required' });\n    }\n\n    const systemPrompt = `You are an intelligent writing assistant that improves content while maintaining structure and meaning.\n\nIMPROVEMENT APPROACH:\n- Fix grammar, spelling, and awkward phrasing naturally\n- Enhance clarity and flow without changing the author's voice\n- Improve word choice and sentence structure thoughtfully\n- Maintain professional tone and readability\n- Preserve all existing formatting (headings, paragraphs, bold, italic, etc.)\n- Keep the document structure intact (separate paragraphs stay separate)\n- Keep all mathematical content and technical terminology exactly as written\n- Preserve HTML formatting and structure\n\nSMART BEHAVIOR:\n- Never merge well-structured paragraphs\n- Never remove intentional formatting or structure\n- Never change technical terms or proper nouns unnecessarily  \n- Never alter the fundamental meaning or style\n- Always maintain the document's visual organization\n- Return content in the same HTML format as received\n\nYour goal is to make the writing cleaner, clearer, and more polished while respecting the original organization.`;\n\n    const userPrompt = instruction ? `${instruction}\\n\\nContent to improve:\\n${content}` : content;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt }\n      ],\n      temperature: 0.3,\n    });\n\n    const improvedContent = response.choices[0].message.content;\n\n    res.json({ improvedContent });\n  } catch (error) {\n    console.error('AI improve content error:', error);\n    res.status(500).json({ error: 'Failed to improve content' });\n  }\n});\n\nexport default router;","size_bytes":6785},"debug_layout.js":{"content":"// Debug script to test box positioning\nconsole.log('=== TESTING BOX LAYOUT CONSTRAINTS ===');\n\n// Test the positioning logic from the code\nconst PAGE_WIDTH = 816;\nconst PAGE_HEIGHT = 1056;\nconst MARGIN = 72;\nconst BOX_WIDTH = 200;\nconst BOX_HEIGHT = 150;\nconst SPACING = 20;\n\n// Calculate boxes per row\nconst usableWidth = PAGE_WIDTH - (2 * MARGIN);\nconst boxesPerRow = Math.floor(usableWidth / (BOX_WIDTH + SPACING));\n\nconsole.log(`Page width: ${PAGE_WIDTH}px`);\nconsole.log(`Usable width (with margins): ${usableWidth}px`);\nconsole.log(`Box width + spacing: ${BOX_WIDTH + SPACING}px`);\nconsole.log(`Calculated boxes per row: ${boxesPerRow}`);\n\nconsole.log('\\n=== TESTING 15 BOX POSITIONS ===');\n\nfor (let i = 0; i < 15; i++) {\n  const row = Math.floor(i / boxesPerRow);\n  const col = i % boxesPerRow;\n  const page = Math.floor(row / Math.floor((PAGE_HEIGHT - 2 * MARGIN) / (BOX_HEIGHT + SPACING)));\n  \n  const x = MARGIN + col * (BOX_WIDTH + SPACING) + (page * (PAGE_WIDTH + 40));\n  const y = MARGIN + (row % Math.floor((PAGE_HEIGHT - 2 * MARGIN) / (BOX_HEIGHT + SPACING))) * (BOX_HEIGHT + SPACING) + (page * 40);\n  \n  const withinBounds = x + BOX_WIDTH <= PAGE_WIDTH + (page * (PAGE_WIDTH + 40));\n  \n  console.log(`Box ${i + 1}: x=${x}, y=${y}, page=${page + 1}, row=${row}, col=${col}, withinBounds=${withinBounds}`);\n  \n  if (!withinBounds) {\n    console.log(`❌ Box ${i + 1} EXCEEDS PAGE BOUNDARIES!`);\n  }\n}\n\nconsole.log('\\n=== BOUNDARY TEST ===');\nconsole.log(`Page boundary: 0 to ${PAGE_WIDTH}px width`);\nconsole.log(`Max allowed X for box: ${PAGE_WIDTH - BOX_WIDTH}px`);","size_bytes":1582},"debug_state.js":{"content":"// Debug the box state management and resizing issues\nconsole.log('=== INVESTIGATING STATE MANAGEMENT ISSUES ===');\n\n// Simulate box state structure\nconst mockBoxes = [\n  { id: 'box1', x: 72, y: 72, width: 200, height: 150, title: 'Box 1', content: 'Content 1' },\n  { id: 'box2', x: 292, y: 72, width: 200, height: 150, title: 'Box 2', content: 'Content 2' },\n  { id: 'box3', x: 512, y: 72, width: 200, height: 150, title: 'Box 3', content: 'Content 3' }\n];\n\nconsole.log('=== BOX STATE STRUCTURE ===');\nmockBoxes.forEach((box, index) => {\n  console.log(`Box ${index + 1}: ${JSON.stringify(box, null, 2)}`);\n});\n\nconsole.log('\\n=== CHECKING FOR SHARED STATE ISSUES ===');\nconsole.log('Each box should have individual size state:');\nconsole.log('- position: { x, y } (individual)');\nconsole.log('- size: { width, height } (individual)');\nconsole.log('- content state (individual)');\n\nconsole.log('\\n=== IDENTIFYING SYNC PROBLEMS ===');\nconsole.log('Potential causes of synchronized resizing:');\nconsole.log('1. Shared size reference across components');\nconsole.log('2. State updates affecting all boxes instead of individual box');\nconsole.log('3. Size calculations based on shared variables');\nconsole.log('4. Missing key props causing React re-render issues');\n\nconsole.log('\\n=== MULTI-PAGE POSITIONING ISSUE ===');\nconsole.log('Problem: Boxes spreading across 4 pages instead of staying in single page');\nconsole.log('Expected behavior: 50 boxes in 3-column grid within 816px width');\nconsole.log('Current behavior: Horizontal page expansion (856px * 4 pages = 3424px total width)');\n\n// Test what 50 boxes would look like in a single page constraint\nconst SINGLE_PAGE_WIDTH = 816;\nconst SINGLE_PAGE_HEIGHT = 1056;\nconst MARGIN = 20; // Smaller margins for more space\nconst BOX_SIZE = 150; // Smaller boxes\nconst SPACING = 10; // Tighter spacing\n\nconst singlePageUsable = SINGLE_PAGE_WIDTH - (2 * MARGIN);\nconst boxesPerRowSinglePage = Math.floor(singlePageUsable / (BOX_SIZE + SPACING));\nconst rowsAvailable = Math.floor((SINGLE_PAGE_HEIGHT - 2 * MARGIN) / (BOX_SIZE + SPACING));\nconst maxBoxesSinglePage = boxesPerRowSinglePage * rowsAvailable;\n\nconsole.log('\\n=== SINGLE PAGE CONSTRAINT ANALYSIS ===');\nconsole.log(`Usable width: ${singlePageUsable}px`);\nconsole.log(`Box + spacing: ${BOX_SIZE + SPACING}px`);\nconsole.log(`Boxes per row: ${boxesPerRowSinglePage}`);\nconsole.log(`Available rows: ${rowsAvailable}`);\nconsole.log(`Max boxes in single page: ${maxBoxesSinglePage}`);\nconsole.log(`Can 50 boxes fit? ${maxBoxesSinglePage >= 50 ? 'YES' : 'NO'}`);","size_bytes":2561},"test_boundaries.js":{"content":"// Test drag boundary constraints\nconsole.log('=== TESTING DRAG BOUNDARY CONSTRAINTS ===');\n\nconst PAGE_WIDTH = 816;\nconst PAGE_HEIGHT = 1056;\nconst MARGIN = 20;\nconst boxHeight = 150; // Typical box height\n\n// Test various drag positions\nconst testPositions = [\n  { x: -50, y: 100, desc: \"Dragged left outside boundary\" },\n  { x: 900, y: 100, desc: \"Dragged right beyond single page\" },\n  { x: 2000, y: 100, desc: \"Dragged far right\" },\n  { x: 5000, y: 100, desc: \"Dragged extremely far right\" },\n  { x: 400, y: -50, desc: \"Dragged above top\" },\n  { x: 400, y: 1200, desc: \"Dragged below page height\" },\n  { x: 400, y: 2000, desc: \"Dragged far below\" }\n];\n\ntestPositions.forEach(pos => {\n  // Apply the constraint logic from handleDragStop\n  const constrainedX = Math.max(MARGIN, Math.min(pos.x, PAGE_WIDTH * 5));\n  const constrainedY = Math.max(MARGIN, Math.min(pos.y, PAGE_HEIGHT - boxHeight - MARGIN));\n  \n  const isConstrained = constrainedX !== pos.x || constrainedY !== pos.y;\n  \n  console.log(`${pos.desc}:`);\n  console.log(`  Original: (${pos.x}, ${pos.y})`);\n  console.log(`  Constrained: (${constrainedX}, ${constrainedY})`);\n  console.log(`  Was constrained: ${isConstrained}`);\n  console.log('');\n});\n\nconsole.log('=== BOUNDARY LIMITS ===');\nconsole.log(`Min X: ${MARGIN}`);\nconsole.log(`Max X: ${PAGE_WIDTH * 5} (5 pages)`);\nconsole.log(`Min Y: ${MARGIN}`);\nconsole.log(`Max Y: ${PAGE_HEIGHT - boxHeight - MARGIN}`);","size_bytes":1430},"attached_assets/auto-resize-math-box_1754217986143.tsx":{"content":"import { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport Draggable, { DraggableEvent, DraggableData } from 'react-draggable';\nimport { ResizableBox, ResizeCallbackData } from 'react-resizable';\nimport { SyntheticEvent } from 'react';\nimport 'react-resizable/css/styles.css';\nimport LaTeXRenderer from './latex-renderer';\n\n// Constants\nconst SIZING_CONSTANTS = {\n  TITLE_HEIGHT: 48,\n  PADDING: 24,\n  MIN_FONT_SIZE: 8,\n  MAX_FONT_SIZE: 24,\n  DEFAULT_FONT_SIZE: 14,\n  DEBOUNCE_DELAY: 100,\n} as const;\n\ninterface Size {\n  width: number;\n  height: number;\n}\n\ninterface Position {\n  x: number;\n  y: number;\n}\n\ninterface AutoResizeMathBoxProps {\n  id: string;\n  title: string;\n  content: string;\n  color: string;\n  position: Position;\n  size?: Size;\n  onPositionChange: (position: Position) => void;\n  onSizeChange: (size: Size) => void;\n  onSaveRequest: () => void;\n  boxNumber: number;\n  isGridMode?: boolean;\n  minWidth?: number;\n  maxWidth?: number;\n  minHeight?: number;\n  maxHeight?: number;\n}\n\nexport default function AutoResizeMathBox({\n  id,\n  title,\n  content,\n  color,\n  position,\n  size: externalSize,\n  onPositionChange,\n  onSizeChange,\n  onSaveRequest,\n  boxNumber,\n  isGridMode = false,\n  minWidth = 100,\n  maxWidth = 1200,\n  minHeight = 80,\n  maxHeight = 800\n}: AutoResizeMathBoxProps) {\n  const [currentSize, setCurrentSize] = useState<Size>(externalSize || { width: 300, height: 200 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [optimalFontSize, setOptimalFontSize] = useState(SIZING_CONSTANTS.DEFAULT_FONT_SIZE);\n  const [contentLayout, setContentLayout] = useState({ lineHeight: 1.4, wordSpacing: 'normal' });\n  \n  const contentRef = useRef<HTMLDivElement>(null);\n  const resizeTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Calculate optimal font size and layout for current box dimensions\n  const calculateOptimalDisplay = useCallback((boxSize: Size): { fontSize: number; lineHeight: number; wordSpacing: string; letterSpacing: string } => {\n    if (!contentRef.current || !content.trim()) {\n      return { \n        fontSize: SIZING_CONSTANTS.DEFAULT_FONT_SIZE, \n        lineHeight: 1.4, \n        wordSpacing: 'normal',\n        letterSpacing: 'normal'\n      };\n    }\n\n    const availableWidth = boxSize.width - SIZING_CONSTANTS.PADDING;\n    const availableHeight = boxSize.height - SIZING_CONSTANTS.TITLE_HEIGHT - SIZING_CONSTANTS.PADDING;\n\n    // Create measurement container\n    const measureContainer = document.createElement('div');\n    measureContainer.style.cssText = `\n      position: absolute;\n      visibility: hidden;\n      top: -9999px;\n      left: -9999px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      white-space: pre-wrap;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n      hyphens: auto;\n      contain: layout style paint;\n    `;\n\n    try {\n      document.body.appendChild(measureContainer);\n      \n      // Binary search for optimal font size\n      let minFont = SIZING_CONSTANTS.MIN_FONT_SIZE;\n      let maxFont = SIZING_CONSTANTS.MAX_FONT_SIZE;\n      let bestFit = { fontSize: minFont, lineHeight: 1.2, wordSpacing: 'normal', letterSpacing: 'normal' };\n      \n      while (maxFont - minFont > 0.5) {\n        const testFont = (minFont + maxFont) / 2;\n        \n        // Test different line heights for better fitting\n        const lineHeights = [1.1, 1.2, 1.3, 1.4, 1.5];\n        let fitsWithThisFont = false;\n        \n        for (const lineHeight of lineHeights) {\n          measureContainer.style.cssText += `\n            font-size: ${testFont}px;\n            line-height: ${lineHeight};\n            width: ${availableWidth}px;\n            height: auto;\n            max-height: none;\n          `;\n          \n          measureContainer.textContent = content;\n          \n          const contentHeight = measureContainer.scrollHeight;\n          \n          if (contentHeight <= availableHeight) {\n            bestFit = { \n              fontSize: testFont, \n              lineHeight, \n              wordSpacing: availableWidth < 200 ? '-0.05em' : 'normal',\n              letterSpacing: availableWidth < 150 ? '-0.02em' : 'normal'\n            };\n            fitsWithThisFont = true;\n            break;\n          }\n        }\n        \n        if (fitsWithThisFont) {\n          minFont = testFont;\n        } else {\n          maxFont = testFont;\n        }\n      }\n      \n      // If content still doesn't fit, try more aggressive spacing\n      if (bestFit.fontSize === SIZING_CONSTANTS.MIN_FONT_SIZE) {\n        measureContainer.style.cssText += `\n          font-size: ${bestFit.fontSize}px;\n          line-height: 1.1;\n          width: ${availableWidth}px;\n          word-spacing: -0.1em;\n          letter-spacing: -0.03em;\n        `;\n        measureContainer.textContent = content;\n        \n        if (measureContainer.scrollHeight <= availableHeight) {\n          bestFit = {\n            fontSize: bestFit.fontSize,\n            lineHeight: 1.1,\n            wordSpacing: '-0.1em',\n            letterSpacing: '-0.03em'\n          };\n        }\n      }\n      \n      return bestFit;\n      \n    } catch (error) {\n      console.error('Error calculating optimal display:', error);\n      return { \n        fontSize: SIZING_CONSTANTS.DEFAULT_FONT_SIZE, \n        lineHeight: 1.4, \n        wordSpacing: 'normal',\n        letterSpacing: 'normal'\n      };\n    } finally {\n      if (measureContainer.parentNode) {\n        document.body.removeChild(measureContainer);\n      }\n    }\n  }, [content]);\n\n  // Debounced recalculation\n  const debouncedRecalculate = useCallback(() => {\n    if (resizeTimerRef.current) {\n      clearTimeout(resizeTimerRef.current);\n    }\n    \n    resizeTimerRef.current = setTimeout(() => {\n      const optimal = calculateOptimalDisplay(currentSize);\n      setOptimalFontSize(optimal.fontSize);\n      setContentLayout({\n        lineHeight: optimal.lineHeight,\n        wordSpacing: optimal.wordSpacing\n      });\n    }, SIZING_CONSTANTS.DEBOUNCE_DELAY);\n  }, [calculateOptimalDisplay, currentSize]);\n\n  // Recalculate when size or content changes\n  useEffect(() => {\n    debouncedRecalculate();\n  }, [currentSize, content, debouncedRecalculate]);\n\n  // Sync with external size changes\n  useEffect(() => {\n    if (externalSize && (externalSize.width !== currentSize.width || externalSize.height !== currentSize.height)) {\n      setCurrentSize(externalSize);\n    }\n  }, [externalSize, currentSize]);\n\n  // Cleanup\n  useEffect(() => {\n    return () => {\n      if (resizeTimerRef.current) {\n        clearTimeout(resizeTimerRef.current);\n      }\n    };\n  }, []);\n\n  const handleDragStart = useCallback(() => {\n    setIsDragging(true);\n  }, []);\n\n  const handleDragStop = useCallback((e: DraggableEvent, data: DraggableData) => {\n    setIsDragging(false);\n    onPositionChange({ x: data.x, y: data.y });\n    onSaveRequest();\n  }, [onPositionChange, onSaveRequest]);\n\n  const handleResize = useCallback((e: SyntheticEvent, { size }: ResizeCallbackData) => {\n    setCurrentSize(size);\n    onSizeChange(size);\n  }, [onSizeChange]);\n\n  const handleResizeStop = useCallback(() => {\n    onSaveRequest();\n  }, [onSaveRequest]);\n\n  // Calculate initial size if not provided\n  const initialSize = useMemo(() => {\n    if (externalSize) return externalSize;\n    \n    // Quick estimation for initial size\n    const wordCount = content.split(/\\s+/).length;\n    const hasComplexMath = /\\\\[a-zA-Z]+|\\^|\\{|\\}|_/.test(content);\n    \n    let estimatedWidth = Math.min(maxWidth, Math.max(minWidth, Math.sqrt(wordCount) * 40));\n    let estimatedHeight = Math.min(maxHeight, Math.max(minHeight, wordCount * 2 + 100));\n    \n    if (hasComplexMath) {\n      estimatedHeight += 50;\n      estimatedWidth += 100;\n    }\n    \n    return { \n      width: Math.round(estimatedWidth), \n      height: Math.round(estimatedHeight) \n    };\n  }, [content, externalSize, maxWidth, minWidth, maxHeight, minHeight]);\n\n  // Use initial size if currentSize hasn't been set\n  const boxSize = currentSize.width > 0 ? currentSize : initialSize;\n\n  const borderColor = `hsl(${(boxNumber * 50) % 360}, 70%, 50%)`;\n\n  // Dynamic styles for content\n  const contentStyles = useMemo(() => ({\n    fontSize: `${optimalFontSize}px`,\n    lineHeight: contentLayout.lineHeight,\n    wordSpacing: contentLayout.wordSpacing,\n    letterSpacing: (contentLayout as any).letterSpacing || 'normal',\n    overflow: 'hidden',\n    textOverflow: 'clip',\n    wordWrap: 'break-word' as const,\n    overflowWrap: 'break-word' as const,\n    hyphens: 'auto' as const,\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'flex-start',\n    textAlign: 'left' as const,\n    width: '100%',\n    height: '100%',\n    padding: '0',\n    margin: '0'\n  }), [optimalFontSize, contentLayout]);\n\n  return (\n    <Draggable\n      position={isDragging ? undefined : position}\n      defaultPosition={isDragging ? position : undefined}\n      onStart={handleDragStart}\n      onStop={handleDragStop}\n      grid={[5, 5]}\n      handle=\".drag-handle\"\n      disabled={isGridMode}\n    >\n      <div \n        className=\"absolute\" \n        style={{ \n          width: `${boxSize.width}px`,\n          height: `${boxSize.height}px`\n        }}\n        role=\"region\"\n        aria-label={`Math box ${boxNumber}: ${title}`}\n      >\n        {!isGridMode ? (\n          // Manual resize mode\n          <ResizableBox\n            width={boxSize.width}\n            height={boxSize.height}\n            minConstraints={[minWidth, minHeight]}\n            maxConstraints={[maxWidth, maxHeight]}\n            onResize={handleResize}\n            onResizeStop={handleResizeStop}\n            resizeHandles={['se', 'sw', 'ne', 'nw', 's', 'n', 'e', 'w']}\n            className=\"relative group\"\n          >\n            <div \n              className={`w-full h-full bg-gradient-to-br ${color} rounded-xl border-2 shadow-lg hover:shadow-xl transition-all duration-200 relative`} \n              style={{ border: `3px solid ${borderColor}` }}\n            >\n              <div \n                className=\"drag-handle w-full h-full cursor-move\"\n                role=\"button\"\n                aria-label={`Drag to move box ${boxNumber}`}\n                tabIndex={0}\n              >\n                {/* Title Header */}\n                <div className=\"flex items-center justify-between p-3 border-b border-white/20 bg-white/10 backdrop-blur-sm\">\n                  <div className=\"flex items-center space-x-2 flex-1 min-w-0\">\n                    <div \n                      className=\"w-6 h-6 bg-slate-600 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0\"\n                      aria-label={`Box number ${boxNumber}`}\n                    >\n                      {boxNumber}\n                    </div>\n                    <h4 className=\"font-semibold text-slate-900 text-sm truncate select-none\">\n                      {title}\n                    </h4>\n                  </div>\n                  <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex items-center space-x-1\">\n                    <div className=\"text-xs text-slate-600 bg-white/20 px-2 py-1 rounded\">\n                      {Math.round(optimalFontSize)}px\n                    </div>\n                    <div \n                      className=\"w-4 h-4 bg-slate-400/30 rounded-full flex items-center justify-center\"\n                      aria-label=\"Resize handles\"\n                    >\n                      <div className=\"w-2 h-2 bg-slate-600 rounded-full\"></div>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Content Container - Always fits content */}\n                <div \n                  className=\"relative\"\n                  style={{ \n                    height: `${boxSize.height - SIZING_CONSTANTS.TITLE_HEIGHT}px`,\n                    padding: `${SIZING_CONSTANTS.PADDING / 2}px`,\n                    overflow: 'hidden'\n                  }}\n                >\n                  <div \n                    ref={contentRef}\n                    className=\"w-full h-full\"\n                    style={contentStyles}\n                    onClick={(e) => e.stopPropagation()}\n                    role=\"region\"\n                    aria-label=\"Auto-fitting content\"\n                  >\n                    <LaTeXRenderer \n                      content={content} \n                      className=\"w-full h-full math-content\"\n                      displayMode={false}\n                      style={{\n                        fontSize: 'inherit',\n                        lineHeight: 'inherit',\n                        wordSpacing: 'inherit',\n                        letterSpacing: 'inherit',\n                        overflow: 'hidden',\n                        display: 'block',\n                        width: '100%',\n                        height: '100%'\n                      }}\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </ResizableBox>\n        ) : (\n          // Grid mode - auto-sizing only\n          <div \n            className={`w-full h-full bg-gradient-to-br ${color} rounded-xl border-2 shadow-lg hover:shadow-xl transition-all duration-200 relative`}\n            style={{ border: `3px solid ${borderColor}` }}\n          >\n            {/* Title Header */}\n            <div className=\"flex items-center justify-between p-3 border-b border-white/20 bg-white/10 backdrop-blur-sm\">\n              <div className=\"flex items-center space-x-2 flex-1 min-w-0\">\n                <div \n                  className=\"w-6 h-6 bg-slate-600 text-white text-xs font-bold rounded-full flex items-center justify-center flex-shrink-0\"\n                  aria-label={`Box number ${boxNumber}`}\n                >\n                  {boxNumber}\n                </div>\n                <h4 className=\"font-semibold text-slate-900 text-sm truncate select-none\">\n                  {title}\n                </h4>\n              </div>\n              <div className=\"text-xs text-slate-600 bg-white/20 px-2 py-1 rounded\">\n                Auto-fit\n              </div>\n            </div>\n            \n            {/* Content Container */}\n            <div \n              className=\"relative\"\n              style={{ \n                height: `${boxSize.height - SIZING_CONSTANTS.TITLE_HEIGHT}px`,\n                padding: `${SIZING_CONSTANTS.PADDING / 2}px`,\n                overflow: 'hidden'\n              }}\n            >\n              <div \n                ref={contentRef}\n                className=\"w-full h-full\"\n                style={contentStyles}\n                role=\"region\"\n                aria-label=\"Auto-fitting content\"\n              >\n                <LaTeXRenderer \n                  content={content} \n                  className=\"w-full h-full math-content\"\n                  displayMode={false}\n                  style={{\n                    fontSize: 'inherit',\n                    lineHeight: 'inherit',\n                    wordSpacing: 'inherit',\n                    letterSpacing: 'inherit',\n                    overflow: 'hidden',\n                    display: 'block',\n                    width: '100%',\n                    height: '100%'\n                  }}\n                />\n              </div>\n            </div>\n            \n            {/* Auto-fit indicator */}\n            <div \n              className=\"absolute bottom-1 right-1 w-3 h-3 opacity-60 pointer-events-none\"\n              aria-label=\"Auto-fit mode\"\n            >\n              <div className=\"w-full h-full bg-green-400 rounded-full animate-pulse\"></div>\n            </div>\n          </div>\n        )}\n      </div>\n    </Draggable>\n  );\n}\n\nexport { AutoResizeMathBox };","size_bytes":15727},"client/src/components/layout-engine-demo.tsx":{"content":"/**\n * Layout Engine Demo Component\n * \n * Demonstrates the advanced layout engine capabilities including:\n * - Automatic pagination based on content\n * - Dynamic font scaling when page size changes\n * - Content reflow capabilities\n * - Preview mode functionality\n */\n\nimport { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Separator } from '@/components/ui/separator';\nimport { LayoutEngine, createLayoutEngine, PAGE_CONFIGS } from '@/lib/layout-engine';\nimport { DocumentCommandInterface, createDocumentInterface } from '@/lib/document-commands';\nimport { \n  FileText, Play, Eye, RotateCcw, Zap, \n  Layout, Type, Clock, Layers \n} from 'lucide-react';\n\nexport default function LayoutEngineDemo() {\n  const [pageSize, setPageSize] = useState('letter');\n  const [fontSize, setFontSize] = useState(12);\n  const [inputContent, setInputContent] = useState(`Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.\n\nDuis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n\nSed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.\n\nNemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.`);\n\n  const [layoutEngine] = useState(() => createLayoutEngine(pageSize, fontSize));\n  const [documentInterface] = useState(() => createDocumentInterface(inputContent, pageSize, fontSize));\n  const [layoutResult, setLayoutResult] = useState(null);\n  const [previewResult, setPreviewResult] = useState(null);\n  const [metrics, setMetrics] = useState(null);\n\n  // Demo functions\n  const runLayoutDemo = () => {\n    const engine = createLayoutEngine(pageSize, fontSize);\n    const result = engine.LAYOUT_TEXT(inputContent);\n    setLayoutResult(result);\n    setMetrics(result.metrics);\n  };\n\n  const runPreviewDemo = () => {\n    const engine = createLayoutEngine(pageSize, fontSize);\n    const preview = engine.PREVIEW_LAYOUT(inputContent);\n    setPreviewResult(preview);\n  };\n\n  const runReflowDemo = () => {\n    const engine = createLayoutEngine('letter', 12); // Start with letter size\n    const result = engine.REFLOW_CONTENT(inputContent, pageSize, fontSize);\n    setLayoutResult(result);\n    setMetrics(result.metrics);\n  };\n\n  const runCommandDemo = () => {\n    const docInterface = createDocumentInterface(inputContent, pageSize, fontSize);\n    \n    // Demonstrate command execution\n    const commands = [\n      ['LAYOUT_TEXT', inputContent],\n      ['SET_FONT_SIZE', fontSize],\n      ['SET_PAGE_SIZE', pageSize],\n      ['GET_METRICS'],\n      ['PREVIEW_LAYOUT', inputContent + '\\n\\nAdditional content for preview...']\n    ];\n\n    let result;\n    commands.forEach(([command, ...args]) => {\n      result = docInterface.executeCommand(command, args);\n      console.log(`${command}:`, result);\n    });\n\n    const finalState = docInterface.getState();\n    setLayoutResult(finalState.layoutEngine.LAYOUT_TEXT(finalState.content));\n    setMetrics(finalState.metrics);\n  };\n\n  // Auto-run layout when settings change\n  useEffect(() => {\n    runLayoutDemo();\n  }, [pageSize, fontSize, inputContent]);\n\n  const currentPageConfig = PAGE_CONFIGS[pageSize];\n  const scaledFontSize = fontSize * (currentPageConfig.width / PAGE_CONFIGS.letter.width);\n\n  return (\n    <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\n      <div className=\"text-center mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\n          Layout Engine Demonstration\n        </h1>\n        <p className=\"text-lg text-gray-600 dark:text-gray-400\">\n          Advanced automatic pagination and content flow management\n        </p>\n      </div>\n\n      {/* Controls */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Layout className=\"w-5 h-5 mr-2\" />\n            Layout Controls\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4\">\n            <div>\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block\">\n                Page Size\n              </label>\n              <Select value={pageSize} onValueChange={setPageSize}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {Object.entries(PAGE_CONFIGS).map(([key, config]) => (\n                    <SelectItem key={key} value={key}>\n                      {config.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <div>\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block\">\n                Font Size\n              </label>\n              <Select value={fontSize.toString()} onValueChange={(value) => setFontSize(parseInt(value))}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {[8, 10, 11, 12, 14, 16, 18, 20, 24, 28, 32].map(size => (\n                    <SelectItem key={size} value={size.toString()}>{size}pt</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <div className=\"flex flex-col\">\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block\">\n                Auto-scaled Font\n              </label>\n              <div className=\"text-lg font-bold text-blue-600 dark:text-blue-400 mt-2\">\n                {Math.round(scaledFontSize)}pt\n              </div>\n            </div>\n            \n            <div className=\"flex flex-col\">\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block\">\n                Page Dimensions\n              </label>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                {currentPageConfig.width} × {currentPageConfig.height}px\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mb-4\">\n            <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block\">\n              Content to Layout\n            </label>\n            <Textarea\n              value={inputContent}\n              onChange={(e) => setInputContent(e.target.value)}\n              placeholder=\"Enter content to demonstrate automatic pagination...\"\n              className=\"min-h-[120px]\"\n            />\n          </div>\n\n          <div className=\"flex flex-wrap gap-2\">\n            <Button onClick={runLayoutDemo} className=\"flex items-center\">\n              <Play className=\"w-4 h-4 mr-2\" />\n              Run Layout\n            </Button>\n            <Button onClick={runPreviewDemo} variant=\"outline\" className=\"flex items-center\">\n              <Eye className=\"w-4 h-4 mr-2\" />\n              Preview Only\n            </Button>\n            <Button onClick={runReflowDemo} variant=\"outline\" className=\"flex items-center\">\n              <RotateCcw className=\"w-4 h-4 mr-2\" />\n              Reflow Content\n            </Button>\n            <Button onClick={runCommandDemo} variant=\"outline\" className=\"flex items-center\">\n              <Zap className=\"w-4 h-4 mr-2\" />\n              Command Demo\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Metrics Display */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Type className=\"w-5 h-5 mr-2\" />\n              Page Metrics\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {metrics ? (\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Characters/Line:</span>\n                    <Badge variant=\"secondary\">{metrics.charactersPerLine}</Badge>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Lines/Page:</span>\n                    <Badge variant=\"secondary\">{metrics.linesPerPage}</Badge>\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Words/Line:</span>\n                    <Badge variant=\"secondary\">{metrics.wordsPerLine}</Badge>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Total Capacity:</span>\n                    <Badge variant=\"secondary\">{metrics.totalCapacity}</Badge>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <p className=\"text-gray-500 dark:text-gray-400 text-center py-4\">\n                Run layout to see metrics\n              </p>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Preview Results */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Eye className=\"w-5 h-5 mr-2\" />\n              Preview Results\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {previewResult ? (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Estimated Pages:</span>\n                  <Badge className=\"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\">\n                    {previewResult.estimatedPages}\n                  </Badge>\n                </div>\n                <Separator />\n                <div className=\"text-xs text-gray-500 dark:text-gray-400 space-y-1\">\n                  <div>Characters per line: {previewResult.metrics.charactersPerLine}</div>\n                  <div>Lines per page: {previewResult.metrics.linesPerPage}</div>\n                  <div>Total capacity: {previewResult.metrics.totalCapacity}</div>\n                </div>\n              </div>\n            ) : (\n              <p className=\"text-gray-500 dark:text-gray-400 text-center py-4\">\n                Click \"Preview Only\" to see estimation\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Layout Results */}\n      {layoutResult && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center justify-between\">\n              <div className=\"flex items-center\">\n                <Layers className=\"w-5 h-5 mr-2\" />\n                Layout Results\n              </div>\n              <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\n                {layoutResult.totalPages} Pages\n              </Badge>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {layoutResult.pages.map((page, index) => (\n                <Card key={index} className=\"bg-gray-50 dark:bg-gray-800\">\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-sm\">\n                        Page {page.pageNumber}\n                      </CardTitle>\n                      <div className=\"flex space-x-2\">\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {page.wordCount} words\n                        </Badge>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {page.characterCount} chars\n                        </Badge>\n                        {page.isFull && (\n                          <Badge className=\"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200 text-xs\">\n                            Full\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"pt-0\">\n                    <div className=\"text-sm text-gray-700 dark:text-gray-300 font-mono bg-white dark:bg-gray-900 p-3 rounded border max-h-32 overflow-y-auto\">\n                      {page.content.substring(0, 200)}\n                      {page.content.length > 200 && '...'}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Feature Summary */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Clock className=\"w-5 h-5 mr-2\" />\n            Layout Engine Features\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <h4 className=\"font-semibold text-gray-900 dark:text-white\">Automatic Pagination</h4>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Splits content into pages based on font size, page dimensions, and available space.\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <h4 className=\"font-semibold text-gray-900 dark:text-white\">Smart Font Scaling</h4>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Automatically adjusts font size when page size changes to maintain readability.\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <h4 className=\"font-semibold text-gray-900 dark:text-white\">Content Reflow</h4>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Dynamically reflows content when layout parameters change.\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <h4 className=\"font-semibold text-gray-900 dark:text-white\">Preview Mode</h4>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Estimates page count without actually creating pages for performance.\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <h4 className=\"font-semibold text-gray-900 dark:text-white\">Command Interface</h4>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                High-level commands for document manipulation and layout management.\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <h4 className=\"font-semibold text-gray-900 dark:text-white\">Multiple Page Sizes</h4>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Supports 7 different page sizes with accurate inch-based measurements.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":16042},"client/src/lib/document-commands.ts":{"content":"/**\n * Document Command Interface\n * \n * Provides a high-level command interface that integrates with the layout engine\n * for automatic pagination and content management.\n */\n\nimport { LayoutEngine, LayoutResult, ContentPage } from './layout-engine';\n\nexport interface DocumentState {\n  content: string;\n  pages: ContentPage[];\n  currentPage: number;\n  layoutEngine: LayoutEngine;\n  metrics: any;\n}\n\nexport interface CommandResult {\n  success: boolean;\n  message: string;\n  newState?: Partial<DocumentState>;\n  previewMode?: boolean;\n}\n\nexport class DocumentCommandInterface {\n  private state: DocumentState;\n\n  constructor(\n    initialContent: string = '',\n    pageSize: string = 'letter',\n    fontSize: number = 12\n  ) {\n    const layoutEngine = new LayoutEngine(pageSize, fontSize);\n    const layout = layoutEngine.LAYOUT_TEXT(initialContent);\n    \n    this.state = {\n      content: initialContent,\n      pages: layout.pages,\n      currentPage: 1,\n      layoutEngine,\n      metrics: layout.metrics\n    };\n  }\n\n  /**\n   * Get current document state\n   */\n  getState(): DocumentState {\n    return { ...this.state };\n  }\n\n  /**\n   * Execute a command with automatic layout management\n   */\n  executeCommand(command: string, args: any[] = []): CommandResult {\n    const cmd = command.toUpperCase();\n    \n    try {\n      switch (cmd) {\n        case 'ADD_TEXT':\n          return this.addText(args[0], args[1]);\n        \n        case 'INSERT_PAGE':\n          return this.insertPage(args[0]);\n        \n        case 'DELETE_PAGE':\n          return this.deletePage(args[0]);\n        \n        case 'SET_FONT_SIZE':\n          return this.setFontSize(args[0]);\n        \n        case 'SET_PAGE_SIZE':\n          return this.setPageSize(args[0]);\n        \n        case 'LAYOUT_TEXT':\n          return this.layoutText(args[0]);\n        \n        case 'PREVIEW_LAYOUT':\n          return this.previewLayout(args[0]);\n        \n        case 'REFLOW_CONTENT':\n          return this.reflowContent(args[0], args[1]);\n        \n        case 'GO_TO_PAGE':\n          return this.goToPage(args[0]);\n        \n        case 'GET_PAGE_COUNT':\n          return this.getPageCount();\n        \n        case 'GET_METRICS':\n          return this.getMetrics();\n        \n        case 'CLEAR_CONTENT':\n          return this.clearContent();\n        \n        case 'REPLACE_TEXT':\n          return this.replaceText(args[0], args[1]);\n        \n        case 'FIND_TEXT':\n          return this.findText(args[0]);\n        \n        default:\n          return {\n            success: false,\n            message: `Unknown command: ${command}`\n          };\n      }\n    } catch (error) {\n      return {\n        success: false,\n        message: `Error executing command ${command}: ${error.message}`\n      };\n    }\n  }\n\n  /**\n   * Add text with automatic pagination\n   */\n  private addText(text: string, pageNumber?: number): CommandResult {\n    if (!text) {\n      return { success: false, message: 'No text provided' };\n    }\n\n    let newContent: string;\n    \n    if (pageNumber && pageNumber <= this.state.pages.length) {\n      // Insert text at specific page\n      const targetPage = this.state.pages[pageNumber - 1];\n      const beforeContent = this.state.pages.slice(0, pageNumber - 1).map(p => p.content).join('\\n\\n');\n      const afterContent = this.state.pages.slice(pageNumber).map(p => p.content).join('\\n\\n');\n      \n      newContent = [beforeContent, targetPage.content + text, afterContent]\n        .filter(part => part.trim())\n        .join('\\n\\n');\n    } else {\n      // Append to end\n      newContent = this.state.content + (this.state.content ? '\\n\\n' : '') + text;\n    }\n\n    const layout = this.state.layoutEngine.LAYOUT_TEXT(newContent);\n    \n    this.state = {\n      ...this.state,\n      content: newContent,\n      pages: layout.pages,\n      metrics: layout.metrics\n    };\n\n    return {\n      success: true,\n      message: `Text added. Document now has ${layout.pages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Insert a new page at specified position\n   */\n  private insertPage(afterPageNumber: number = this.state.pages.length): CommandResult {\n    if (afterPageNumber < 0 || afterPageNumber > this.state.pages.length) {\n      return {\n        success: false,\n        message: `Invalid page number. Document has ${this.state.pages.length} pages.`\n      };\n    }\n\n    const updatedPages = this.state.layoutEngine.INSERT_PAGE_BREAK(this.state.pages, afterPageNumber);\n    \n    this.state = {\n      ...this.state,\n      pages: updatedPages\n    };\n\n    return {\n      success: true,\n      message: `Page inserted after page ${afterPageNumber}. Document now has ${updatedPages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Delete a specific page and reflow content\n   */\n  private deletePage(pageNumber: number): CommandResult {\n    if (pageNumber < 1 || pageNumber > this.state.pages.length) {\n      return {\n        success: false,\n        message: `Invalid page number. Document has ${this.state.pages.length} pages.`\n      };\n    }\n\n    if (this.state.pages.length === 1) {\n      return {\n        success: false,\n        message: 'Cannot delete the only page in the document.'\n      };\n    }\n\n    // Remove the page and rebuild content\n    const remainingPages = this.state.pages.filter(page => page.pageNumber !== pageNumber);\n    const newContent = remainingPages.map(page => page.content).join('\\n\\n');\n    \n    const layout = this.state.layoutEngine.LAYOUT_TEXT(newContent);\n    \n    this.state = {\n      ...this.state,\n      content: newContent,\n      pages: layout.pages,\n      metrics: layout.metrics,\n      currentPage: Math.min(this.state.currentPage, layout.pages.length)\n    };\n\n    return {\n      success: true,\n      message: `Page ${pageNumber} deleted. Document now has ${layout.pages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Change font size and reflow content\n   */\n  private setFontSize(fontSize: number): CommandResult {\n    if (fontSize < 6 || fontSize > 72) {\n      return {\n        success: false,\n        message: 'Font size must be between 6 and 72 points.'\n      };\n    }\n\n    const layout = this.state.layoutEngine.REFLOW_CONTENT(this.state.content, undefined, fontSize);\n    \n    this.state = {\n      ...this.state,\n      pages: layout.pages,\n      metrics: layout.metrics\n    };\n\n    return {\n      success: true,\n      message: `Font size changed to ${fontSize}pt. Document reflowed to ${layout.pages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Change page size and reflow content\n   */\n  private setPageSize(pageSize: string): CommandResult {\n    const layout = this.state.layoutEngine.REFLOW_CONTENT(this.state.content, pageSize);\n    \n    if (layout.pages.length === 0) {\n      return {\n        success: false,\n        message: `Invalid page size: ${pageSize}`\n      };\n    }\n\n    this.state = {\n      ...this.state,\n      pages: layout.pages,\n      metrics: layout.metrics\n    };\n\n    return {\n      success: true,\n      message: `Page size changed to ${pageSize}. Document reflowed to ${layout.pages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Layout text with automatic pagination\n   */\n  private layoutText(content: string): CommandResult {\n    const layout = this.state.layoutEngine.LAYOUT_TEXT(content);\n    \n    this.state = {\n      ...this.state,\n      content,\n      pages: layout.pages,\n      metrics: layout.metrics\n    };\n\n    return {\n      success: true,\n      message: `Content laid out across ${layout.pages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Preview layout without applying changes\n   */\n  private previewLayout(content: string): CommandResult {\n    const preview = this.state.layoutEngine.PREVIEW_LAYOUT(content);\n    \n    return {\n      success: true,\n      message: `Preview: Content would span approximately ${preview.estimatedPages} pages.`,\n      previewMode: true,\n      newState: {\n        metrics: preview.metrics\n      }\n    };\n  }\n\n  /**\n   * Reflow content with new settings\n   */\n  private reflowContent(pageSize?: string, fontSize?: number): CommandResult {\n    const layout = this.state.layoutEngine.REFLOW_CONTENT(this.state.content, pageSize, fontSize);\n    \n    this.state = {\n      ...this.state,\n      pages: layout.pages,\n      metrics: layout.metrics\n    };\n\n    const changes = [];\n    if (pageSize) changes.push(`page size: ${pageSize}`);\n    if (fontSize) changes.push(`font size: ${fontSize}pt`);\n    \n    return {\n      success: true,\n      message: `Content reflowed with ${changes.join(', ')}. Document now has ${layout.pages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Navigate to specific page\n   */\n  private goToPage(pageNumber: number): CommandResult {\n    if (pageNumber < 1 || pageNumber > this.state.pages.length) {\n      return {\n        success: false,\n        message: `Invalid page number. Document has ${this.state.pages.length} pages.`\n      };\n    }\n\n    this.state = {\n      ...this.state,\n      currentPage: pageNumber\n    };\n\n    return {\n      success: true,\n      message: `Navigated to page ${pageNumber}.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Get total page count\n   */\n  private getPageCount(): CommandResult {\n    return {\n      success: true,\n      message: `Document has ${this.state.pages.length} pages.`\n    };\n  }\n\n  /**\n   * Get current metrics\n   */\n  private getMetrics(): CommandResult {\n    const metrics = this.state.layoutEngine.getCurrentMetrics();\n    \n    return {\n      success: true,\n      message: `Metrics: ${metrics.charactersPerLine} chars/line, ${metrics.linesPerPage} lines/page, ${metrics.wordsPerLine} words/line, ${metrics.totalCapacity} total capacity.`\n    };\n  }\n\n  /**\n   * Clear all content\n   */\n  private clearContent(): CommandResult {\n    const layout = this.state.layoutEngine.LAYOUT_TEXT('');\n    \n    this.state = {\n      ...this.state,\n      content: '',\n      pages: layout.pages.length > 0 ? layout.pages : [{\n        pageNumber: 1,\n        content: '',\n        wordCount: 0,\n        characterCount: 0,\n        isFull: false\n      }],\n      currentPage: 1,\n      metrics: layout.metrics\n    };\n\n    return {\n      success: true,\n      message: 'Document content cleared.',\n      newState: this.state\n    };\n  }\n\n  /**\n   * Replace text throughout document\n   */\n  private replaceText(searchText: string, replaceText: string): CommandResult {\n    if (!searchText) {\n      return { success: false, message: 'No search text provided.' };\n    }\n\n    const newContent = this.state.content.replace(new RegExp(searchText, 'g'), replaceText);\n    const layout = this.state.layoutEngine.LAYOUT_TEXT(newContent);\n    \n    this.state = {\n      ...this.state,\n      content: newContent,\n      pages: layout.pages,\n      metrics: layout.metrics\n    };\n\n    return {\n      success: true,\n      message: `Text replaced. Document now has ${layout.pages.length} pages.`,\n      newState: this.state\n    };\n  }\n\n  /**\n   * Find text and return page locations\n   */\n  private findText(searchText: string): CommandResult {\n    if (!searchText) {\n      return { success: false, message: 'No search text provided.' };\n    }\n\n    const results: { page: number; position: number }[] = [];\n    \n    this.state.pages.forEach((page, index) => {\n      let position = page.content.indexOf(searchText);\n      while (position !== -1) {\n        results.push({ page: index + 1, position });\n        position = page.content.indexOf(searchText, position + 1);\n      }\n    });\n\n    if (results.length === 0) {\n      return {\n        success: true,\n        message: `Text \"${searchText}\" not found in document.`\n      };\n    }\n\n    return {\n      success: true,\n      message: `Found \"${searchText}\" in ${results.length} locations: ${results.map(r => `Page ${r.page}`).join(', ')}.`\n    };\n  }\n}\n\n// Export utility functions\nexport const createDocumentInterface = (content?: string, pageSize?: string, fontSize?: number) => {\n  return new DocumentCommandInterface(content, pageSize, fontSize);\n};\n\nexport const executeDocumentCommand = (\n  docInterface: DocumentCommandInterface,\n  command: string,\n  ...args: any[]\n): CommandResult => {\n  return docInterface.executeCommand(command, args);\n};","size_bytes":12251},"client/src/lib/layout-engine.ts":{"content":"/**\n * Advanced Layout Engine for Document Pagination\n * \n * This engine sits between the command interface and visual rendering system,\n * providing automatic pagination, content flow, and dynamic scaling capabilities.\n */\n\n// Page configuration types\nexport interface PageConfig {\n  width: number;\n  height: number;\n  padding: {\n    top: number;\n    right: number;\n    bottom: number;\n    left: number;\n  };\n  name: string;\n}\n\n// Content measurement types\nexport interface ContentMetrics {\n  charactersPerLine: number;\n  linesPerPage: number;\n  wordsPerLine: number;\n  totalCapacity: number;\n}\n\n// Layout result types\nexport interface LayoutResult {\n  pages: ContentPage[];\n  totalPages: number;\n  overflow: boolean;\n  metrics: ContentMetrics;\n}\n\nexport interface ContentPage {\n  pageNumber: number;\n  content: string;\n  wordCount: number;\n  characterCount: number;\n  isFull: boolean;\n}\n\n// Font scaling configuration\nexport interface FontScaling {\n  baseFontSize: number;\n  basePageSize: { width: number; height: number };\n  currentFontSize: number;\n  scalingRatio: number;\n}\n\n// Page size configurations (in pixels at 96 DPI)\nexport const PAGE_CONFIGS: Record<string, PageConfig> = {\n  'letter': {\n    width: 816,\n    height: 1056,\n    padding: { top: 72, right: 72, bottom: 72, left: 72 },\n    name: 'Letter (8.5\" × 11\")'\n  },\n  'legal': {\n    width: 816,\n    height: 1344,\n    padding: { top: 72, right: 72, bottom: 72, left: 72 },\n    name: 'Legal (8.5\" × 14\")'\n  },\n  'a4': {\n    width: 794,\n    height: 1123,\n    padding: { top: 72, right: 72, bottom: 72, left: 72 },\n    name: 'A4 (8.27\" × 11.69\")'\n  },\n  'a3': {\n    width: 1123,\n    height: 1587,\n    padding: { top: 72, right: 72, bottom: 72, left: 72 },\n    name: 'A3 (11.69\" × 16.54\")'\n  },\n  'tabloid': {\n    width: 1056,\n    height: 1632,\n    padding: { top: 72, right: 72, bottom: 72, left: 72 },\n    name: 'Tabloid (11\" × 17\")'\n  },\n  'executive': {\n    width: 696,\n    height: 1008,\n    padding: { top: 72, right: 72, bottom: 72, left: 72 },\n    name: 'Executive (7.25\" × 10.5\")'\n  },\n  'ledger': {\n    width: 1632,\n    height: 1056,\n    padding: { top: 72, right: 72, bottom: 72, left: 72 },\n    name: 'Ledger (17\" × 11\")'\n  }\n};\n\nexport class LayoutEngine {\n  private pageConfig: PageConfig;\n  private fontScaling: FontScaling;\n  private lineHeight: number = 1.6;\n\n  constructor(\n    pageSize: string = 'letter',\n    baseFontSize: number = 12,\n    currentFontSize?: number\n  ) {\n    this.pageConfig = PAGE_CONFIGS[pageSize] || PAGE_CONFIGS.letter;\n    this.fontScaling = {\n      baseFontSize,\n      basePageSize: { width: 816, height: 1056 }, // Letter size as default\n      currentFontSize: currentFontSize || baseFontSize,\n      scalingRatio: 1\n    };\n    this.calculateScalingRatio();\n  }\n\n  /**\n   * Calculate font scaling ratio based on page size changes\n   */\n  private calculateScalingRatio(): void {\n    const widthRatio = this.pageConfig.width / this.fontScaling.basePageSize.width;\n    const heightRatio = this.pageConfig.height / this.fontScaling.basePageSize.height;\n    \n    // Use the smaller ratio to ensure content fits\n    this.fontScaling.scalingRatio = Math.min(widthRatio, heightRatio);\n    \n    // Auto-scale font size if not explicitly set\n    if (this.fontScaling.currentFontSize === this.fontScaling.baseFontSize) {\n      this.fontScaling.currentFontSize = this.fontScaling.baseFontSize * this.fontScaling.scalingRatio;\n    }\n  }\n\n  /**\n   * Measure content capacity for current page configuration\n   */\n  measurePageCapacity(): ContentMetrics {\n    const contentWidth = this.pageConfig.width - this.pageConfig.padding.left - this.pageConfig.padding.right;\n    const contentHeight = this.pageConfig.height - this.pageConfig.padding.top - this.pageConfig.padding.bottom;\n    \n    // Calculate approximate character width (varies by font, using average)\n    const avgCharWidth = this.fontScaling.currentFontSize * 0.6; // Approximation for most fonts\n    const lineHeight = this.fontScaling.currentFontSize * this.lineHeight;\n    \n    const charactersPerLine = Math.floor(contentWidth / avgCharWidth);\n    const linesPerPage = Math.floor(contentHeight / lineHeight);\n    \n    // Average words per line (assuming 5 characters per word + space)\n    const wordsPerLine = Math.floor(charactersPerLine / 6);\n    \n    return {\n      charactersPerLine,\n      linesPerPage,\n      wordsPerLine,\n      totalCapacity: charactersPerLine * linesPerPage\n    };\n  }\n\n  /**\n   * Split text into words while preserving formatting\n   */\n  private splitIntoWords(text: string): string[] {\n    // Handle HTML tags and preserve them\n    const htmlTagRegex = /<[^>]*>/g;\n    const tags: string[] = [];\n    let tagIndex = 0;\n    \n    // Replace HTML tags with placeholders\n    const textWithPlaceholders = text.replace(htmlTagRegex, (match) => {\n      tags.push(match);\n      return `__HTML_TAG_${tagIndex++}__`;\n    });\n    \n    // Split into words\n    const words = textWithPlaceholders.split(/(\\s+)/);\n    \n    // Restore HTML tags\n    return words.map(word => {\n      return word.replace(/__HTML_TAG_(\\d+)__/g, (match, index) => {\n        return tags[parseInt(index)] || match;\n      });\n    });\n  }\n\n  /**\n   * Main layout function that splits content into pages\n   */\n  LAYOUT_TEXT(content: string): LayoutResult {\n    const metrics = this.measurePageCapacity();\n    const words = this.splitIntoWords(content);\n    const pages: ContentPage[] = [];\n    \n    let currentPage: ContentPage = {\n      pageNumber: 1,\n      content: '',\n      wordCount: 0,\n      characterCount: 0,\n      isFull: false\n    };\n    \n    let currentLineLength = 0;\n    let currentPageLines = 0;\n    \n    for (const word of words) {\n      // Skip empty words (but preserve single spaces)\n      if (word === '') continue;\n      \n      const wordLength = word.replace(/<[^>]*>/g, '').length; // Count without HTML tags\n      const isWhitespace = /^\\s+$/.test(word);\n      \n      // Check if adding this word would exceed line length\n      if (!isWhitespace && currentLineLength + wordLength > metrics.charactersPerLine) {\n        // Start new line\n        currentLineLength = 0;\n        currentPageLines++;\n        \n        // Check if we need a new page\n        if (currentPageLines >= metrics.linesPerPage) {\n          currentPage.isFull = true;\n          pages.push(currentPage);\n          \n          // Create new page\n          currentPage = {\n            pageNumber: pages.length + 1,\n            content: '',\n            wordCount: 0,\n            characterCount: 0,\n            isFull: false\n          };\n          currentPageLines = 0;\n        } else {\n          // Add line break to current page\n          currentPage.content += '\\n';\n          currentPage.characterCount += 1;\n        }\n      }\n      \n      // Add word to current page\n      currentPage.content += word;\n      currentPage.characterCount += word.length;\n      \n      if (!isWhitespace) {\n        currentPage.wordCount++;\n        currentLineLength += wordLength;\n      }\n    }\n    \n    // Add the last page if it has content\n    if (currentPage.content.trim()) {\n      pages.push(currentPage);\n    }\n    \n    return {\n      pages,\n      totalPages: pages.length,\n      overflow: false, // Could be enhanced to detect overflow\n      metrics\n    };\n  }\n\n  /**\n   * Preview layout without actually creating pages\n   */\n  PREVIEW_LAYOUT(content: string): { estimatedPages: number; metrics: ContentMetrics } {\n    const metrics = this.measurePageCapacity();\n    const wordCount = content.split(/\\s+/).filter(word => word.length > 0).length;\n    const estimatedPages = Math.ceil(wordCount / (metrics.wordsPerLine * metrics.linesPerPage));\n    \n    return {\n      estimatedPages: Math.max(1, estimatedPages),\n      metrics\n    };\n  }\n\n  /**\n   * Reflow content when page or font settings change\n   */\n  REFLOW_CONTENT(content: string, newPageSize?: string, newFontSize?: number): LayoutResult {\n    if (newPageSize && PAGE_CONFIGS[newPageSize]) {\n      this.pageConfig = PAGE_CONFIGS[newPageSize];\n      this.calculateScalingRatio();\n    }\n    \n    if (newFontSize) {\n      this.fontScaling.currentFontSize = newFontSize;\n    }\n    \n    return this.LAYOUT_TEXT(content);\n  }\n\n  /**\n   * Get automatic font size based on page size\n   */\n  getScaledFontSize(): number {\n    return Math.round(this.fontScaling.currentFontSize);\n  }\n\n  /**\n   * Get current page configuration\n   */\n  getPageConfig(): PageConfig {\n    return { ...this.pageConfig };\n  }\n\n  /**\n   * Get current metrics\n   */\n  getCurrentMetrics(): ContentMetrics {\n    return this.measurePageCapacity();\n  }\n\n  /**\n   * Add content block-by-block to specific pages\n   */\n  ADD_TEXT_TO_PAGE(pageNumber: number, text: string, pages: ContentPage[]): ContentPage[] {\n    if (pageNumber <= 0 || pageNumber > pages.length) {\n      return pages;\n    }\n    \n    const targetPage = pages[pageNumber - 1];\n    const metrics = this.measurePageCapacity();\n    \n    // Check if page can accommodate more text\n    if (targetPage.characterCount + text.length <= metrics.totalCapacity) {\n      targetPage.content += text;\n      targetPage.characterCount += text.length;\n      targetPage.wordCount += text.split(/\\s+/).filter(word => word.length > 0).length;\n    }\n    \n    return pages;\n  }\n\n  /**\n   * Insert page break at specific position\n   */\n  INSERT_PAGE_BREAK(pages: ContentPage[], afterPageNumber: number): ContentPage[] {\n    if (afterPageNumber <= 0 || afterPageNumber >= pages.length) {\n      return pages;\n    }\n    \n    // Create new empty page\n    const newPage: ContentPage = {\n      pageNumber: afterPageNumber + 1,\n      content: '',\n      wordCount: 0,\n      characterCount: 0,\n      isFull: false\n    };\n    \n    // Insert the new page and renumber subsequent pages\n    const updatedPages = [...pages];\n    updatedPages.splice(afterPageNumber, 0, newPage);\n    \n    // Renumber pages\n    updatedPages.forEach((page, index) => {\n      page.pageNumber = index + 1;\n    });\n    \n    return updatedPages;\n  }\n\n  /**\n   * Set page style configurations\n   */\n  SET_PAGE_STYLE(\n    pageSize?: string,\n    fontSize?: number,\n    lineHeight?: number,\n    padding?: Partial<PageConfig['padding']>\n  ): void {\n    if (pageSize && PAGE_CONFIGS[pageSize]) {\n      this.pageConfig = PAGE_CONFIGS[pageSize];\n    }\n    \n    if (fontSize) {\n      this.fontScaling.currentFontSize = fontSize;\n    }\n    \n    if (lineHeight) {\n      this.lineHeight = lineHeight;\n    }\n    \n    if (padding) {\n      this.pageConfig.padding = { ...this.pageConfig.padding, ...padding };\n    }\n    \n    this.calculateScalingRatio();\n  }\n}\n\n// Export utility functions\nexport const createLayoutEngine = (pageSize?: string, fontSize?: number) => {\n  return new LayoutEngine(pageSize, fontSize);\n};\n\nexport const calculateOptimalFontSize = (\n  targetPageSize: string,\n  basePageSize: string = 'letter',\n  baseFontSize: number = 12\n): number => {\n  const targetConfig = PAGE_CONFIGS[targetPageSize];\n  const baseConfig = PAGE_CONFIGS[basePageSize];\n  \n  if (!targetConfig || !baseConfig) return baseFontSize;\n  \n  const widthRatio = targetConfig.width / baseConfig.width;\n  const heightRatio = targetConfig.height / baseConfig.height;\n  const scalingRatio = Math.min(widthRatio, heightRatio);\n  \n  return Math.round(baseFontSize * scalingRatio);\n};","size_bytes":11294},"client/src/pages/cheatsheet-workspace-new.tsx":{"content":"import { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams, Link, useLocation } from 'wouter';\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\nimport TextAlign from '@tiptap/extension-text-align';\nimport Underline from '@tiptap/extension-underline';\nimport { Color } from '@tiptap/extension-color';\nimport { TextStyle } from '@tiptap/extension-text-style';\nimport { FontFamily } from '@tiptap/extension-font-family';\nimport Highlight from '@tiptap/extension-highlight';\nimport AutoResizeMathBox from '@/components/auto-resize-math-box';\nimport { Button } from '@/components/ui/button';\nimport { Separator } from '@/components/ui/separator';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Save, FileText, Bold, Italic, Underline as UnderlineIcon, \n  AlignLeft, AlignCenter, AlignRight, AlignJustify,\n  List, ListOrdered, ZoomIn, ZoomOut, Printer, Type, Palette, \n  Undo2, Redo2, History, MessageSquare, Plus, Clock, Send,\n  Edit3, Share, Trash2, Copy, Download, Eye, MoreVertical,\n  Brain, Sparkles, Command, ChevronDown, ChevronRight,\n  Strikethrough, Scissors, ClipboardPaste, Minus,\n  Indent, Outdent, Layout, Image, Table, Link as LinkIcon, Settings, X,\n  Grid3X3, ArrowLeft\n} from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { CheatSheet, ChatSession, ChatMessage } from '@shared/schema';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\n\n// FIXED: Box interface matching AutoResizeMathBox expectations\ninterface Box {\n  id: string;\n  title: string;\n  content: string;\n  color: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n// FIXED: Position and Size interfaces for AutoResizeMathBox\ninterface Position {\n  x: number;\n  y: number;\n}\n\ninterface Size {\n  width: number;\n  height: number;\n}\n\n// Custom FontSize extension\nconst FontSize = TextStyle.extend({\n  addAttributes() {\n    return {\n      fontSize: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.style.fontSize?.replace('pt', ''),\n        renderHTML: (attributes: any) => {\n          if (!attributes.fontSize) return {}\n          return { style: `font-size: ${attributes.fontSize}pt` }\n        },\n      }\n    }\n  }\n});\n\nexport default function CheatSheetWorkspace() {\n  const { id } = useParams<{ id: string }>();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Box state\n  const [boxes, setBoxes] = useState<Box[]>([]);\n  const [selectedBox, setSelectedBox] = useState<string | null>(null);\n  \n  // Document state\n  const [fontSize, setFontSize] = useState(12);\n  const [fontFamily, setFontFamily] = useState('Times New Roman');\n  const [textColor, setTextColor] = useState('#000000');\n  \n  // Chat state\n  const [chatInput, setChatInput] = useState('');\n  const [defaultSessionId, setDefaultSessionId] = useState<string | null>(null);\n  const [expandedSessions, setExpandedSessions] = useState<Set<string>>(new Set());\n\n  // Editor setup\n  const editor = useEditor({\n    extensions: [\n      StarterKit.configure({\n        heading: {\n          levels: [1, 2, 3],\n        },\n      }),\n      TextAlign.configure({\n        types: ['heading', 'paragraph'],\n      }),\n      Underline,\n      Color,\n      FontFamily,\n      FontSize,\n      Highlight\n    ],\n    content: '<p>Start editing your cheat sheet content...</p>',\n    editorProps: {\n      attributes: {\n        class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none',\n      },\n    },\n  });\n\n  // Fetch cheat sheet data\n  const { data: cheatSheet, isLoading: cheatSheetLoading, refetch: refetchCheatSheet } = useQuery({\n    queryKey: ['cheatsheet', id],\n    queryFn: async () => {\n      const response = await fetch(`/api/cheatsheets/${id}`);\n      if (!response.ok) throw new Error('Failed to fetch cheat sheet');\n      return response.json();\n    },\n    enabled: !!id && id !== 'new',\n  });\n\n  // Fetch all cheat sheets for left panel\n  const { data: cheatSheets, refetch: refetchCheatSheets } = useQuery({\n    queryKey: ['cheatsheets'],\n    queryFn: async () => {\n      const response = await fetch('/api/cheatsheets');\n      if (!response.ok) throw new Error('Failed to fetch cheat sheets');\n      return response.json();\n    },\n  });\n\n  // Fetch chat sessions\n  const { data: chatSessions = [], refetch: refetchSessions } = useQuery({\n    queryKey: ['cheatsheet-chat-sessions', id],\n    queryFn: async () => {\n      const response = await fetch(`/api/cheatsheets/${id}/chat-sessions`);\n      if (!response.ok) throw new Error('Failed to fetch chat sessions');\n      return response.json();\n    },\n    enabled: !!id && id !== 'new',\n  });\n\n  // Fetch chat messages\n  const { data: chatMessages = [], refetch: refetchMessages } = useQuery({\n    queryKey: ['chat-messages', defaultSessionId],\n    queryFn: async () => {\n      const response = await fetch(`/api/chat-sessions/${defaultSessionId}/messages`);\n      if (!response.ok) throw new Error('Failed to fetch chat messages');\n      return response.json();\n    },\n    enabled: !!defaultSessionId,\n  });\n\n  // Update cheat sheet mutation\n  const updateCheatSheetMutation = useMutation({\n    mutationFn: async (updates: Partial<CheatSheet>) => {\n      const response = await fetch(`/api/cheatsheets/${id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updates),\n      });\n      if (!response.ok) throw new Error('Failed to update cheat sheet');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['cheatsheet', id] });\n    },\n  });\n\n  // Create new chat session\n  const createNewChatSession = async () => {\n    if (!id || id === 'new') return;\n    \n    try {\n      const response = await fetch(`/api/cheatsheets/${id}/chat-sessions`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: `Chat Session ${new Date().toLocaleDateString()}`,\n          cheatSheetSnapshot: editor?.getHTML() || '<p></p>',\n        }),\n      });\n      if (response.ok) {\n        const session = await response.json();\n        setDefaultSessionId(session.id);\n        refetchSessions();\n      }\n    } catch (error) {\n      console.error('Failed to create chat session:', error);\n    }\n  };\n\n  // Calculate number of pages needed based on box positions\n  const calculateRequiredPages = () => {\n    if (boxes.length === 0) return 1;\n    \n    const PAGE_HEIGHT = 1056;\n    const MARGIN = 40;\n    const maxY = Math.max(...boxes.map(box => box.y + box.height));\n    const pagesNeeded = Math.ceil((maxY + MARGIN) / PAGE_HEIGHT);\n    \n    console.log('📊 Page calculation:', {\n      totalBoxes: boxes.length,\n      maxY: maxY,\n      pagesNeeded: pagesNeeded,\n      pageHeight: PAGE_HEIGHT\n    });\n    \n    return Math.max(1, pagesNeeded);\n  };\n\n  // FIXED: Corrected positioning algorithm with proper page width constraints\n  const findOptimalPosition = (newBoxWidth: number, newBoxHeight: number, existingBoxes: Box[]) => {\n    console.log('🔍 findOptimalPosition called for new box:');\n    console.log('   - New box size:', `${newBoxWidth}x${newBoxHeight}`);\n    console.log('   - Existing boxes count:', existingBoxes.length);\n    \n    const PAGE_WIDTH = 816;\n    const MARGIN = 40;\n    const SPACING = 8;\n    const usableWidth = PAGE_WIDTH - (2 * MARGIN); // 736px usable width\n    \n    if (existingBoxes.length === 0) {\n      console.log('   ✅ First box placed at: (40, 40)');\n      return { x: MARGIN, y: MARGIN };\n    }\n    \n    // Sort existing boxes by Y position first, then X position for row detection\n    const sortedBoxes = [...existingBoxes].sort((a, b) => {\n      if (Math.abs(a.y - b.y) < SPACING) return a.x - b.x;\n      return a.y - b.y;\n    });\n    \n    console.log('   📋 Analyzing existing boxes for placement...');\n    \n    // Try to fit in existing rows first (fill horizontal space)\n    const usedYPositions = [...new Set(existingBoxes.map(box => box.y))].sort((a, b) => a - b);\n    \n    for (const rowY of usedYPositions) {\n      const rowBoxes = existingBoxes.filter(box => Math.abs(box.y - rowY) < SPACING);\n      const rowHeight = Math.max(...rowBoxes.map(box => box.height));\n      \n      console.log(`   🔍 Checking row at Y=${rowY}, height=${rowHeight}, boxes=${rowBoxes.length}`);\n      \n      // Check if new box can fit in height of this row\n      if (newBoxHeight <= rowHeight + SPACING) {\n        // Find rightmost box in this row\n        const rightmostBox = rowBoxes.reduce((max, box) => \n          (box.x + box.width > max.x + max.width) ? box : max\n        );\n        const testX = rightmostBox.x + rightmostBox.width + SPACING;\n        \n        console.log(`   🧮 Testing position X=${testX} in existing row`);\n        \n        // FIXED: Proper width boundary check\n        if (testX + newBoxWidth <= MARGIN + usableWidth) {\n          // Verify no conflicts with other boxes\n          const hasConflict = existingBoxes.some(box => {\n            const xOverlaps = !(testX + newBoxWidth <= box.x || testX >= box.x + box.width);\n            const yOverlaps = !(rowY + newBoxHeight <= box.y || rowY >= box.y + box.height);\n            return xOverlaps && yOverlaps;\n          });\n          \n          if (!hasConflict) {\n            console.log(`   ✅ Found space in existing row: (${testX}, ${rowY})`);\n            return { x: testX, y: rowY };\n          } else {\n            console.log(`   ❌ Conflict detected in row at X=${testX}`);\n          }\n        } else {\n          console.log(`   ❌ Box would exceed page width: ${testX + newBoxWidth} > ${MARGIN + usableWidth}`);\n        }\n      } else {\n        console.log(`   ❌ Box too tall for row: ${newBoxHeight} > ${rowHeight + SPACING}`);\n      }\n    }\n    \n    // No space in existing rows, create new row\n    const maxY = existingBoxes.length > 0 \n      ? Math.max(...existingBoxes.map(box => box.y + box.height))\n      : MARGIN;\n    \n    const newRowY = maxY + SPACING;\n    console.log(`   ✅ Creating new row at Y=${newRowY}: (${MARGIN}, ${newRowY})`);\n    \n    return { x: MARGIN, y: newRowY };\n  };\n\n  // Advanced content-based dynamic sizing system\n  const calculateContentSize = (title: string, content: string) => {\n    console.log('📐 Calculating size for:', title);\n    console.log('   - Content length:', content.length, 'chars');\n    \n    // Analyze content complexity and length\n    const titleLength = title.length;\n    const contentLength = content.length;\n    const newlineCount = (content.match(/\\n/g) || []).length;\n    const hasLaTeX = /\\\\[a-zA-Z]+|\\$.*\\$|\\\\\\(.*\\\\\\)/.test(content);\n    const hasComplexMath = /\\^|\\{|\\}|_|\\\\frac|\\\\sqrt|\\\\sum|\\\\int/.test(content);\n    const wordCount = content.split(/\\s+/).length;\n    \n    // Base dimensions\n    let width = 180;\n    let height = 120;\n    \n    // Title contribution\n    if (titleLength > 20) width += Math.min(100, (titleLength - 20) * 3);\n    if (titleLength > 30) height += 25;\n    \n    // Content length adjustments\n    if (contentLength > 50) {\n      width += Math.min(120, Math.floor((contentLength - 50) / 8));\n    }\n    \n    // Line-based height calculation\n    const estimatedLines = Math.max(1, newlineCount + Math.ceil(contentLength / 40));\n    height += estimatedLines * 22;\n    \n    // LaTeX and math adjustments\n    if (hasLaTeX) {\n      width += 40;\n      height += 30;\n    }\n    if (hasComplexMath) {\n      width += 60;\n      height += 40;\n    }\n    \n    // Word density adjustments\n    if (wordCount > 15) {\n      height += Math.min(80, (wordCount - 15) * 4);\n    }\n    \n    // Ensure reasonable bounds\n    width = Math.max(160, Math.min(450, width));\n    height = Math.max(100, Math.min(500, height));\n    \n    const finalSize = { width: Math.round(width), height: Math.round(height) };\n    console.log('   - Calculated size:', `${finalSize.width}x${finalSize.height}`);\n    \n    return finalSize;\n  };\n\n  // FIXED: Bulk box creation with proper state handling\n  const createMultipleBoxes = (mathFormulas: any[], requestedCount: number) => {\n    console.log('🚀 Creating multiple boxes:', requestedCount);\n    console.log('   - Current boxes count:', boxes.length);\n    \n    const numToCreate = Math.min(requestedCount, mathFormulas.length);\n    const newBoxes: Box[] = [];\n    \n    for (let i = 0; i < numToCreate; i++) {\n      const formula = mathFormulas[i];\n      console.log(`📦 Creating box ${i + 1}:`, formula.title);\n      \n      const { width, height } = calculateContentSize(formula.title, formula.content);\n      console.log('   - Calculated size:', `${width}x${height}`);\n      \n      // CRITICAL FIX: Use accumulated boxes for position calculation\n      const currentBoxes = [...boxes, ...newBoxes];\n      const position = findOptimalPosition(width, height, currentBoxes);\n      console.log('   - Final position:', `(${position.x}, ${position.y})`);\n      \n      const newBox: Box = {\n        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),\n        title: formula.title,\n        content: formula.content,\n        color: formula.color,\n        x: position.x,\n        y: position.y,\n        width,\n        height\n      };\n      \n      newBoxes.push(newBox);\n      console.log('   - Box created with ID:', newBox.id);\n      console.log('   - Previous boxes count:', currentBoxes.length - 1, 'New count:', currentBoxes.length);\n    }\n    \n    // Update state once with all new boxes\n    setBoxes(prev => {\n      const updated = [...prev, ...newBoxes];\n      console.log('🎯 State updated - Total boxes:', updated.length);\n      return updated;\n    });\n    \n    console.log('✅ Bulk creation complete:', newBoxes.length, 'boxes added');\n    return newBoxes.length;\n  };\n\n  // Send chat message mutation with FIXED bulk creation\n  const sendMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      // If no default session, create one first\n      if (!defaultSessionId) {\n        await createNewChatSession();\n      }\n      \n      const cheatSheetContent = JSON.stringify({ boxes }); // Send current boxes state\n      const response = await fetch(`/api/chat-sessions/${defaultSessionId}/messages`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          content: message, \n          cheatSheetContent,\n          cheatSheetId: id,\n          workspaceType: 'cheatsheet' // Specify this is a cheat sheet workspace\n        }),\n      });\n      if (!response.ok) throw new Error('Failed to send message');\n      return response.json();\n    },\n    onSuccess: (response: any) => {\n      refetchMessages();\n      setChatInput('');\n      \n      // Handle box creation from ChatGPT\n      if (response.createBox) {\n        const { title, content, color = '#f0f9ff' } = response.createBox;\n        addBox(title, content, color);\n        toast({ title: `Created box: ${title}` });\n      }\n      \n      // Handle multiple boxes creation\n      if (response.createBoxes && Array.isArray(response.createBoxes)) {\n        const formattedBoxes = response.createBoxes.map((boxData: any) => ({\n          title: boxData.title,\n          content: boxData.content,\n          color: boxData.color || 'from-blue-50 to-blue-100'\n        }));\n        const createdCount = createMultipleBoxes(formattedBoxes, formattedBoxes.length);\n        toast({ title: `Created ${createdCount} boxes with proper layout!` });\n        return;\n      }\n      \n      // Parse response content for box creation patterns and commands if no structured response\n      if (response.content && !response.createBox && !response.createBoxes) {\n        const content = response.content.toLowerCase();\n        const originalMessage = chatInput.toLowerCase();\n        \n        // Enhanced box creation for multiple items with FIXED implementation\n        const numberMatch = originalMessage.match(/(\\d+)/);\n        const requestedCount = numberMatch ? parseInt(numberMatch[1]) : 1;\n        \n        // Check if user wants multiple math equations/formulas\n        if ((originalMessage.includes('math') || originalMessage.includes('formula') || originalMessage.includes('equation') || originalMessage.includes('physics')) && requestedCount > 1) {\n          const mathFormulas = [\n            { title: 'Newton\\'s Second Law', content: 'F = ma', color: 'from-blue-50 to-blue-100' },\n            { title: 'Gravitational Force', content: 'F = G(m₁m₂)/r²', color: 'from-green-50 to-green-100' },\n            { title: 'Kinetic Energy', content: 'KE = ½mv²', color: 'from-red-50 to-red-100' },\n            { title: 'Work Done', content: 'W = Fd cos θ', color: 'from-purple-50 to-purple-100' },\n            { title: 'Ohm\\'s Law', content: 'V = IR', color: 'from-yellow-50 to-yellow-100' },\n            { title: 'Wave Speed', content: 'v = fλ', color: 'from-indigo-50 to-indigo-100' },\n            { title: 'Mass-Energy', content: 'E = mc²', color: 'from-pink-50 to-pink-100' },\n            { title: 'Coulomb\\'s Law', content: 'F = k|q₁q₂|/r²', color: 'from-cyan-50 to-cyan-100' },\n            { title: 'Momentum', content: 'p = mv', color: 'from-orange-50 to-orange-100' },\n            { title: 'Ideal Gas Law', content: 'PV = nRT', color: 'from-teal-50 to-teal-100' },\n            { title: 'Power Rule', content: 'd/dx x^n = nx^(n-1)', color: 'from-blue-50 to-blue-100' },\n            { title: 'Product Rule', content: 'd/dx [u(x)v(x)] = u\\'(x)v(x) + u(x)v\\'(x)', color: 'from-green-50 to-green-100' },\n            { title: 'Quotient Rule', content: 'd/dx [u(x)/v(x)] = [u\\'(x)v(x) - u(x)v\\'(x)] / [v(x)]²', color: 'from-purple-50 to-purple-100' },\n            { title: 'Chain Rule', content: 'd/dx f(g(x)) = f\\'(g(x)) · g\\'(x)', color: 'from-pink-50 to-pink-100' },\n            { title: 'Sum Rule', content: 'd/dx [f(x) + g(x)] = f\\'(x) + g\\'(x)', color: 'from-yellow-50 to-yellow-100' },\n            { title: 'Exponential', content: 'd/dx e^x = e^x', color: 'from-red-50 to-red-100' },\n            { title: 'Logarithm', content: 'd/dx ln x = 1/x', color: 'from-orange-50 to-orange-100' },\n            { title: 'Sine Function', content: 'd/dx sin x = cos x', color: 'from-teal-50 to-teal-100' },\n            { title: 'Cosine Function', content: 'd/dx cos x = -sin x', color: 'from-indigo-50 to-indigo-100' },\n            { title: 'Tangent Function', content: 'd/dx tan x = sec² x', color: 'from-cyan-50 to-cyan-100' },\n            { title: 'Pythagorean Theorem', content: 'a² + b² = c²', color: 'from-blue-50 to-blue-100' },\n            { title: 'Quadratic Formula', content: 'x = (-b ± √(b² - 4ac)) / 2a', color: 'from-green-50 to-green-100' },\n            { title: 'Distance Formula', content: 'd = √[(x₂-x₁)² + (y₂-y₁)²]', color: 'from-purple-50 to-purple-100' },\n            { title: 'Slope Formula', content: 'm = (y₂-y₁)/(x₂-x₁)', color: 'from-pink-50 to-pink-100' },\n            { title: 'Area of Circle', content: 'A = πr²', color: 'from-yellow-50 to-yellow-100' },\n            { title: 'Circumference', content: 'C = 2πr', color: 'from-red-50 to-red-100' },\n            { title: 'Volume of Sphere', content: 'V = (4/3)πr³', color: 'from-orange-50 to-orange-100' },\n            { title: 'Surface Area Sphere', content: 'SA = 4πr²', color: 'from-teal-50 to-teal-100' },\n            { title: 'Law of Cosines', content: 'c² = a² + b² - 2ab cos C', color: 'from-indigo-50 to-indigo-100' },\n            { title: 'Law of Sines', content: 'a/sin A = b/sin B = c/sin C', color: 'from-cyan-50 to-cyan-100' }\n          ];\n          \n          // FIXED: Use the new bulk creation function\n          const createdCount = createMultipleBoxes(mathFormulas, requestedCount);\n          toast({ title: `Created ${createdCount} formula boxes with proper Tetris layout!` });\n          return;\n        }\n        \n        // Single box creation fallback\n        if (originalMessage.includes('create') || originalMessage.includes('add') || originalMessage.includes('make')) {\n          const title = response.content.split('\\n')[0] || 'New Formula';\n          const content = response.content;\n          addBox(title, content);\n          toast({ title: `Created box: ${title}` });\n        }\n      }\n    },\n  });\n\n  // Handle sending chat message\n  const handleSendMessage = () => {\n    if (!chatInput.trim() || sendMessageMutation.isPending) return;\n    sendMessageMutation.mutate(chatInput);\n  };\n\n  // Set default session when sessions are loaded\n  useEffect(() => {\n    if (chatSessions.length > 0 && !defaultSessionId) {\n      setDefaultSessionId(chatSessions[0].id);\n    }\n  }, [cheatSheet, chatSessions, defaultSessionId]);\n\n  // Intelligent horizontal-first layout engine (proper Tetris style)\n  const relayoutAllBoxes = () => {\n    if (boxes.length === 0) return;\n    \n    console.log('🔄 Re-layouting all boxes...');\n    const repositionedBoxes: Box[] = [];\n    \n    // Sort boxes by height first (shorter boxes fill gaps better), then by width\n    const sortedBoxes = [...boxes].sort((a, b) => {\n      if (a.height !== b.height) return a.height - b.height;\n      return a.width - b.width;\n    });\n    \n    sortedBoxes.forEach((box, index) => {\n      const position = findOptimalPosition(box.width, box.height, repositionedBoxes);\n      repositionedBoxes.push({\n        ...box,\n        x: position.x,\n        y: position.y\n      });\n      console.log(`📦 Repositioned box ${index + 1}: ${box.title} -> (${position.x}, ${position.y})`);\n    });\n    \n    setBoxes(repositionedBoxes);\n    console.log('✅ Re-layout complete');\n  };\n\n  // FIXED: Box management functions with AutoResizeMathBox compatibility\n  const addBox = (title: string, content: string, color: string = 'from-blue-50 to-blue-100') => {\n    const { width, height } = calculateContentSize(title, content);\n    const position = findOptimalPosition(width, height, boxes);\n    \n    const newBox: Box = {\n      id: Date.now().toString() + Math.random().toString(36).substr(2, 9),\n      title,\n      content,\n      color,\n      x: position.x,\n      y: position.y,\n      width,\n      height\n    };\n    \n    setBoxes(prev => [...prev, newBox]);\n    return newBox.id;\n  };\n\n  // FIXED: Update box with position and size handlers for AutoResizeMathBox\n  const handleBoxPositionChange = (boxId: string, newPosition: Position) => {\n    setBoxes(prev => prev.map(box => \n      box.id === boxId ? { ...box, x: newPosition.x, y: newPosition.y } : box\n    ));\n  };\n\n  const handleBoxSizeChange = (boxId: string, newSize: Size) => {\n    setBoxes(prev => prev.map(box => \n      box.id === boxId ? { ...box, width: newSize.width, height: newSize.height } : box\n    ));\n  };\n\n  const handleBoxSaveRequest = () => {\n    // Auto-save the cheat sheet when boxes are modified\n    if (id && id !== 'new') {\n      updateCheatSheetMutation.mutate({\n        content: JSON.stringify(boxes),\n      });\n    }\n    console.log('📁 Box save requested - auto-saving cheat sheet');\n  };\n\n  const deleteBox = (id: string) => {\n    setBoxes(prev => prev.filter(box => box.id !== id));\n    if (selectedBox === id) {\n      setSelectedBox(null);\n    }\n  };\n\n  // Get box number for ChatGPT commands\n  const getBoxNumber = (boxId: string): number => {\n    const boxIndex = boxes.findIndex(box => box.id === boxId);\n    return boxIndex + 1; // 1-based numbering for user-friendly commands\n  };\n\n  const saveCheatSheet = () => {\n    // Manual save functionality - update the cheat sheet with current boxes\n    if (id && id !== 'new') {\n      updateCheatSheetMutation.mutate({\n        content: JSON.stringify(boxes),\n      });\n      toast({ title: 'Cheat sheet saved successfully!' });\n    }\n  };\n\n  // Create cheat sheet mutation\n  const createCheatSheetMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/cheatsheets', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: `New Cheat Sheet ${new Date().toLocaleDateString()}`,\n          content: JSON.stringify([]), // Empty boxes array for new cheat sheet\n        }),\n      });\n      if (!response.ok) throw new Error('Failed to create cheat sheet');\n      return response.json();\n    },\n    onSuccess: (newCheatSheet) => {\n      refetchCheatSheets();\n      window.location.href = `/cheatsheet-new/${newCheatSheet.id}`;\n    },\n  });\n\n  // Test function for debugging\n  const testCreateBoxes = () => {\n    const testFormulas = [\n      { title: 'Test Formula 1', content: 'F = ma', color: 'from-blue-50 to-blue-100' },\n      { title: 'Test Formula 2', content: 'E = mc²', color: 'from-green-50 to-green-100' },\n      { title: 'Test Formula 3', content: 'a² + b² = c²', color: 'from-red-50 to-red-100' },\n      { title: 'Test Formula 4', content: 'V = IR', color: 'from-purple-50 to-purple-100' },\n      { title: 'Test Formula 5', content: 'PV = nRT', color: 'from-yellow-50 to-yellow-100' },\n      { title: 'Test Formula 6', content: 'KE = ½mv²', color: 'from-indigo-50 to-indigo-100' },\n      { title: 'Test Formula 7', content: 'W = Fd cos θ', color: 'from-pink-50 to-pink-100' },\n      { title: 'Test Formula 8', content: 'p = mv', color: 'from-cyan-50 to-cyan-100' },\n      { title: 'Test Formula 9', content: 'F = k|q₁q₂|/r²', color: 'from-orange-50 to-orange-100' },\n      { title: 'Test Formula 10', content: 'v = fλ', color: 'from-teal-50 to-teal-100' }\n    ];\n    \n    createMultipleBoxes(testFormulas, 10);\n    toast({ title: 'Created 10 test physics formulas!' });\n  };\n\n  // Load existing boxes from cheat sheet data\n  useEffect(() => {\n    if (cheatSheet?.content) {\n      try {\n        const parsedBoxes = JSON.parse(cheatSheet.content);\n        if (Array.isArray(parsedBoxes)) {\n          setBoxes(parsedBoxes);\n          console.log('📄 Loaded existing boxes from cheat sheet:', parsedBoxes.length);\n        }\n      } catch (error) {\n        console.error('Error parsing cheat sheet content:', error);\n        // If content is not valid JSON, start with empty boxes\n        setBoxes([]);\n      }\n    }\n  }, [cheatSheet]);\n\n  if (cheatSheetLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-lg font-medium text-gray-700 dark:text-gray-300\">Loading cheat sheet...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Calculate pages needed and render multiple pages with proper containment\n  const requiredPages = calculateRequiredPages();\n\n  return (\n    <div className=\"h-screen flex flex-col\" style={{ background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)' }}>\n      {/* Enhanced Microsoft Word-Style Toolbar with Soft Blue Background */}\n      <div className=\"border-b border-pink-200/30 flex-shrink-0\" style={{ \n        background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)',\n        boxShadow: '0 4px 16px rgba(255, 255, 255, 0.6) inset, 0 2px 8px rgba(0, 0, 0, 0.05)'\n      }}>\n\n\n        {/* Main toolbar content - 2 lines */}\n        <div className=\"p-3 space-y-3\">\n          {/* First toolbar line */}\n          <div className=\"flex items-center justify-center space-x-3 overflow-x-auto px-4\">\n            {/* Cheat Sheet Features - First section */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\">\n                <Type className=\"w-6 h-6 text-blue-600\" />\n                <span className=\"text-xs\">{boxes.length} boxes</span>\n              </button>\n              <button \n                onClick={testCreateBoxes}\n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n              >\n                <Brain className=\"w-5 h-5 text-purple-600\" />\n                <span className=\"text-xs\">Create Physics</span>\n              </button>\n              <button \n                onClick={relayoutAllBoxes}\n                disabled={boxes.length === 0}\n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n              >\n                <Grid3X3 className=\"w-5 h-5 text-purple-600\" />\n                <span className=\"text-xs\">Auto-Layout</span>\n              </button>\n            </div>\n\n            {/* File operations */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={saveCheatSheet}\n              >\n                <Save className=\"w-6 h-6 text-orange-500\" />\n                <span className=\"text-xs\">Save</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => createCheatSheetMutation.mutate()}\n              >\n                <Plus className=\"w-6 h-6 text-green-500\" />\n                <span className=\"text-xs\">New</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => editor?.chain().focus().undo().run()}\n                disabled={!editor?.can().undo()}\n              >\n                <Undo2 className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"text-xs\">Undo</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => editor?.chain().focus().redo().run()}\n                disabled={!editor?.can().redo()}\n              >\n                <Redo2 className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"text-xs\">Redo</span>\n              </button>\n            </div>\n\n            {/* Font controls */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <Select value={fontFamily} onValueChange={setFontFamily}>\n                <SelectTrigger className=\"w-36 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Times New Roman\">Times New Roman</SelectItem>\n                  <SelectItem value=\"Arial\">Arial</SelectItem>\n                  <SelectItem value=\"Calibri\">Calibri</SelectItem>\n                  <SelectItem value=\"Georgia\">Georgia</SelectItem>\n                  <SelectItem value=\"Verdana\">Verdana</SelectItem>\n                  <SelectItem value=\"Helvetica\">Helvetica</SelectItem>\n                  <SelectItem value=\"Courier New\">Courier New</SelectItem>\n                  <SelectItem value=\"Comic Sans MS\">Comic Sans MS</SelectItem>\n                  <SelectItem value=\"Impact\">Impact</SelectItem>\n                  <SelectItem value=\"Trebuchet MS\">Trebuchet MS</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select value={fontSize.toString()} onValueChange={(value) => setFontSize(parseInt(value))}>\n                <SelectTrigger className=\"w-16 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"8\">8</SelectItem>\n                  <SelectItem value=\"9\">9</SelectItem>\n                  <SelectItem value=\"10\">10</SelectItem>\n                  <SelectItem value=\"11\">11</SelectItem>\n                  <SelectItem value=\"12\">12</SelectItem>\n                  <SelectItem value=\"14\">14</SelectItem>\n                  <SelectItem value=\"16\">16</SelectItem>\n                  <SelectItem value=\"18\">18</SelectItem>\n                  <SelectItem value=\"20\">20</SelectItem>\n                  <SelectItem value=\"22\">22</SelectItem>\n                  <SelectItem value=\"24\">24</SelectItem>\n                  <SelectItem value=\"26\">26</SelectItem>\n                  <SelectItem value=\"28\">28</SelectItem>\n                  <SelectItem value=\"36\">36</SelectItem>\n                  <SelectItem value=\"48\">48</SelectItem>\n                  <SelectItem value=\"72\">72</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => setFontSize(Math.min(72, fontSize + 2))}\n                disabled={fontSize >= 72}\n              >\n                <Plus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => setFontSize(Math.max(8, fontSize - 2))}\n                disabled={fontSize <= 8}\n              >\n                <Minus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n            </div>\n\n            {/* Text formatting */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('bold') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleBold().run()}\n              >\n                <Bold className=\"w-6 h-6 text-blue-600 font-bold\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('italic') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleItalic().run()}\n              >\n                <Italic className=\"w-6 h-6 text-blue-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('underline') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleUnderline().run()}\n              >\n                <UnderlineIcon className=\"w-6 h-6 text-blue-600\" />\n              </button>\n              <input\n                type=\"color\"\n                value={textColor}\n                onChange={(e) => {\n                  setTextColor(e.target.value);\n                  editor?.chain().focus().setColor(e.target.value).run();\n                }}\n                className=\"w-8 h-6 border rounded cursor-pointer\"\n                title=\"Font Color\"\n                disabled={!editor}\n              />\n            </div>\n\n            {/* Text alignment */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'left' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('left').run()}\n              >\n                <AlignLeft className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'center' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('center').run()}\n              >\n                <AlignCenter className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'right' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('right').run()}\n              >\n                <AlignRight className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'justify' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('justify').run()}\n              >\n                <AlignJustify className=\"w-6 h-6 text-green-600\" />\n              </button>\n            </div>\n\n            {/* Lists and indentation */}\n            <div className=\"flex items-center space-x-1\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('bulletList') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleBulletList().run()}\n              >\n                <List className=\"w-6 h-6 text-purple-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('orderedList') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleOrderedList().run()}\n              >\n                <ListOrdered className=\"w-6 h-6 text-purple-600\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Second toolbar line */}\n          <div className=\"flex items-center justify-center space-x-3 overflow-x-auto px-4\">\n            {/* Cheat Sheet specific controls */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-300 pr-4\">\n              <Badge variant=\"secondary\" className=\"ml-2\">\n                {boxes.length} boxes\n              </Badge>\n              <Badge variant=\"outline\" className=\"ml-1\">\n                {requiredPages} page{requiredPages !== 1 ? 's' : ''}\n              </Badge>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main content area */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        <ResizablePanelGroup direction=\"horizontal\" className=\"h-full\">\n          {/* Left sidebar - Cheat sheets list */}\n          <ResizablePanel defaultSize={17} minSize={12} maxSize={25}>\n            <div className=\"h-full shadow-lg border-r border-gray-200 dark:border-gray-700\" style={{\n              background: 'white'\n            }}>\n              <div className=\"p-4\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Cheat Sheets</h2>\n                  <Button \n                    onClick={() => createCheatSheetMutation.mutate()}\n                    size=\"sm\" \n                    variant=\"outline\"\n                  >\n                    <Plus className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n                <ScrollArea className=\"h-[calc(100vh-200px)]\">\n                  <div className=\"space-y-2\">\n                    {cheatSheets?.map((sheet: CheatSheet) => (\n                      <Link \n                        key={sheet.id} \n                        href={`/cheatsheet-new/${sheet.id}`}\n                        className=\"block\"\n                      >\n                        <Card className={`cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors ${\n                          sheet.id === id ? 'ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-950' : ''\n                        }`}>\n                          <CardContent className=\"p-3\">\n                            <div className=\"flex items-start space-x-3\">\n                              <FileText className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n                              <div className=\"flex-1 min-w-0\">\n                                <h3 className=\"font-medium text-sm text-gray-900 dark:text-white truncate\">\n                                  {sheet.title}\n                                </h3>\n                                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                                  {new Date(sheet.updatedAt).toLocaleDateString()}\n                                </p>\n                                <div className=\"flex items-center space-x-2 mt-2\">\n                                  <Badge variant=\"secondary\" className=\"text-xs\">\n                                    {(() => {\n                                      try {\n                                        const content = JSON.parse(sheet.content || '[]');\n                                        return Array.isArray(content) ? content.length : 0;\n                                      } catch {\n                                        return 0;\n                                      }\n                                    })()} boxes\n                                  </Badge>\n                                </div>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      </Link>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </div>\n            </div>\n          </ResizablePanel>\n\n          <ResizableHandle withHandle />\n\n          {/* Middle panel - Cheat sheet workspace with FIXED multi-page rendering */}\n          <ResizablePanel defaultSize={66} minSize={40}>\n            <div className=\"h-full relative overflow-auto\" style={{\n              background: 'linear-gradient(to right, #ffc0cb, #e6e6fa, #add8e6)'\n            }}>\n              <div className=\"absolute inset-0\">\n                {/* CRITICAL FIX: Multi-page container with proper constraints */}\n                <div className=\"min-h-full p-8\">\n                  <div className=\"space-y-8\">\n                    {Array.from({ length: requiredPages }, (_, pageIndex) => {\n                      const PAGE_HEIGHT = 1056;\n                      const pageStartY = pageIndex * PAGE_HEIGHT;\n                      const pageEndY = (pageIndex + 1) * PAGE_HEIGHT;\n                      \n                      // Filter boxes for this page\n                      const pageBoxes = boxes.filter(box => {\n                        const boxBottomY = box.y + box.height;\n                        return box.y < pageEndY && boxBottomY > pageStartY;\n                      });\n                      \n                      console.log(`📄 Page ${pageIndex + 1}: ${pageBoxes.length} boxes`);\n                      \n                      return (\n                        <div key={pageIndex} className=\"relative mx-auto bg-white shadow-lg\">\n                          {/* FIXED: Page guide with proper dimensions */}\n                          <div \n                            className=\"relative border border-gray-300\"\n                            style={{\n                              width: '816px',\n                              height: '1056px',\n                              minHeight: '1056px',\n                              maxHeight: '1056px'\n                            }}\n                          >\n                            {/* Page number indicator */}\n                            <div className=\"absolute -top-6 left-0 text-sm text-gray-500 font-medium\">\n                              Page {pageIndex + 1} of {requiredPages}\n                            </div>\n                            \n                            {/* FIXED: Constrained box container */}\n                            <div \n                              className=\"absolute inset-0 overflow-hidden\"\n                              style={{\n                                width: '816px',\n                                height: '1056px'\n                              }}\n                            >\n                              {/* CRITICAL FIX: Render boxes with proper AutoResizeMathBox props */}\n                              {pageBoxes.map((box) => (\n                                <AutoResizeMathBox\n                                  key={box.id}\n                                  id={box.id}\n                                  title={box.title}\n                                  content={box.content}\n                                  color={box.color}\n                                  // FIXED: Pass position as object\n                                  position={{ \n                                    x: box.x, \n                                    y: box.y - pageStartY // Adjust Y for multi-page layout\n                                  }}\n                                  // FIXED: Pass size as object\n                                  size={{ \n                                    width: box.width, \n                                    height: box.height \n                                  }}\n                                  // FIXED: Use proper callback handlers\n                                  onPositionChange={(newPosition) => {\n                                    // Adjust Y back to global coordinate system\n                                    const globalPosition = {\n                                      x: newPosition.x,\n                                      y: newPosition.y + pageStartY\n                                    };\n                                    handleBoxPositionChange(box.id, globalPosition);\n                                  }}\n                                  onSizeChange={(newSize) => handleBoxSizeChange(box.id, newSize)}\n                                  onSaveRequest={handleBoxSaveRequest}\n                                  onDelete={() => deleteBox(box.id)}\n                                  onClick={() => setSelectedBox(box.id)}\n                                  // FIXED: Pass boxNumber as number, not function\n                                  boxNumber={getBoxNumber(box.id)}\n                                  isSelected={selectedBox === box.id}\n                                  // Reasonable constraints for the page\n                                  minWidth={120}\n                                  maxWidth={700}\n                                  minHeight={80}\n                                  maxHeight={800}\n                                />\n                              ))}\n                            </div>\n                            \n                            {/* Page margins guide */}\n                            <div className=\"absolute inset-0 pointer-events-none\">\n                              <div \n                                className=\"border border-dashed border-blue-300 opacity-30\"\n                                style={{\n                                  position: 'absolute',\n                                  top: '40px',\n                                  left: '40px',\n                                  right: '40px',\n                                  bottom: '40px'\n                                }}\n                              ></div>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                  \n                  {/* Empty state when no boxes */}\n                  {boxes.length === 0 && (\n                    <div className=\"flex items-center justify-center h-96 mx-auto bg-white shadow-lg border border-gray-300\"\n                         style={{ width: '816px', height: '1056px' }}>\n                      <div className=\"text-center p-8\">\n                        <Brain className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\n                        <h3 className=\"text-xl font-semibold text-gray-700 mb-2\">No boxes yet</h3>\n                        <p className=\"text-gray-500 mb-6 max-w-md\">\n                          Start building your cheat sheet by asking ChatGPT to create boxes with formulas, \n                          equations, or concepts. Try: \"Create 10 physics equations\" or use the test button above.\n                        </p>\n                        <div className=\"space-y-2 text-sm text-gray-400\">\n                          <p>\"Create 15 calculus formulas\"</p>\n                          <p>\"Add 20 chemistry equations\"</p>\n                          <p>\"Make 30 geometry theorems\"</p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </ResizablePanel>\n\n          <ResizableHandle withHandle />\n\n          {/* Right panel - ChatGPT integration */}\n          <ResizablePanel defaultSize={17} minSize={12} maxSize={35}>\n            <div className=\"h-full shadow-lg border-l border-gray-200 dark:border-gray-700 flex flex-col\" style={{\n              background: 'white'\n            }}>\n              <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n                <div className=\"flex items-center space-x-2 mb-3\">\n                  <Sparkles className=\"w-5 h-5 text-purple-600\" />\n                  <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">AI Assistant</h2>\n                </div>\n                \n                {/* Chat sessions */}\n                <div className=\"space-y-2 mb-4\">\n                  {chatSessions.map((session: ChatSession) => (\n                    <div\n                      key={session.id}\n                      className={`p-2 rounded cursor-pointer text-sm transition-colors ${\n                        defaultSessionId === session.id\n                          ? 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200'\n                          : 'hover:bg-gray-100 dark:hover:bg-slate-800'\n                      }`}\n                      onClick={() => setDefaultSessionId(session.id)}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"truncate font-medium\">{session.title}</span>\n                        <div className=\"flex items-center space-x-1\">\n                          <Clock className=\"w-3 h-3 text-gray-400\" />\n                          <span className=\"text-xs text-gray-500\">\n                            {new Date(session.updatedAt).toLocaleDateString()}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                <Button\n                  onClick={createNewChatSession}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"w-full\"\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  New Chat Session\n                </Button>\n              </div>\n\n              {/* Chat messages */}\n              <ScrollArea className=\"flex-1 p-4\">\n                <div className=\"space-y-4\">\n                  {chatMessages.map((message: ChatMessage) => (\n                    <div\n                      key={message.id}\n                      className={`p-3 rounded-lg ${\n                        message.role === 'user'\n                          ? 'bg-blue-100 dark:bg-blue-900 ml-4'\n                          : 'bg-gray-100 dark:bg-slate-800 mr-4'\n                      }`}\n                    >\n                      <div className=\"flex items-start space-x-2\">\n                        {message.role === 'assistant' && (\n                          <Sparkles className=\"w-4 h-4 text-purple-600 mt-0.5\" />\n                        )}\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm text-gray-800 dark:text-gray-200\">\n                            {message.content}\n                          </p>\n                          <span className=\"text-xs text-gray-500 mt-1 block\">\n                            {new Date(message.createdAt).toLocaleTimeString()}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </ScrollArea>\n\n              {/* Chat input */}\n              <div className=\"p-4 border-t border-gray-200 dark:border-gray-700\">\n                <div className=\"flex space-x-2\">\n                  <Textarea\n                    value={chatInput}\n                    onChange={(e) => setChatInput(e.target.value)}\n                    placeholder=\"Ask me to create boxes, formulas, or equations...\"\n                    className=\"flex-1 min-h-[60px] text-sm\"\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey) {\n                        e.preventDefault();\n                        handleSendMessage();\n                      }\n                    }}\n                  />\n                  <Button\n                    onClick={handleSendMessage}\n                    disabled={!chatInput.trim() || sendMessageMutation.isPending}\n                    size=\"sm\"\n                    className=\"self-end\"\n                  >\n                    <Send className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n                <div className=\"mt-2 text-xs text-gray-500\">\n                  <p>Try: \"Create 10 physics equations\" or \"Add 20 math formulas\"</p>\n                </div>\n              </div>\n            </div>\n          </ResizablePanel>\n        </ResizablePanelGroup>\n      </div>\n    </div>\n  );\n}","size_bytes":55162},"client/src/pages/template-workspace-new.tsx":{"content":"import { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams, Link, useLocation } from 'wouter';\nimport { useEditor, EditorContent } from '@tiptap/react';\nimport StarterKit from '@tiptap/starter-kit';\nimport TextAlign from '@tiptap/extension-text-align';\nimport Underline from '@tiptap/extension-underline';\nimport { Color } from '@tiptap/extension-color';\nimport { TextStyle } from '@tiptap/extension-text-style';\nimport { FontFamily } from '@tiptap/extension-font-family';\nimport Highlight from '@tiptap/extension-highlight';\nimport { Button } from '@/components/ui/button';\nimport { Separator } from '@/components/ui/separator';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ResizablePanelGroup, ResizablePanel, ResizableHandle } from '@/components/ui/resizable';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  Save, FileText, Bold, Italic, Underline as UnderlineIcon, \n  AlignLeft, AlignCenter, AlignRight, AlignJustify,\n  List, ListOrdered, ZoomIn, ZoomOut, Printer, Type, Palette, \n  Undo2, Redo2, History, MessageSquare, Plus, Clock, Send,\n  Edit3, Share, Trash2, Copy, Download, Eye, MoreVertical,\n  Brain, Sparkles, Command, ChevronDown, ChevronRight,\n  Strikethrough, Scissors, ClipboardPaste, Minus,\n  Indent, Outdent, Layout, Image, Table, Link as LinkIcon, Settings, X,\n  FileSpreadsheet, ArrowLeft\n} from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Template, ChatSession, ChatMessage } from '@shared/schema';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\n\n// Custom FontSize extension\nconst FontSize = TextStyle.extend({\n  addAttributes() {\n    return {\n      fontSize: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.style.fontSize?.replace('pt', ''),\n        renderHTML: (attributes: any) => {\n          if (!attributes.fontSize) return {}\n          return { style: `font-size: ${attributes.fontSize}pt` }\n        },\n      }\n    }\n  }\n});\n\nexport default function TemplateWorkspace() {\n  const { id } = useParams<{ id: string }>();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Document state\n  const [fontSize, setFontSize] = useState(12);\n  const [fontFamily, setFontFamily] = useState('Times New Roman');\n  const [textColor, setTextColor] = useState('#000000');\n  \n  // Chat state\n  const [chatInput, setChatInput] = useState('');\n  const [defaultSessionId, setDefaultSessionId] = useState<string | null>(null);\n  const [expandedSessions, setExpandedSessions] = useState<Set<string>>(new Set());\n\n  // Editor setup\n  const editor = useEditor({\n    extensions: [\n      StarterKit.configure({\n        heading: {\n          levels: [1, 2, 3],\n        },\n      }),\n      TextAlign.configure({\n        types: ['heading', 'paragraph'],\n      }),\n      Underline,\n      Color,\n      FontFamily,\n      FontSize,\n      Highlight\n    ],\n    content: '<p>Start editing your template content...</p>',\n    editorProps: {\n      attributes: {\n        class: 'prose prose-sm sm:prose lg:prose-lg xl:prose-2xl mx-auto focus:outline-none',\n      },\n    },\n  });\n\n  // Fetch template data\n  const { data: template, isLoading: templateLoading, refetch: refetchTemplate } = useQuery({\n    queryKey: ['template', id],\n    queryFn: () => apiRequest(`/api/templates/${id}`),\n    enabled: !!id && id !== 'new',\n  });\n\n  // Fetch all templates for left panel\n  const { data: templates, refetch: refetchTemplates } = useQuery({\n    queryKey: ['templates'],\n    queryFn: () => apiRequest('/api/templates'),\n  });\n\n  // Fetch chat sessions\n  const { data: chatSessions = [], refetch: refetchSessions } = useQuery({\n    queryKey: ['template-chat-sessions', id],\n    queryFn: () => apiRequest(`/api/templates/${id}/chat-sessions`),\n    enabled: !!id && id !== 'new',\n  });\n\n  // Fetch chat messages\n  const { data: chatMessages = [], refetch: refetchMessages } = useQuery({\n    queryKey: ['chat-messages', defaultSessionId],\n    queryFn: () => apiRequest(`/api/chat-sessions/${defaultSessionId}/messages`),\n    enabled: !!defaultSessionId,\n  });\n\n  // Update template mutation\n  const updateTemplateMutation = useMutation({\n    mutationFn: async (updates: Partial<Template>) => {\n      const response = await fetch(`/api/templates/${id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updates),\n      });\n      if (!response.ok) throw new Error('Failed to update template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['template', id] });\n    },\n  });\n\n  // Create new chat session\n  const createNewChatSession = async () => {\n    if (!id || id === 'new') return;\n    \n    try {\n      const response = await fetch(`/api/templates/${id}/chat-sessions`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: `Chat Session ${new Date().toLocaleDateString()}`,\n          templateSnapshot: editor?.getHTML() || '<p></p>',\n        }),\n      });\n      if (response.ok) {\n        const session = await response.json();\n        setDefaultSessionId(session.id);\n        refetchSessions();\n      }\n    } catch (error) {\n      console.error('Failed to create chat session:', error);\n    }\n  };\n\n  // Send chat message mutation\n  const sendMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      // If no default session, create one first\n      if (!defaultSessionId) {\n        await createNewChatSession();\n      }\n      \n      const templateContent = editor?.getHTML() || '';\n      const response = await fetch(`/api/chat-sessions/${defaultSessionId}/messages`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          content: message, \n          templateContent,\n          templateId: id \n        }),\n      });\n      if (!response.ok) throw new Error('Failed to send message');\n      return response.json();\n    },\n    onSuccess: (response: any) => {\n      refetchMessages();\n      setChatInput('');\n      \n      // Insert text response into template if it's content\n      if (response.insertText && editor) {\n        if (response.insertAtEnd) {\n          editor.commands.focus('end');\n          editor.commands.insertContent(response.insertText);\n        } else {\n          editor.commands.focus();\n          editor.commands.insertContent(response.insertText);\n        }\n      }\n    },\n  });\n\n  // Handle sending chat message\n  const handleSendMessage = () => {\n    if (!chatInput.trim() || sendMessageMutation.isPending) return;\n    sendMessageMutation.mutate(chatInput);\n  };\n\n  // Set default session when sessions are loaded\n  useEffect(() => {\n    if (chatSessions.length > 0 && !defaultSessionId) {\n      setDefaultSessionId(chatSessions[0].id);\n    }\n  }, [template, chatSessions, defaultSessionId]);\n\n  // Create template mutation\n  const createTemplateMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/templates', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: `New Template ${new Date().toLocaleDateString()}`,\n          content: '<p>Start building your template...</p>',\n        }),\n      });\n      if (!response.ok) throw new Error('Failed to create template');\n      return response.json();\n    },\n    onSuccess: (newTemplate) => {\n      refetchTemplates();\n      window.location.href = `/template/${newTemplate.id}`;\n    },\n  });\n\n  if (templateLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-lg font-medium text-gray-700 dark:text-gray-300\">Loading template...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col\" style={{ background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)' }}>\n      {/* Enhanced Microsoft Word-Style Toolbar with Soft Blue Background */}\n      <div className=\"border-b border-pink-200/30 flex-shrink-0\" style={{ \n        background: 'linear-gradient(to right, #fcf2f7 0%, #f8f4fc 40%, #f5f9ff 60%, #eef8fd 100%)',\n        boxShadow: '0 4px 16px rgba(255, 255, 255, 0.6) inset, 0 2px 8px rgba(0, 0, 0, 0.05)'\n      }}>\n\n\n        {/* Main toolbar content - 2 lines */}\n        <div className=\"p-3 space-y-3\">\n          {/* First toolbar line */}\n          <div className=\"flex items-center justify-center space-x-3 overflow-x-auto px-4\">\n            {/* Template Features - First section */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\">\n                <FileSpreadsheet className=\"w-6 h-6 text-blue-600\" />\n                <span className=\"text-xs\">Template</span>\n              </button>\n              <button \n                onClick={saveTemplate}\n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n              >\n                <Save className=\"w-5 h-5 text-purple-600\" />\n                <span className=\"text-xs\">Save Template</span>\n              </button>\n              <button \n                onClick={() => createTemplateMutation.mutate()}\n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n              >\n                <Plus className=\"w-5 h-5 text-purple-600\" />\n                <span className=\"text-xs\">New Template</span>\n              </button>\n            </div>\n\n            {/* File operations */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => {\n                  if (!editor) {\n                    toast({ title: \"Editor not ready\", variant: \"destructive\" });\n                    return;\n                  }\n                  try {\n                    const content = editor.getHTML() || '';\n                    navigator.clipboard.writeText(content);\n                    toast({ title: \"Content copied to clipboard\" });\n                  } catch (error) {\n                    toast({ title: \"Copy failed\", description: \"Please use Ctrl+C\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <Copy className=\"w-6 h-6 text-orange-500\" />\n                <span className=\"text-xs\">Copy</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={() => {\n                  if (!editor) {\n                    toast({ title: \"Editor not ready\", variant: \"destructive\" });\n                    return;\n                  }\n                  try {\n                    if (editor.state.selection.empty) {\n                      editor.chain().focus().selectAll().run();\n                    }\n                    const content = editor.getHTML() || '';\n                    navigator.clipboard.writeText(content);\n                    editor.chain().focus().deleteSelection().run();\n                    toast({ title: \"Content cut to clipboard\" });\n                  } catch (error) {\n                    toast({ title: \"Cut failed\", description: \"Please use Ctrl+X\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <Scissors className=\"w-6 h-6 text-red-500\" />\n                <span className=\"text-xs\">Cut</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700\"\n                onClick={async () => {\n                  try {\n                    const text = await navigator.clipboard.readText();\n                    editor?.chain().focus().insertContent(text).run();\n                    toast({ title: \"Content pasted\" });\n                  } catch (err) {\n                    toast({ title: \"Paste failed\", description: \"Please use Ctrl+V instead\", variant: \"destructive\" });\n                  }\n                }}\n              >\n                <ClipboardPaste className=\"w-6 h-6 text-green-500\" />\n                <span className=\"text-xs\">Paste</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => editor?.chain().focus().undo().run()}\n                disabled={!editor?.can().undo()}\n              >\n                <Undo2 className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"text-xs\">Undo</span>\n              </button>\n              <button \n                className=\"flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => editor?.chain().focus().redo().run()}\n                disabled={!editor?.can().redo()}\n              >\n                <Redo2 className=\"w-4 h-4 text-blue-500\" />\n                <span className=\"text-xs\">Redo</span>\n              </button>\n            </div>\n\n            {/* Font controls */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <Select value={fontFamily} onValueChange={setFontFamily}>\n                <SelectTrigger className=\"w-36 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Times New Roman\">Times New Roman</SelectItem>\n                  <SelectItem value=\"Arial\">Arial</SelectItem>\n                  <SelectItem value=\"Calibri\">Calibri</SelectItem>\n                  <SelectItem value=\"Georgia\">Georgia</SelectItem>\n                  <SelectItem value=\"Verdana\">Verdana</SelectItem>\n                  <SelectItem value=\"Helvetica\">Helvetica</SelectItem>\n                  <SelectItem value=\"Courier New\">Courier New</SelectItem>\n                  <SelectItem value=\"Comic Sans MS\">Comic Sans MS</SelectItem>\n                  <SelectItem value=\"Impact\">Impact</SelectItem>\n                  <SelectItem value=\"Trebuchet MS\">Trebuchet MS</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select value={fontSize.toString()} onValueChange={(value) => setFontSize(parseInt(value))}>\n                <SelectTrigger className=\"w-16 border-none bg-transparent hover:bg-gray-100 text-gray-700\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"8\">8</SelectItem>\n                  <SelectItem value=\"9\">9</SelectItem>\n                  <SelectItem value=\"10\">10</SelectItem>\n                  <SelectItem value=\"11\">11</SelectItem>\n                  <SelectItem value=\"12\">12</SelectItem>\n                  <SelectItem value=\"14\">14</SelectItem>\n                  <SelectItem value=\"16\">16</SelectItem>\n                  <SelectItem value=\"18\">18</SelectItem>\n                  <SelectItem value=\"20\">20</SelectItem>\n                  <SelectItem value=\"22\">22</SelectItem>\n                  <SelectItem value=\"24\">24</SelectItem>\n                  <SelectItem value=\"26\">26</SelectItem>\n                  <SelectItem value=\"28\">28</SelectItem>\n                  <SelectItem value=\"36\">36</SelectItem>\n                  <SelectItem value=\"48\">48</SelectItem>\n                  <SelectItem value=\"72\">72</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => setFontSize(Math.min(72, fontSize + 2))}\n                disabled={fontSize >= 72}\n              >\n                <Plus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n              <button \n                className=\"px-2 py-1 hover:bg-gray-100 rounded transition-colors text-gray-700 disabled:opacity-50\"\n                onClick={() => setFontSize(Math.max(8, fontSize - 2))}\n                disabled={fontSize <= 8}\n              >\n                <Minus className=\"w-5 h-5 text-blue-600\" />\n              </button>\n            </div>\n\n            {/* Text formatting */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('bold') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleBold().run()}\n              >\n                <Bold className=\"w-6 h-6 text-blue-600 font-bold\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('italic') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleItalic().run()}\n              >\n                <Italic className=\"w-6 h-6 text-blue-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('underline') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleUnderline().run()}\n              >\n                <UnderlineIcon className=\"w-6 h-6 text-blue-600\" />\n              </button>\n              <input\n                type=\"color\"\n                value={textColor}\n                onChange={(e) => {\n                  setTextColor(e.target.value);\n                  editor?.chain().focus().setColor(e.target.value).run();\n                }}\n                className=\"w-8 h-6 border rounded cursor-pointer\"\n                title=\"Font Color\"\n                disabled={!editor}\n              />\n            </div>\n\n            {/* Text alignment */}\n            <div className=\"flex items-center space-x-1 border-r border-gray-400 dark:border-gray-500 pr-3\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'left' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('left').run()}\n              >\n                <AlignLeft className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'center' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('center').run()}\n              >\n                <AlignCenter className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'right' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('right').run()}\n              >\n                <AlignRight className=\"w-6 h-6 text-green-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive({ textAlign: 'justify' }) \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().setTextAlign('justify').run()}\n              >\n                <AlignJustify className=\"w-6 h-6 text-green-600\" />\n              </button>\n            </div>\n\n            {/* Lists and indentation */}\n            <div className=\"flex items-center space-x-1\">\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('bulletList') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleBulletList().run()}\n              >\n                <List className=\"w-6 h-6 text-purple-600\" />\n              </button>\n              <button\n                className={`px-2 py-1 rounded transition-colors ${\n                  editor?.isActive('orderedList') \n                    ? 'bg-blue-100 text-blue-700' \n                    : 'hover:bg-gray-100 text-gray-700'\n                }`}\n                onClick={() => editor?.chain().focus().toggleOrderedList().run()}\n              >\n                <ListOrdered className=\"w-6 h-6 text-purple-600\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Second toolbar line */}\n          <div className=\"flex items-center justify-center space-x-3 overflow-x-auto px-4\">\n            {/* Template specific controls */}\n            <div className=\"flex items-center space-x-2 border-r border-gray-300 pr-4\">\n              <span className=\"text-sm text-gray-700\">{template?.title || 'New Template'}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main content area */}\n      <ResizablePanelGroup direction=\"horizontal\" className=\"h-full\">\n        {/* Left panel - Template History */}\n        <ResizablePanel defaultSize={25} minSize={20} maxSize={40}>\n          <div className=\"h-full shadow-lg border-r border-white/20\" style={{\n            background: 'white'\n          }}>\n            <div className=\"p-4 border-b border-white/20\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center\">\n                    <FileSpreadsheet className=\"w-5 h-5 mr-2\" />\n                    Templates\n                  </h2>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                    All your template documents\n                  </p>\n                </div>\n                <Button\n                  size=\"sm\"\n                  onClick={() => createTemplateMutation.mutate()}\n                  className=\"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700\"\n                >\n                  <Plus className=\"w-4 h-4 mr-1\" />\n                  New Template\n                </Button>\n              </div>\n            </div>\n            \n            <ScrollArea className=\"h-full p-4\">\n              <div className=\"space-y-2\">\n                {templates?.map((template: any) => (\n                  <div key={template.id} className=\"group\">\n                    <div \n                      className={`p-3 rounded-lg border transition-all duration-200 cursor-pointer ${\n                        id === template.id\n                          ? 'bg-blue-100 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700'\n                          : 'bg-white/50 dark:bg-slate-700/50 border-white/30 dark:border-slate-600 hover:bg-blue-50 dark:hover:bg-blue-900/20'\n                      }`}\n                      onClick={() => window.location.href = `/template/${template.id}`}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-2 flex-1\">\n                          <FileSpreadsheet className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n                          <span className=\"font-medium text-gray-900 dark:text-white truncate\">\n                            {template.title}\n                          </span>\n                        </div>\n                      </div>\n                      <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                        {new Date(template.createdAt || Date.now()).toLocaleString()}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                \n                {!templates?.length && (\n                  <div className=\"text-center py-8\">\n                    <FileSpreadsheet className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n                      No templates yet\n                    </p>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => createTemplateMutation.mutate()}\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      Create First Template\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </ScrollArea>\n          </div>\n        </ResizablePanel>\n\n        <ResizableHandle />\n\n        {/* Middle panel - Document Editor */}\n        <ResizablePanel defaultSize={50} minSize={30}>\n          <div className=\"h-full\" style={{\n            background: 'linear-gradient(to right, #ffc0cb, #e6e6fa, #add8e6)'\n          }}>\n            <ScrollArea className=\"h-full\" style={{\n              background: 'linear-gradient(to right, #ffc0cb, #e6e6fa, #add8e6)'\n            }}>\n              <div className=\"min-h-full p-8 flex flex-col items-center\">\n                {/* Single Page Container - Letter Size */}\n                <div\n                  className=\"bg-white dark:bg-slate-100 shadow-2xl mb-8 relative group hover:shadow-cyan-300/20 transition-all duration-500\"\n                  style={{\n                    width: '816px',\n                    height: '1056px',\n                    boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(6, 182, 212, 0.1), 0 0 20px rgba(6, 182, 212, 0.05)',\n                    minHeight: '1056px',\n                  }}\n                >\n                  {/* Page number indicator */}\n                  <div className=\"absolute -top-6 left-0 text-xs text-gray-500 dark:text-gray-400\">\n                    Template • Page 1\n                  </div>\n                  \n                  {/* Page content */}\n                  <div\n                    className=\"w-full h-full relative\"\n                    style={{ \n                      padding: '72px',\n                      overflow: 'hidden'\n                    }}\n                  >\n                    <EditorContent\n                      editor={editor}\n                      className=\"w-full focus:outline-none prose prose-sm max-w-none\"\n                      style={{\n                        fontFamily,\n                        fontSize: `${fontSize}pt`,\n                        color: textColor,\n                        lineHeight: '1.6',\n                        minHeight: '912px',\n                      }}\n                    />\n                  </div>\n                </div>\n              </div>\n            </ScrollArea>\n          </div>\n        </ResizablePanel>\n\n        <ResizableHandle />\n\n        {/* Right panel - Always-On ChatGPT Interface */}\n        <ResizablePanel defaultSize={25} minSize={20} maxSize={40}>\n          <div className=\"h-full shadow-lg border-l border-gray-200 dark:border-gray-700 flex flex-col\" style={{\n            background: 'white'\n          }}>\n            {/* ChatGPT Assistant Header - Fixed at top */}\n            <div className=\"flex-shrink-0 border-b border-gray-200 dark:border-gray-700 p-4\" style={{\n              background: 'white'\n            }}>\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg\">\n                    <Brain className=\"w-4 h-4 text-white\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900 dark:text-white text-sm\">ChatGPT Assistant</h3>\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 font-light\">\n                      Always available • Template helper\n                    </p>\n                  </div>\n                </div>\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" title=\"AI Active\"></div>\n              </div>\n              \n              {/* Smart AI Suggestions - Compact */}\n              <div className=\"space-y-2\">\n                <h4 className=\"text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider\">Quick Actions</h4>\n                <div className=\"grid grid-cols-1 gap-1\">\n                  <button className=\"w-full text-left p-2 text-xs bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700 transition-all duration-300 text-gray-700 dark:text-gray-300\">\n                    💡 Create structure\n                  </button>\n                  <button className=\"w-full text-left p-2 text-xs bg-purple-50 hover:bg-purple-100 dark:bg-purple-900/20 dark:hover:bg-purple-900/30 rounded-lg border border-purple-200 dark:border-purple-700 transition-all duration-300 text-gray-700 dark:text-gray-300\">\n                    📝 Add template fields\n                  </button>\n                  <button className=\"w-full text-left p-2 text-xs bg-green-50 hover:bg-green-100 dark:bg-green-900/20 dark:hover:bg-green-900/30 rounded-lg border border-green-200 dark:border-green-700 transition-all duration-300 text-gray-700 dark:text-gray-300\">\n                    🎯 Format layout\n                  </button>\n                </div>\n              </div>\n            </div>\n            \n            {/* Chat messages area - Flexible middle section with independent scroll */}\n            <div className=\"flex-1 overflow-y-auto p-4 min-h-0\">\n              <div className=\"space-y-2\">\n                {chatMessages.length === 0 && (\n                  <div className=\"text-center py-6\">\n                    <Sparkles className=\"w-8 h-8 text-purple-400 mx-auto mb-3\" />\n                    <h4 className=\"font-medium text-gray-900 dark:text-white mb-2 text-sm\">\n                      Ready to Help!\n                    </h4>\n                    <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-3\">\n                      Try natural language requests:\n                    </p>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-500 space-y-1\">\n                      <p>\"create a report template\"</p>\n                      <p>\"add placeholder fields\"</p>\n                      <p>\"format this layout\"</p>\n                    </div>\n                  </div>\n                )}\n                \n                {chatMessages.map((message: ChatMessage) => (\n                  <div\n                    key={message.id}\n                    className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'} mb-2`}\n                  >\n                    <div\n                      className={`max-w-[85%] p-2 rounded-lg text-xs ${\n                        message.role === 'user'\n                          ? 'bg-blue-500 text-white'\n                          : 'bg-gray-100 dark:bg-slate-700 text-gray-900 dark:text-white border shadow-sm'\n                      }`}\n                    >\n                      <p className=\"whitespace-pre-wrap leading-relaxed\">{message.content}</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n            \n            {/* Chat input - Fixed at bottom */}\n            <div className=\"flex-shrink-0 bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-gray-700 p-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex space-x-2\">\n                  <Textarea\n                    placeholder=\"Ask me to help with your template...\"\n                    value={chatInput}\n                    onChange={(e) => setChatInput(e.target.value)}\n                    className=\"flex-1 min-h-[50px] max-h-[50px] resize-none text-sm\"\n                    onKeyPress={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey) {\n                        e.preventDefault();\n                        handleSendMessage();\n                      }\n                    }}\n                  />\n                  <Button\n                    onClick={handleSendMessage}\n                    disabled={!chatInput.trim() || sendMessageMutation.isPending}\n                    className=\"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 self-end\"\n                  >\n                    <Send className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                  Try: \"create structure\", \"add fields\", \"format layout\"\n                </p>\n              </div>\n            </div>\n          </div>\n        </ResizablePanel>\n      </ResizablePanelGroup>\n    </div>\n  );\n}","size_bytes":34610},"client/src/components/PaginatedTextEditor.tsx":{"content":"import React, { useState, useEffect, useRef, useCallback } from 'react';\n\ninterface Page {\n  id: string;\n  content: string;\n}\n\ninterface PaginatedTextEditorProps {\n  content: string;\n  onChange: (content: string) => void;\n  fontSize: number;\n  fontFamily: string;\n  zoom: number;\n  onCursorPositionChange?: (position: number) => void;\n}\n\nexport function PaginatedTextEditor({\n  content,\n  onChange,\n  fontSize,\n  fontFamily,\n  zoom,\n  onCursorPositionChange\n}: PaginatedTextEditorProps) {\n  const [pages, setPages] = useState<Page[]>([{ id: '1', content: content || '' }]);\n  const [currentPageIndex, setCurrentPageIndex] = useState(0);\n  const [cursorPosition, setCursorPosition] = useState(0);\n  const pageRefs = useRef<(HTMLTextAreaElement | null)[]>([]);\n  \n  // Page dimensions (8.5\" x 11\" with 1\" margins at 96 DPI)\n  const pageWidth = 816; // 8.5\" * 96 DPI\n  const pageHeight = 1056; // 11\" * 96 DPI\n  const marginSize = 96; // 1\" margin * 96 DPI\n  const contentWidth = pageWidth - (marginSize * 2); // 6.5\"\n  const contentHeight = pageHeight - (marginSize * 2); // 9\"\n\n  // Binary search to find overflow break point\n  const findOverflowBreakPoint = useCallback((editor: HTMLTextAreaElement, text: string) => {\n    let left = 0;\n    let right = text.length;\n    let lastValidPosition = text.length;\n    \n    const originalValue = editor.value;\n    \n    while (left < right) {\n      const mid = Math.floor((left + right) / 2);\n      const testContent = text.substring(0, mid);\n      \n      editor.value = testContent;\n      \n      if (editor.scrollHeight <= editor.clientHeight) {\n        lastValidPosition = mid;\n        left = mid + 1;\n      } else {\n        right = mid;\n      }\n    }\n    \n    editor.value = originalValue;\n    return lastValidPosition;\n  }, []);\n\n  // Find nearest word boundary for clean breaks\n  const findNearestBreakPoint = useCallback((text: string, targetPosition: number) => {\n    // Look for line breaks first (within 20 chars)\n    for (let i = targetPosition; i >= Math.max(0, targetPosition - 20); i--) {\n      if (text[i] === '\\n') return i + 1;\n    }\n    \n    // Then look for word breaks (within 10 chars)\n    for (let i = targetPosition; i >= Math.max(0, targetPosition - 10); i--) {\n      if (text[i] === ' ') return i + 1;\n    }\n    \n    // Use exact position if no nearby break\n    return targetPosition;\n  }, []);\n\n  // Handle overflow when page content exceeds capacity\n  const handleOverflow = useCallback((pageIndex: number) => {\n    const editor = pageRefs.current[pageIndex];\n    if (!editor) return;\n\n    const text = editor.value;\n    const breakPoint = findOverflowBreakPoint(editor, text);\n    const cleanBreakPoint = findNearestBreakPoint(text, breakPoint);\n    \n    const keepContent = text.substring(0, cleanBreakPoint);\n    const overflowContent = text.substring(cleanBreakPoint);\n\n    setPages(prevPages => {\n      const newPages = [...prevPages];\n      newPages[pageIndex] = { ...newPages[pageIndex], content: keepContent };\n      \n      // Add overflow to next page or create new page\n      if (pageIndex + 1 < newPages.length) {\n        newPages[pageIndex + 1] = {\n          ...newPages[pageIndex + 1],\n          content: overflowContent + newPages[pageIndex + 1].content\n        };\n      } else {\n        newPages.push({\n          id: (newPages.length + 1).toString(),\n          content: overflowContent\n        });\n      }\n      \n      return newPages;\n    });\n\n    // Move cursor to next page if it was in overflow text\n    const editorCursorPos = editor.selectionStart || 0;\n    if (editorCursorPos > cleanBreakPoint) {\n      setTimeout(() => {\n        setCurrentPageIndex(pageIndex + 1);\n        const nextEditor = pageRefs.current[pageIndex + 1];\n        if (nextEditor) {\n          const newCursorPos = editorCursorPos - cleanBreakPoint;\n          nextEditor.focus();\n          nextEditor.setSelectionRange(newCursorPos, newCursorPos);\n        }\n      }, 0);\n    }\n  }, [findOverflowBreakPoint, findNearestBreakPoint]);\n\n  // Handle underflow - pull content from next page\n  const handleUnderflow = useCallback((pageIndex: number) => {\n    const editor = pageRefs.current[pageIndex];\n    const nextEditor = pageRefs.current[pageIndex + 1];\n    if (!editor || !nextEditor || pageIndex >= pages.length - 1) return;\n\n    const spaceRatio = editor.scrollHeight / editor.clientHeight;\n    \n    // Only pull content if page is less than 40% full\n    if (spaceRatio < 0.4 && nextEditor.value.length > 0) {\n      const nextPageContent = nextEditor.value;\n      const pullAmount = Math.min(nextPageContent.length, 100); // Pull up to 100 chars\n      \n      const pulledContent = nextPageContent.substring(0, pullAmount);\n      const remainingContent = nextPageContent.substring(pullAmount);\n      \n      setPages(prevPages => {\n        const newPages = [...prevPages];\n        newPages[pageIndex] = {\n          ...newPages[pageIndex],\n          content: newPages[pageIndex].content + pulledContent\n        };\n        \n        if (remainingContent.length > 0) {\n          newPages[pageIndex + 1] = {\n            ...newPages[pageIndex + 1],\n            content: remainingContent\n          };\n        } else {\n          // Remove empty page\n          newPages.splice(pageIndex + 1, 1);\n        }\n        \n        return newPages;\n      });\n    }\n  }, [pages.length]);\n\n  // Check for overflow on content change\n  const checkForOverflow = useCallback((pageIndex: number) => {\n    const editor = pageRefs.current[pageIndex];\n    if (!editor) return;\n\n    if (editor.scrollHeight > editor.clientHeight) {\n      handleOverflow(pageIndex);\n    } else {\n      handleUnderflow(pageIndex);\n    }\n  }, [handleOverflow, handleUnderflow]);\n\n  // Handle page content change\n  const handlePageChange = useCallback((pageIndex: number, newContent: string) => {\n    setPages(prevPages => {\n      const newPages = [...prevPages];\n      newPages[pageIndex] = { ...newPages[pageIndex], content: newContent };\n      return newPages;\n    });\n\n    // Check for overflow after state update\n    setTimeout(() => checkForOverflow(pageIndex), 0);\n    \n    // Update overall content\n    const fullContent = pages.map((page, idx) => \n      idx === pageIndex ? newContent : page.content\n    ).join('');\n    onChange(fullContent);\n  }, [pages, onChange, checkForOverflow]);\n\n  // Handle navigation between pages\n  const handleKeyDown = useCallback((e: React.KeyboardEvent<HTMLTextAreaElement>, pageIndex: number) => {\n    const editor = e.currentTarget;\n    const { selectionStart, selectionEnd } = editor;\n    \n    if (e.key === 'ArrowUp' && selectionStart === 0 && pageIndex > 0) {\n      e.preventDefault();\n      const prevEditor = pageRefs.current[pageIndex - 1];\n      if (prevEditor) {\n        prevEditor.focus();\n        prevEditor.setSelectionRange(prevEditor.value.length, prevEditor.value.length);\n        setCurrentPageIndex(pageIndex - 1);\n      }\n    } else if (e.key === 'ArrowDown' && selectionStart === editor.value.length && pageIndex < pages.length - 1) {\n      e.preventDefault();\n      const nextEditor = pageRefs.current[pageIndex + 1];\n      if (nextEditor) {\n        nextEditor.focus();\n        nextEditor.setSelectionRange(0, 0);\n        setCurrentPageIndex(pageIndex + 1);\n      }\n    } else if (e.key === 'Tab') {\n      e.preventDefault();\n      if (pageIndex < pages.length - 1) {\n        const nextEditor = pageRefs.current[pageIndex + 1];\n        if (nextEditor) {\n          nextEditor.focus();\n          setCurrentPageIndex(pageIndex + 1);\n        }\n      }\n    }\n  }, [pages.length]);\n\n  // Update pages when content prop changes\n  useEffect(() => {\n    if (pages.length === 1 && pages[0].content !== content) {\n      setPages([{ id: '1', content: content || '' }]);\n    }\n  }, [content, pages]);\n\n  // Update cursor position callback\n  const handleCursorChange = useCallback((e: React.SyntheticEvent<HTMLTextAreaElement>) => {\n    const editor = e.currentTarget;\n    const position = editor.selectionStart || 0;\n    setCursorPosition(position);\n    onCursorPositionChange?.(position);\n  }, [onCursorPositionChange]);\n\n  const editorStyle = {\n    width: `${contentWidth * zoom / 100}px`,\n    height: `${contentHeight * zoom / 100}px`,\n    fontSize: `${fontSize * zoom / 100}px`,\n    fontFamily: fontFamily,\n    lineHeight: '1.5',\n    padding: '0',\n    border: 'none',\n    outline: 'none',\n    resize: 'none' as const,\n    overflow: 'hidden',\n    backgroundColor: 'transparent',\n  };\n\n  const pageStyle = {\n    width: `${pageWidth * zoom / 100}px`,\n    height: `${pageHeight * zoom / 100}px`,\n    backgroundColor: 'white',\n    boxShadow: '0 4px 8px rgba(0,0,0,0.1)',\n    margin: '20px auto',\n    padding: `${marginSize * zoom / 100}px`,\n    position: 'relative' as const,\n  };\n\n  return (\n    <div className=\"flex-1 overflow-auto bg-gray-100 p-8\">\n      <div className=\"max-w-none\">\n        {pages.map((page, index) => (\n          <div key={page.id} style={pageStyle}>\n            <textarea\n              ref={el => pageRefs.current[index] = el}\n              value={page.content}\n              onChange={(e) => handlePageChange(index, e.target.value)}\n              onKeyDown={(e) => handleKeyDown(e, index)}\n              onSelect={handleCursorChange}\n              onClick={handleCursorChange}\n              style={editorStyle}\n              className=\"w-full h-full\"\n              spellCheck={true}\n            />\n            <div className=\"absolute bottom-2 left-1/2 transform -translate-x-1/2 text-xs text-gray-400\">\n              Page {index + 1} of {pages.length}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}","size_bytes":9609}}}